import{Q as ce}from"./QOptionGroup.791c4bf6.js";import{Q as ne}from"./QRange.9a456e07.js";import{_ as J,d as W,B as de,u as ee,c as F,r as m,w as L,o as te,h as D,i as U,k as C,M as ie,z as N,j as p,t as V,p as G,n as Z,S as A,a as z,v as ae,x as se,ad as ue,ag as fe,bo as me,y as pe,g as he}from"./index.8ea8b5e1.js";import{a as q}from"./vue3-apexcharts.common.d319f11b.js";import{n as I}from"./numeral.0ba0bd40.js";import{a as _e}from"./AffixSelector.ed8b6f1b.js";import{F as xe}from"./FactionBar.4eba264b.js";import"./QCheckbox.c0e3de5f.js";const ge=e=>(ae("data-v-561f8782"),e=e(),se(),e),ye={key:0},be={key:0},we=ge(()=>p("div",null,"Selected weeks",-1)),ke={class:"flex justify-around"},Se={class:"flex justify-center"},$e={key:0},Ge={class:"flex justify-around"},Ae={class:"flex justify-center"},Ce=W({__name:"LevelStats",props:{runs:{type:Array}},emits:["fetch"],setup(e,{emit:s}){const n=e,{runs:t}=de(n),h=ee().state.data,u=F(()=>h.Periodes),y=F(()=>h.Affixes);F(()=>h.settings);const M=F(()=>u.value&&y.value&&k.value&&S.value&&E.value),T=m(null),H=m(null),K=m(null);m(null);const Q=m(null),E=m(null),w=m(null),S=m(null),k=m(null),o=m(null),i=m(null),d=m(null),f=m({chart:{foreColor:"#a1a1a1"},yaxis:{type:"numeric",labels:{formatter:function(l,r,v){return l+"%"}},title:{text:"Success rate"}},xaxis:{type:"numeric",labels:{formatter:function(l,r,v){return Math.round(l)}},title:{text:"Keystone level"}}}),R=m({chart:{foreColor:"#a1a1a1"},yaxis:{title:{text:"Amount of runs"}},xaxis:{type:"numeric",labels:{formatter:function(l,r,v){return Math.round(l)}},title:{text:"Keystone level"}}}),$=l=>{if(l){var r=[];for(let g=0;g<l.length;g++){const x=l[g];var v=O(x);v&&r.push(v.name)}return r.join(", ")}},P=(l,r)=>{var v=k.apiUrl,g=!1;if(t.value){var x=A.groupBy(t.value,"periode");for(const a in x)if(x.hasOwnProperty(a)&&a==l){var B=x[a][0],c={id:a,start_timestamp:0,end_timestamp:0,affixes:B.affixes};return g=!0,r(c)}}else for(let a=0;a<u.value.length;a++){const b=u.value[a];if(b.id==l)return g=!0,r(b)}g||z.get(`${v}/Periode/id?Period=${l}`).then(a=>r(a.data))},X=()=>{t.value?ve():u.value&&(Q.value={min:u.value[0].id-u.value.length+1,max:u.value[0].id},w.value={min:u.value[0].id-2,max:u.value[0].id},le())},Y=()=>{if(k.value){var l=[],r=[];for(let x=0;x<k.value.length;x++){const B=k.value[x];var v=[],g=[];for(let c=0;c<B.length;c++){const a=B[c];a.level>=S.value.min&&a.level<=S.value.max&&(v.push([a.level,Math.round(a.success_rate*10)/10]),g.push([a.level,a.runs]))}t.value?P(B[0].periode,c=>{var a={name:"",data:v},b={name:"",data:g};l.push(a),r.push(b),i.value=l,o.value=r}):P(B[0].periode,c=>{var a={name:O(c.affixes[0]).name+", "+O(c.affixes[1]).name+", "+O(c.affixes[2]).name+", "+O(c.affixes[3]).name,data:v},b={name:O(c.affixes[0]).name+", "+O(c.affixes[1]).name+", "+O(c.affixes[2]).name+", "+O(c.affixes[3]).name,data:g};l.push(a),r.push(b),i.value=l,o.value=r})}}},ve=()=>{if(t.value){var l=[];const B=[...t.value];var r=A.groupBy(B,"keystone_level"),v=[];for(const c in r)if(r.hasOwnProperty(c)){const a=r[c];var g={level:a[0].keystone_level,runs:a.length,periode:a[0].periode,score:0,success_rate:a.filter(b=>b.time.map_time>=b.time.clear_time).length/a.length*100};a.forEach(b=>{g.score+=b.score}),v.push(g)}l.push(v),k.value=l;var x=2;for(let c=0;c<k.value.length;c++){const a=k.value[c];for(let b=0;b<a.length;b++){const re=a[b];re.level>x&&(x=re.level)}}E.value={min:2,max:x},S.value={min:2,max:x},Y()}},le=()=>{var l=h.apiUrl;if(console.log("Gathering data",l),u.value){var r=setTimeout(function(){K.value==r&&z.get(l+"/Stats/LevelStats?fromperiode="+w.value.min+"&toperiode="+w.value.max).then(function(v){k.value=v.data.map(x=>x.list),s("fetch",v.data);var g=2;for(let x=0;x<k.value.length;x++){const B=k.value[x];for(let c=0;c<B.length;c++){const a=B[c];a.level>g&&(g=a.level)}}E.value={min:2,max:g},S.value={min:2,max:g},Y()}).catch(function(v){console.log(v),d.value=0})},1e3);K.value=r}},O=l=>{if(y.value)for(let r=0;r<y.value.length;r++){const v=y.value[r];if(v.id===l)return v}},oe=()=>{w.value&&(P(w.value.min,l=>{H.value=$(l.affixes)}),P(w.value.max,l=>{T.value=$(l.affixes)}))};return L(u,()=>{X()}),L(S,()=>{w.value&&S.value&&Y()}),L(w,()=>{t.value||w.value&&S.value&&(le(),oe())}),L(t,()=>{k.value=null,X()}),te(()=>{X(),oe()}),(l,r)=>(D(),U("div",{class:ie({Box:C(t)})},[C(M)?(D(),U("div",ye,[C(t)?(D(),U("div",{key:0,class:ie([{Header:C(t)},"HeaderSize4"])}," Level statistics ",2)):N("",!0),p("div",null,[p("div",null,[C(t)?N("",!0):(D(),U("div",be,[we,p("div",ke,[p("div",null,"From: "+V(w.value.min)+" ("+V(H.value)+")",1),p("div",null,"To: "+V(w.value.max)+" ("+V(T.value)+")",1)]),p("div",Se,[G(ne,{"drag-range":"",snap:"",markers:"",modelValue:w.value,"onUpdate:modelValue":r[0]||(r[0]=v=>w.value=v),min:Q.value.min,style:{"max-width":"970px"},max:Q.value.max,step:1},null,8,["modelValue","min","max"])])]))]),p("div",null,[C(t)?N("",!0):(D(),U("div",$e,"Selected levels")),p("div",Ge,[p("div",null,"From level "+V(S.value.min),1),p("div",null,"To level "+V(S.value.max),1)]),p("div",Ae,[G(ne,{"drag-range":"",snap:"",markers:"","model-value":S.value,"onUpdate:model-value":r[1]||(r[1]=v=>S.value=v),min:E.value.min,max:E.value.max,step:1,style:{"max-width":"970px"}},null,8,["model-value","min","max"])])])]),i.value?(D(),Z(C(q),{key:1,width:"100%",height:"400px",type:"line",options:f.value,series:i.value},null,8,["options","series"])):N("",!0),o.value?(D(),Z(C(q),{key:2,width:"100%",height:"400px",type:"line",options:R.value,series:o.value},null,8,["options","series"])):N("",!0)])):N("",!0)],2))}});var De=J(Ce,[["__scopeId","data-v-561f8782"]]);const Me=e=>(ae("data-v-6290eb72"),e=e(),se(),e),Re=Me(()=>p("div",{class:"Footer"},"Runs completed in selected week",-1)),Be={class:"Topper relative"},Pe={key:0},Te=W({__name:"RunsCompletedCount",setup(e){let s=m(1e5),n=m(!1);const _=ee().state.data,h=M=>{s.value=0,n.value=!0;var T=_.apiUrl;z.get(`${T}/Stats/RunCount?weekId=${M}`).then(H=>{n.value=!1,s.value=H.data}).catch(H=>{n.value=!1,console.log(H)})},u=F(()=>_.SelectedPeriode),y=F(()=>I(s.value).format("0,0"));return L(u,M=>{h(u.value)}),te(()=>{h(u.value)}),(M,T)=>(D(),U("div",null,[Re,G(ue,{dark:""}),p("div",Be,[C(n)?(D(),Z(fe,{key:1,class:"absolute-center",style:{color:"rgb(161, 161, 161)"},size:50})):(D(),U("h2",Pe,V(C(y)),1))]),G(ue,{dark:""}),G(_e,{hidePictures:!0})]))}});var Oe=J(Te,[["__scopeId","data-v-6290eb72"]]);const Ue={components:{apexchart:q},props:["data"],data(){return{chartOptions:{chart:{foreColor:"#a1a1a1",stacked:!0,toolbar:{show:!0},zoom:{enabled:!0}},dataLabels:{style:{},formatter:function(e,s){return s.name?s.name:I(e).format("0.0a")}},yaxis:{labels:{formatter:function(e){return I(e).format("0,0")}},title:{text:"Runs completed"}},xaxis:{labels:{formatter:function(e){return I(e).format("0,0")}}},plotOptions:{bar:{horizontal:!0}},fill:{opacity:1}}}},methods:{...me(["AddAffixDetails"]),GetAffixdetail(e){if(this.GetAffixes)for(let s=0;s<this.GetAffixes.length;s++){const n=this.GetAffixes[s];if(n.id===e)return n}},GetAffixSetName(e){if(e){var s=[];for(let t=0;t<e.length;t++){const _=e[t];var n=this.GetAffixdetail(_);n&&s.push(n.name)}return s.join(", ")}},fetchAffixDetails(e){var s=this,n=this.$store.state.data.apiUrl;z.get(`${n}/Periode/id?Period=${e}`).then(t=>{if(t.data){var _=t.data;_.details=s.GetAffixdetail(e),s.AddAffixDetails(t.data)}})}},computed:{...pe(["GetPeriodes","GetAffixes","GetAffixDetails"]),calculateHeight(){return 100+this.calculateTotal.length*35},calculateTotal(){var e=[];for(let _=0;_<this.data.length;_++){const h=this.data[_].list;var s={week:h[0].periode,created:h[0].created,runs:0,score:0,onTimeRuns:0},n=this.GetAffixDetails.filter(u=>u.id==s.week);n.length!=0?s.affix=n[0]:this.fetchAffixDetails(s.week);for(let u=0;u<h.length;u++){const y=h[u];s.runs+=y.runs,s.onTimeRuns+=Math.round(y.runs*(y.success_rate/100)),s.score+=y.score}e.push(s)}var t=A._sortBy(e,"week");return t},generateSeries(){var e=[];for(let n=0;n<this.calculateTotal.length;n++){const t=this.calculateTotal[n];var s={x:t.week,y:[t.runs+t.onTimeRuns],o:t.affix};t.affix&&(s.name=this.GetAffixSetName(t.affix.affixes)),e.push(s)}return[{name:"Runs completed",data:e}]}}},He={key:0},Ee={id:"chart"};function Ne(e,s,n,t,_,h){const u=he("apexchart");return n.data?(D(),U("div",He,[p("div",Ee,[G(u,{type:"line",height:300,options:_.chartOptions,series:h.generateSeries},null,8,["options","series"])])])):N("",!0)}var Ve=J(Ue,[["render",Ne]]);const j=e=>(ae("data-v-6d95b37d"),e=e(),se(),e),Fe={class:"flex-center Centertext HeaderFont"},je=j(()=>p("br",null,null,-1)),Le=j(()=>p("h4",null,"Keys per hour",-1)),ze=j(()=>p("h4",null,"Keys per day",-1)),Ke=j(()=>p("br",null,null,-1)),Qe=j(()=>p("br",null,null,-1)),qe=j(()=>p("br",null,null,-1)),Ie=j(()=>p("br",null,null,-1)),Je=W({__name:"runs",setup(e){const s=m(null),n=m(0),t=m(!1),_=m(!1),h=m([]),u=m(24),y=m([]),M=m([{label:"World",value:"world"},{label:"USA",value:"us"},{label:"Europa",value:"eu"},{label:"Taiwan",value:"tw"},{label:"Korea",value:"kr"}]),T=m(["world"]),K=ee().state.data;F(()=>K.settings);const Q=()=>{var o=[];return h.value.forEach(i=>{var d=[];A._sortBy(i.data,"time").slice(Math.max(i.data.length-u.value,1)).forEach($=>{d.push($.value)});var f=i.region;for(let $=0;$<M.value.length;$++){const P=M.value[$];P.value==i.region&&(f=P.label)}var R={name:f,data:d};o.push(R)}),o},E=()=>{var o=[];if(h.value[0]!=null){var i=h.value[0];A._sortBy(i.data,"time").slice(Math.max(i.data.length-u.value,1)).forEach(f=>{o.push(A.GetMoment(f.time).format("HH:MM"))})}return{chart:{id:"perHourChart"},yaxis:{labels:{style:{colors:o.map(f=>"rgb(161, 161, 161)")}}},xaxis:{labels:{style:{colors:o.map(f=>"rgb(161, 161, 161)")}},categories:o}}},w=()=>{var o=[];return y.value.forEach(i=>{var d=[];A._sortBy(i.data,"time").forEach($=>{d.push($.value)});var f=i.region;for(let $=0;$<M.value.length;$++){const P=M.value[$];P.value==i.region&&(f=P.label)}var R={name:f,data:d};o.push(R)}),o},S=()=>{var o=[];if(y.value[0]!=null){var i=y.value[0];A._sortBy(i.data,"time").forEach(f=>{o.push(A.GetMoment(f.time).format("dddd"))})}return{chart:{id:"perDayChart"},yaxis:{labels:{style:{colors:o.map(f=>"rgb(161, 161, 161)")}}},xaxis:{labels:{style:{colors:o.map(f=>"rgb(161, 161, 161)")}},categories:o}}},k=o=>{var i=K.apiUrl,d=i+"/RunsPer/Hours?hours=24";o!="world"&&(d+="&region="+o),_.value=!0,z.get(d).then(function(f){h.value.push({region:o,data:f.data}),_.value=!1,n.value+=1}).catch(function(f){console.log(f),t.value=!0,_.value=!1});var d=i+"/RunsPer/Days?days=7";o!="world"&&(d+="&region="+o),_.value=!0,z.get(d).then(function(f){y.value.push({region:o,data:f.data}),_.value=!1,n.value+=1}).catch(function(f){console.log(f),t.value=!0,_.value=!1})};return L(T,(o,i)=>{var d=A.whatChanged(o,i);if(d.type=="added")k(d.value);else if(d.type=="removed"){var f=!1;h.value.forEach(R=>{R.region==d.value&&A.remove(h.value,R)}),y.value.forEach(R=>{R.region==d.value&&A.remove(y.value,R)}),f&&(n.value+=Math.random()),n.value+=Math.random(),setTimeout(()=>{n.value+=Math.random()},500)}}),te(()=>{k("world")}),(o,i)=>(D(),U("div",Fe,[G(Oe),G(xe),je,G(ce,{color:"secondary",type:"checkbox",modelValue:T.value,"onUpdate:modelValue":i[0]||(i[0]=d=>T.value=d),inline:"",options:M.value},null,8,["modelValue","options"]),Le,G(C(q),{width:"100%",height:"300px",type:"line",options:E(),series:Q()},null,8,["options","series"]),ze,G(C(q),{width:"100%",height:"300px",type:"line",options:S(),series:w()},null,8,["options","series"]),p("div",null,[Ke,Qe,G(De,{onFetch:i[1]||(i[1]=d=>s.value=d)}),qe,G(Ve,{data:s.value},null,8,["data"]),Ie])]))}});var lt=J(Je,[["__scopeId","data-v-6d95b37d"]]);export{lt as default};
