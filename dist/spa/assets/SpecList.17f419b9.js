import{d as oe,B as ne,r as x,u as re,c as p,o as le,w as J,h as n,i as _,m as I,n as R,q as i,p as l,j as o,L as Z,Q as se,ac as _e,l as V,t as b,N as ie,ag as X,ae as ce,z as j,S as m,a as ve,_ as fe,g as pe,M as me,K as ge,F as he,C as Se,bl as ye,s as we}from"./index.cb6acba7.js";import{a as L,Q as Y}from"./QTr.29a2f077.js";import{Q as ae}from"./QTable.1aa9aac0.js";import{Q as be}from"./AffixSelector.bfd85ff5.js";const ke={id:"Main"},xe={key:1,class:"HeaderFont"},Ce=o("br",null,null,-1),De=o("br",null,null,-1),$e=o("div",{class:"flex justify-center HeaderSize4"},[o("div",null,"There is no data for this request, yet...")],-1),Te=[Ce,De,$e],Ie={class:"flex justify-center"},Be={class:"flex justify-center"},Fe={class:"flex justify-center"},Ge={key:0},Ae={key:2},Pe=o("i",{class:"material-icons"},"warning",-1),dt=oe({__name:"SpecTableView",props:{dungeon:{type:Number}},setup(C){const B=C,{dungeon:v}=ne(B);let S=x([]),h=x(!1),G=x(!1),r=x(null),F=x({rowsPerPage:10,page:1,sortBy:"role",descending:!1});x({rowsPerPage:12,page:1,sortBy:"ascore",descending:!0});let E=x({rowsPerPage:99,page:1,sortBy:"ascore",descending:!0}),W=x([{name:"role",label:"",field:e=>e.field,align:"left"}]),K=x([{name:"name",label:"Name",field:e=>{var a,t;return`${(a=e.details)==null?void 0:a.name} ${(t=e.class)==null?void 0:t.name}`},sortable:!0,align:"left"},{name:"runs",label:"Amount of runs",field:e=>e.runs,sortable:!0,align:"center"},{name:"tscore",label:"Total Score",field:e=>e.tscore,sortable:!0,align:"center"},{name:"ascore",label:"Average score",field:e=>e.ascore,sortable:!0,align:"center"},{name:"intime_rate",label:"Success rate",field:e=>D(e.spec).ontime_percent||0,sortable:!0,align:"center"}]);const H=re(),y=H.state.data,z=p(()=>y.Spec_Data),k=p(()=>y.Specs),N=y.Classes,q=y.Spec_Dungeon_Data;y.Dungeons_Data;const M=p(()=>y.SelectedPeriode),A=y.settings,w=p(()=>{var e=["view","name","runs","tscore","ascore"];return v.value||e.push("intime_rate"),e});location.pathname.includes("/specs");const c=y,u=e=>H.dispatch("fetchSpecData",e),D=e=>{if(S.value)for(let a=0;a<S.value.length;a++){const t=S.value[a];if(t.id==e)return t}return!1},f=()=>{var e=m.groupBy([...z.value.data],"role");if(v.value){var a=[...q.filter(T=>T.dungeon===v.value&&M.value===T.periode&&T.created>c.Reloaded_Timestamp)];e=m.groupBy(m._sortBy(a,"created").reverse()[0].data,"role")}var t=[];for(var s in e)t.push({role:s,list:e[s],expand:!0});for(let T=0;T<t.length;T++){const Q=t[T];var $=[];for(var P in Q.list){var g={...Q.list[P]};g.tscore=g.score,g.truns=ue(Q.list),g.ascore=U(g.tscore,"mean",O(Q.list),g.runs),g.pscore=U(g.tscore,"percent",O(Q.list),g.runs),$.push(g)}Q.list=$}r.value=t},d=()=>{h.value=!0;var e=y.apiUrl;ve.get(e+"/Spec/ontimerate?periode="+M.value+"&min_level="+A.min_keystonelevel+"&amount="+A.max_runs+"&limitToLowestDungeon="+A.limitbylowestdungeon).then(function(a){S.value=a.data,h.value=!1}).catch(function(a){console.log(a),a.value=!0,h.value=!1})},U=(e,a,t,s)=>m.GetPoints(e,a,t,s),O=e=>{var a=0;for(let t=0;t<e.length;t++)a+=e[t].score;return a},ue=e=>{var a=0;for(let t=0;t<e.length;t++)a+=e[t].runs;return a},de=(e,a)=>{for(let t=0;t<r.value.length;t++){const s=r.value[t];if(s.role.toLowerCase()===e.toLowerCase())if(a)for(let $=0;$<s.list.length;$++){const P=s.list[$];if(P.id==a)return P}else return s}},ee=e=>{if(N)for(let a=0;a<N.length;a++){const t=N[a];if(t.id==e)return t}},te=e=>{if(k.value)for(let a=0;a<k.value.length;a++){const t=k.value[a];if(t.id==e)return t}};return le(()=>{v.value?u({id:v.value}):M.value&&(z.value?f():u(),d())}),J(z,()=>{v.value||f()}),J(M,()=>{r.value=null,G.value=!1,d()}),J(q,()=>{f()}),(e,a)=>(n(),_("div",ke,[I(r)==null?(n(),R(X,{key:0,class:"absolute-center",style:{color:"rgb(161, 161, 161)"},size:"200"})):I(r).length==0?(n(),_("div",xe,Te)):I(r).length!=0?(n(),R(ae,{key:2,"rows-per-page-options":[],"card-class":"background HeaderFont","table-class":"HeaderFont","table-header-class":"HeaderFont",dark:"",flat:"",rows:I(r),columns:I(W),pagination:I(F),"hide-bottom":"","hide-header":"","row-key":"role"},{body:i(t=>[l(Y,{props:t},{default:i(()=>[l(L,{key:"role",props:t},{default:i(()=>[o("div",Ie,[o("div",Be,[l(Z,{url:`roles/${t.row.role.toLowerCase()}.png`},{default:i(({link:s})=>[l(se,{id:"roleImage","spinner-size":"15px","spinner-color":"white",src:s},null,8,["src"])]),_:2},1032,["url"])]),o("div",Fe,[l(_e,{dense:"",round:"",flat:"",icon:t.expand?"arrow_drop_down":"arrow_drop_up",onClick:s=>t.expand=!t.expand},null,8,["icon","onClick"])])])]),_:2},1032,["props"])]),_:2},1032,["props"]),t.expand?j("",!0):(n(),R(Y,{key:0,class:"hideHoverGlobal",props:t},{default:i(()=>[l(L,{colspan:"100%"},{default:i(()=>[l(ae,{"rows-per-page-options":[],"card-class":"background HeaderFont","table-class":"HeaderFont","table-header-class":"HeaderFont",dark:"",dense:"",flat:"",rows:t.row.list,columns:I(K),pagination:I(E),"hide-bottom":"","row-key":"spec","visible-columns":w.value},{body:i(s=>[l(Y,{props:s},{default:i(()=>[l(L,{key:"name",props:s},{default:i(()=>{var $,P,g;return[o("div",{style:ie(`color: ${($=ee(s.row.class_id))==null?void 0:$.color};`),class:"flex justify-start align-items-start gap-5"},[l(Z,{url:te(s.row.spec).icon_url},{default:i(({link:T})=>[l(se,{"spinner-size":"15px","spinner-color":"white",class:"tableIcon",src:T},null,8,["src"])]),_:2},1032,["url"]),V(" "+b(`${(P=te(s.row.spec))==null?void 0:P.name} ${(g=ee(s.row.class_id))==null?void 0:g.name}`),1)],4)]}),_:2},1032,["props"]),l(L,{key:"runs",props:s},{default:i(()=>[V(b(s.row.runs)+" ("+b(Math.round(s.row.runs/s.row.truns*1e4)/100)+"%)",1)]),_:2},1032,["props"]),l(L,{key:"tscore",props:s},{default:i(()=>[V(b(Math.round(s.row.score))+" ("+b(U(s.row.score,"percent",O(de(s.row.role).list),s.row.runs))+"%)",1)]),_:2},1032,["props"]),l(L,{key:"ascore",props:s},{default:i(()=>[V(b(U(s.row.score,"mean",0,s.row.runs)),1)]),_:2},1032,["props"]),l(L,{key:"intime_rate",props:s},{default:i(()=>[D(s.row.spec)?(n(),_("div",Ge,b(Math.round(D(s.row.spec).ontime_percent*10)/10)+"%",1)):I(h)?(n(),R(X,{key:1,size:"15"})):(n(),_("div",Ae,[Pe,l(ce,null,{default:i(()=>[V("Success rate is generated separately. Could not get the data")]),_:1})]))]),_:2},1032,["props"])]),_:2},1032,["props"])]),_:2},1032,["rows","columns","pagination","visible-columns"])]),_:2},1024)]),_:2},1032,["props"]))]),_:1},8,["rows","columns","pagination"])):(n(),R(X,{key:3,class:"absolute-center",style:{color:"rgb(161, 161, 161)"},size:"200"}))]))}});const Le={components:{CloudinaryFormat:Z},props:["SpecItem","ClassItem"],data(){return{}},methods:{GetPoints(C){var B=String(C/1e3).substring(0,4);return B.includes(".")&&(B=String(C/1e3).substring(0,5)),B},isEven(C){return C%2==0}},computed:{Settings(){return this.$store.state.data.settings},TopBack(){return this.SpecItem.class.name.toLowerCase()=="rouge"||this.SpecItem.class.name.toLowerCase()=="priest"||this.SpecItem.class.name.toLowerCase()=="hunter"||this.SpecItem.class.name.toLowerCase()=="warrior"||this.SpecItem.class.name.toLowerCase()=="paladin"?!0:this.SpecItem.class.name.toLowerCase()=="mage"}}},He={class:"SpecViewWindowMAIN"},Me={class:"DarkerGreyOverlay"},Qe={class:"absolute-center"},Re={class:"flex flex-center"},Ve={class:"SpecTextCover"},ze={class:"absolute-left"},Ne={class:"Ccenter",style:{"margin-left":"27px"}},je={class:"flex flex-center rankBoxSpec"},Ee={class:"absolute-right"},We={class:"Ccenter",style:{"margin-right":"25px"}},qe={id:"points",class:"flex SpecTextCover flex-center"},Ue={class:"flex"},Ke={key:0};function Oe(C,B,v,S,h,G){const r=pe("CloudinaryFormat");return n(),_("div",He,[l(r,{url:`classes/${v.SpecItem.class.name.replace(" ","-")}.jpg`},{default:i(({link:F})=>[o("div",{class:me(["SpecViewWindow SpecMaxWidth absolute-center",{TopBack:G.TopBack}]),style:ie({"background-image":`url(${F})`})},[o("div",Me,[o("div",Qe,[o("div",Re,[o("div",Ve,b(v.SpecItem.details.name+" "+v.SpecItem.class.name),1)])]),o("div",ze,[o("div",Ne,[o("div",je,[o("div",null,b(v.SpecItem.rank),1)])])]),o("div",Ee,[o("div",We,[o("div",qe,[o("div",Ue,[o("div",null,b(v.SpecItem.display_score),1),G.Settings.score_type==="percent"?(n(),_("div",Ke,"%")):j("",!0)]),l(ce,null,{default:i(()=>[V(" Runs: "+b(v.SpecItem.runs),1)]),_:1})])])])])],6)]),_:1},8,["url"])])}var Je=fe(Le,[["render",Oe]]);const Xe={key:0,class:"flex flex-center"},Ye={key:1},Ze={key:0,class:"HeaderFont nodataInfo"},et=o("h4",{class:"flex flex-center"},"No data found!",-1),tt=o("p",{class:"flex flex-center"},"Try to change the settings up in the right",-1),st=[et,tt],at={key:1},ot=ye('<br><div class="flex flex-center"><div style="width:100%;" class="SpecMaxWidth HeaderFont relative-position"><div class="absolute-left" style="margin-left:25px;"><div>Rank</div></div><div class="absolute-right" style="margin-right:25px;"><div>Score</div></div><div class="absolute-center"><div>Name</div></div></div></div><br><br>',4),nt={class:"flex justify-around HeaderFont"},rt={class:"flex flex-center"},_t=oe({__name:"SpecList",props:{Selected:{},dungeon:{}},setup(C){const B=C,{Selected:v,dungeon:S}=ne(B),h=x(!1),G=re(),r=G.state.data,F=p(()=>r.Spec_Data),E=p(()=>r.Specs),W=p(()=>r.Classes),K=p(()=>r.Spec_Dungeon_Data);p(()=>r.Dungeons_Data);const H=p(()=>r.SelectedPeriode),y=p(()=>r.settings),z=p(()=>r.Reloaded_Timestamp),k=p(()=>{var u,D,f;var w=[...(D=(u=F.value)==null?void 0:u.data)!=null?D:[]].map(d=>({...d}));if(S.value){var c=m._sortBy([...(f=K.value)!=null?f:[]].map(d=>({...d})).filter(d=>d.dungeon===S.value&&H.value===d.periode&&d.created>z.value),"created").reverse()[0];if(c)return m.AddClassToSpecs(c.data,W.value),m.AddSpecDetailsToSpec(c.data,E.value),c}else if(!S.value)return F.value&&F.value.data&&(m.AddClassToSpecs(w,W.value),m.AddSpecDetailsToSpec(w,E.value)),{...F.value,data:w}}),N=ge(),q=p(()=>N.currentRoute.value.path.includes("/specs")),M=w=>G.dispatch("fetchSpecData",w),A=w=>{if(k.value){var c=we.toArray(m.groupBy(k.value.data,"role")[w]),u=m.groupBy(k.value.data,"role")[w],D=0;if(u)for(let f=0;f<u.length;f++)D+=u[f].score;for(let f=0;f<c.length;f++){const d=c[f];d.display_score=m.GetPoints(d.score,y.value.score_type,D,d.runs)}return m.getListWithRank(m._sortBy(c,"display_score"))}};return le(()=>{q.value&&(h.value=!0),S.value&&!k.value&&M({id:S.value})}),(w,c)=>(n(),_("div",null,[H.value&&k.value&&H.value!=k.value.periode||!A("DAMAGE")?(n(),_("div",Xe,[l(be,{style:{color:"rgb(161, 161, 161)"},size:"500"})])):(n(),_("div",Ye,[A("DAMAGE").length===0?(n(),_("div",Ze,st)):(n(),_("div",at,[ot,o("div",nt,[(n(!0),_(he,null,Se(A("DAMAGE"),u=>(n(),_("div",{style:{width:"100%"},key:u.id},[u.rank<11||h.value?(n(),R(Je,{key:0,SpecItem:u},null,8,["SpecItem"])):j("",!0)]))),128))]),o("div",rt,[h.value?j("",!0):(n(),_("div",{key:0,onClick:c[0]||(c[0]=u=>h.value=!0),id:"SpecShowerShowAllbtn",class:"HeaderFont"},"Show all")),h.value?(n(),_("div",{key:1,onClick:c[1]||(c[1]=u=>h.value=!1),id:"SpecShowerShowAllbtn",class:"HeaderFont"},"Show less")):j("",!0)])]))]))]))}});export{dt as _,_t as a};
