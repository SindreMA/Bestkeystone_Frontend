import{d as Z,B as _e,u as ie,c as M,r as y,w as I,h as s,i as x,p as a,q as n,n as R,L as X,Q as Y,b3 as N,b4 as Q,b5 as U,b6 as G,b7 as E,m as v,ab as re,_ as F,z as J,y as he,l as S,t as $,K as we,e as Pe,f as Ve,g as Se,j as d,aB as H,b8 as $e,ac as q,F as ne,C as oe,N as Re,ae as Ce,O as Ie,S as W,a as Te,v as Be,x as Le}from"./index.326ea565.js";import{a as ze}from"./QCheckbox.231b7602.js";import{Q as me,a as z}from"./QTr.e1e722a0.js";import{Q as He}from"./QTable.dabdb8d3.js";import{P as Me}from"./PeriodeSelector.70606daa.js";import{P as Ne,_ as ve}from"./PlayerText.0ea9bae1.js";import{a as ce}from"./index.56a95922.js";import{k as Qe}from"./keystoneView.d93cee4d.js";import"./QMarkupTable.533909ff.js";import"./use-cache.b0833c75.js";import"./QInput.873a83cc.js";import"./numeral.ee468340.js";const Ae={id:"mainDiv"},Ue=Z({__name:"dungeonSelector",props:{filled:{type:Boolean},withImages:{type:Boolean},season:{type:Object}},emits:["update:modelValue","change","delete"],setup(w,{emit:k}){const g=w,{filled:h,withImages:_,season:c}=_e(g),P=ie().state.data,T=M(()=>P.Dungeons),p=y(null);return I(p,()=>k("update:modelValue",p.value)),(A,u)=>{var r;return s(),x("div",Ae,[a(re,{dark:"",modelValue:p.value,"onUpdate:modelValue":u[0]||(u[0]=i=>p.value=i),options:(r=T.value)==null?void 0:r.filter(i=>{var V,B;return i.seasons.includes((B=(V=v(c))==null?void 0:V.season)==null?void 0:B.id)}),"hide-bottom-space":"",borderless:"",clearable:"",filled:v(h)},{selected:n(i=>[p.value?(s(),R(E,U({key:0},i==null?void 0:i.itemProps,G(i==null?void 0:i.itemEvents)),{default:n(()=>{var V;return[a(X,{url:(V=p.value)==null?void 0:V.imageurl},{default:n(({link:B})=>[a(Y,{class:"dungeonImg","spinner-size":"5px",src:B},null,8,["src"])]),_:1},8,["url"]),a(N,null,{default:n(()=>[a(Q,{innerHTML:p.value.name.replace("Operation: ","")},null,8,["innerHTML"])]),_:1})]}),_:2},1040)):(s(),R(N,{key:1},{default:n(()=>[a(Q,{innerHTML:"All"})]),_:1}))]),option:n(i=>[a(E,U(i.itemProps,G(i==null?void 0:i.itemEvents)),{default:n(()=>{var V;return[a(X,{url:(V=i.opt)==null?void 0:V.imageurl},{default:n(({link:B})=>[a(Y,{class:"dungeonImg",src:B},null,8,["src"])]),_:2},1032,["url"]),a(N,null,{default:n(()=>[a(Q,{innerHTML:i.opt.name.replace("Operation: ","")},null,8,["innerHTML"])]),_:2},1024)]}),_:2},1040)]),_:1},8,["modelValue","options","filled"])])}}});var Ge=F(Ue,[["__scopeId","data-v-d0c2b4be"]]);const Ee={id:"mainDivSel"},De=Z({__name:"affixSelector",props:{filled:{type:Boolean},level:{type:Number}},emits:["update:modelValue"],setup(w,{emit:k}){const g=w,{filled:h,level:_}=_e(g),c=y(null),P=ie().state.data,T=M(()=>P.Affixes);return I(c,()=>{k("update:modelValue",c.value)}),(p,A)=>(s(),x("div",Ee,[T.value?(s(),R(re,{key:0,dark:"",modelValue:c.value,"onUpdate:modelValue":A[0]||(A[0]=u=>c.value=u),options:T.value.filter(u=>u.starting_level==v(_)),"hide-bottom-space":"",borderless:"",clearable:"",filled:v(h)},{selected:n(u=>[c.value?(s(),R(E,U({key:0},u==null?void 0:u.itemProps,G(u==null?void 0:u.itemEvents)),{default:n(()=>[a(ce,{class:"affixImg",size:"10px",affixid:c.value.id},null,8,["affixid"])]),_:2},1040)):(s(),R(N,{key:1},{default:n(()=>[a(Q,{innerHTML:"Any"})]),_:1}))]),option:n(u=>[a(E,U(u.itemProps,G(u.selected)),{default:n(()=>[a(ce,{class:"affixImg",size:"8px",affixid:u.opt.id},null,8,["affixid"]),a(N,null,{default:n(()=>[a(Q,{innerHTML:u.opt.name},null,8,["innerHTML"])]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","options","filled"])):J("",!0)]))}});var se=F(De,[["__scopeId","data-v-4906d156"]]);const je={props:["filled","rounded","input"],data(){return{region:null}},methods:{setRegion(w){if(this.GetRegions)for(let k=0;k<this.GetRegions.length;k++){const g=this.GetRegions[k];g==w&&(this.region=g)}}},computed:{...he(["GetRegions"])},watch:{region(){this.$emit("change",this.region)},GetRegions(){this.input&&this.setRegion(this.input)}},created(){this.input&&this.setRegion(this.input)}},Fe={id:"mainDiv"};function Ke(w,k,g,h,_,c){return s(),x("div",Fe,[a(re,{dark:"",dense:"",modelValue:_.region,"onUpdate:modelValue":k[0]||(k[0]=m=>_.region=m),options:w.GetRegions,borderless:"",clearable:"",rounded:g.rounded,outlined:g.filled},{selected:n(m=>[_.region?(s(),R(E,U({key:0},m.itemProps,G(m.itemEvents)),{default:n(()=>[S($(_.region.toUpperCase()),1)]),_:2},1040)):(s(),R(N,{key:1},{default:n(()=>[a(Q,{innerHTML:"Any"})]),_:1}))]),option:n(m=>[a(E,U(m.itemProps,G(m.itemEvents)),{default:n(()=>[a(N,null,{default:n(()=>[a(Q,{innerHTML:m.opt},null,8,["innerHTML"])]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","options","rounded","outlined"])])}var Oe=F(je,[["render",Ke],["__scopeId","data-v-25ba131c"]]);const qe={class:"HeaderFont"},We={id:"filterMenu",class:"flex justify-between"},Je={class:"text-center"},Xe={class:"relative"},Ye={class:"absolute upperButtons"},Ze={key:0,class:"flex"},el={class:"flex justify-around"},ll={key:0},al={key:1},tl={class:"flex justify-around"},nl={class:"flex"},ol={class:"flex justify-between"},sl=["href"],il=["href"],rl={class:"flex"},ul=Z({__name:"keystoneLeaderboard",setup(w){const k=M(()=>V.value.map(l=>l.name).filter(l=>{var t=!0;return _.value&&l=="zone"&&(t=!1),t}));let g=y([]),h=y(null),_=y(null),c=y(null),m=y(null),P=y(null),T=y(null),p=y(null),A=y(k),u=y(null),r=y({rowsPerPage:20,page:1,sortBy:"rank",rowsNumber:12}),i=y(!1);const V=y([{name:"rank",label:"Rank",sortable:!1,field:l=>l,align:"left"},{name:"zone",label:"Dungeon",sortable:!1,field:l=>l,align:"left"},{name:"level",label:"Level",sortable:!1,field:l=>l,align:"left"},{name:"time",label:"Time",sortable:!1,field:l=>l,align:"left"},{name:"affixes",label:"Affixes",sortable:!1,field:l=>l,align:"left"},{name:"players",label:"Players",sortable:!1,field:l=>l,align:"left"},{name:"score",label:"Score",sortable:!1,field:l=>l,align:"center"}]),B=we(),D=M(()=>B.currentRoute.value.query),ee=M(()=>te.Specs),le=M(()=>te.Classes);Pe();const C=l=>{l.pagination,i.value=!0,ke(l.pagination)},ge=l=>{if(le.value)for(let t=0;t<le.value.length;t++){const f=le.value[t];if(f.id==l)return f}},pe=l=>{var t=l.time.clear_time/l.time.map_time;return t<=.6?3:t<=.8?2:t<=1?1:0},be=l=>Ie.duration(l).format("hh:mm:ss"),ye=l=>{var t;return(t=ae(l))==null?void 0:t.role},xe=l=>ae(l).role=="TANK"?1e4+l:ae(l).role=="HEALER"?2e4+l:3e4+l,ae=l=>{if(!ee.value)return null;for(let t=0;t<ee.value.length;t++){const f=ee.value[t];if(l==f.id)return f}},ue=l=>{l.forEach(f=>{f.sortNR=xe(f.spec),f.role=ye(f.spec)});var t=W._sortBy(l,"sortNR");for(const f in W.groupBy(t,"role"))if(W.groupBy(t,"role").hasOwnProperty(f)){const e=W.groupBy(t,"role")[f];e[0].showIcon=!0}return t},te=ie().state.data,ke=l=>{var j,K,de,fe;l&&(l.page&&(r.value.page=l.page),l.rowsPerPage&&(r.value.rowsPerPage=l.rowsPerPage),l.sortBy&&(r.value.sortBy=l.sortBy));var{page:t,rowsPerPage:f,sortBy:e}=r.value,o=te.apiUrl,b=`/KeystoneRun/leaderboard?from=${(t-1)*f}&amount=${f}&seasonId=${((K=(j=h.value)==null?void 0:j.season)==null?void 0:K.id)===6?5:(fe=(de=h.value)==null?void 0:de.season)==null?void 0:fe.id}`;_.value&&(b+=`&zone=${_.value.keystone_id}`),c.value&&(b+=`&affix1=${c.value.id}`),m.value&&(b+=`&affix2=${m.value.id}`),P.value&&(b+=`&affix3=${P.value.id}`),T.value&&(b+=`&affix4=${T.value.id}`),p.value&&(b+=`&region=${p.value}`),u.value&&(b+=`&faction=${u.value}`),Te.get(`${o}${b}`).then(O=>{r.value.rowsNumber=O.data.maxRows,g.value=O.data.list,r.value.page=t+1,r.value.rowsPerPage=f,r.value.sortBy=e,A.value=k.value,i.value=!1}).catch(O=>{console.log("Error",O)})},L=M(()=>{var l={pagination:{rowsNumber:0,rowsPerPage:r.value.rowsPerPage,page:r.value.page,sortBy:r.value.sortBy}};return r.value.rowsNumber&&(l.pagination.rowsNumber=r.value.rowsNumber),l});return I(c,()=>{C(L.value)}),I(m,()=>{C(L.value)}),I(P,()=>{C(L.value)}),I(T,()=>{C(L.value)}),I(p,()=>{C(L.value)}),I(h,()=>{C(L.value)}),I(_,()=>{C(L.value)}),Ve(()=>{D.value.page&&(r.value.page=D.value.page),D.value.rows&&(r.value.rowsPerPage=D.value.rows),h.value&&C(L.value)}),(l,t)=>{const f=Se("Affix");return s(),x("div",qe,[d("div",We,[d("div",null,[S(" Dungeon "),a(Ge,{widthImage:!0,season:v(h),modelValue:v(_),"onUpdate:modelValue":t[0]||(t[0]=e=>H(_)?_.value=e:_=e),filled:""},null,8,["season","modelValue"])]),d("div",null,[S(" Season "),a(Me,{onlySeasons:!0,modelValue:v(h),"onUpdate:modelValue":t[1]||(t[1]=e=>H(h)?h.value=e:h=e),filled:"",region:"us"},null,8,["modelValue"])]),d("div",null,[S(" Affix level 2 "),a(se,{modelValue:v(c),"onUpdate:modelValue":t[2]||(t[2]=e=>H(c)?c.value=e:c=e),level:2,filled:""},null,8,["modelValue"])]),d("div",null,[S(" Affix level 4 "),a(se,{modelValue:v(m),"onUpdate:modelValue":t[3]||(t[3]=e=>H(m)?m.value=e:m=e),level:4,filled:""},null,8,["modelValue"])]),d("div",null,[S(" Affix level 7 "),a(se,{modelValue:v(P),"onUpdate:modelValue":t[4]||(t[4]=e=>H(P)?P.value=e:P=e),level:7,filled:""},null,8,["modelValue"])])]),a(He,{title:"Keystone leaderboard",rows:v(g),columns:V.value,pagination:v(r),"onUpdate:pagination":t[6]||(t[6]=e=>H(r)?r.value=e:r=e),"rows-per-page-options":[10,20,50,100,500],"row-key":"rank",dark:"",class:"tableMinSize",onRequest:C,loading:v(i),color:"amber","visible-columns":v(A)},$e({"top-right":n(e=>[d("div",Je,[S(" Region "),a(Oe,{rounded:!0,input:D.value.region,filled:!0,onChange:t[5]||(t[5]=o=>H(p)?p.value=o:p=o)},null,8,["input"]),d("div",Xe,[d("div",Ye,[v(i)?J("",!0):(s(),x("div",Ze,[a(q,{round:"",dense:"",disable:e.pagination.page<=1,onClick:o=>e.prevPage(),icon:"keyboard_arrow_left"},null,8,["disable","onClick"]),a(q,{round:"",dense:"",disable:e.pagination.page*e.pagination.rowsPerPage<v(g).maxRows,onClick:o=>e.nextPage(),icon:"keyboard_arrow_right"},null,8,["disable","onClick"])]))])])])]),body:n(e=>[a(me,{props:e,onClick:o=>e.expand=!e.expand},{default:n(()=>[a(z,{key:"rank"},{default:n(()=>[a(X,{url:`factions/${e.row.faction.toLowerCase()}.png`},{default:n(({link:o})=>[d("div",el,[a(Y,{"spinner-size":"10px",class:"factionIconSize","spinner-color":"white",src:o},null,8,["src"]),S(" "+$(e.row.rank),1)])]),_:2},1032,["url"])]),_:2},1024),a(z,{key:"zone",props:e},{default:n(()=>[e.row.zone.short_name?(s(),x("div",ll,$(e.row.zone.short_name),1)):(s(),x("div",al,$(e.row.zone.name),1))]),_:2},1032,["props"]),a(z,{key:"level",props:e},{default:n(()=>[d("div",tl,[S(" +"+$(e.row.level)+" ",1),(s(!0),x(ne,null,oe(pe(e.row),(o,b)=>(s(),x("i",{key:b,class:"starIcon material-icons"},"star"))),128))])]),_:2},1032,["props"]),a(z,{key:"time",props:e},{default:n(()=>[S($(be(e.row.time.clear_time)),1)]),_:2},1032,["props"]),a(z,{key:"affixes",props:e},{default:n(()=>[d("div",nl,[(s(!0),x(ne,null,oe(e.row.affixes,(o,b)=>(s(),R(f,{affixid:o,tooltip:!0,key:b},null,8,["affixid"]))),128))])]),_:2},1032,["props"]),a(z,{key:"players",props:e},{default:n(()=>[d("div",ol,[(s(!0),x(ne,null,oe(ue(e.row.players),(o,b)=>{var j;return s(),x("div",{style:Re(`color: ${(j=ge(o==null?void 0:o.class))==null?void 0:j.color};`),class:"flex justify-center",key:b},[a(Ne,{player:o,region:e.row.region},{default:n(()=>[a(X,{url:`roles/${o.role}.png`},{default:n(({link:K})=>[o.showIcon?(s(),R(Y,{key:0,"spinner-size":"5px",id:"roleImage",src:K},null,8,["src"])):J("",!0)]),_:2},1032,["url"]),b+1!=ue(e.row.players).length?(s(),x("a",{key:0,href:`/#/lookup?characters=${e.row.region}.${o.realm}.${o.name}`},$(o.name+" "),9,sl)):(s(),x("a",{key:1,href:`/#/lookup?characters=${e.row.region}.${o.realm}.${o.name}`},$(o.name),9,il)),a(Ce,null,{default:n(()=>[d("div",rl,[a(ve,{size:20,text:!0,id:o.spec},null,8,["id"]),a(ve,{size:20,useclass:!0,text:!0,id:o.spec},null,8,["id"])])]),_:2},1024)]),_:2},1032,["player","region"])],4)}),128))])]),_:2},1032,["props"]),a(z,{key:"score",props:e},{default:n(()=>[S($(Math.round(e.row.score*10)/10),1)]),_:2},1032,["props"])]),_:2},1032,["props","onClick"]),e.expand?(s(),R(me,{key:0,class:"hideHover",props:e},{default:n(()=>[a(z,{class:"hideHover",colspan:"100%"},{default:n(()=>[a(Qe,{class:"keystoneView",id:e.row.id},null,8,["id"])]),_:2},1024)]),_:2},1032,["props"])):J("",!0)]),_:2},[v(i)?{name:"bottom",fn:n(()=>[a(ze,{indeterminate:"",color:"amber"})]),key:"0"}:{name:"pagination",fn:n(e=>[d("div",{class:"flex"},[d("div",{class:"minorTopMargin"},"Page "+$(e.pagination.page),1),d("div",{class:"flex float-right"},[a(q,{round:"",dense:"",disable:e.pagination.page<=1,onClick:o=>e.prevPage(),icon:"keyboard_arrow_left"},null,8,["disable","onClick"]),a(q,{round:"",dense:"",disable:e.pagination.page*e.pagination.rowsPerPage<v(g).maxRows,onClick:o=>e.nextPage(),icon:"keyboard_arrow_right"},null,8,["disable","onClick"])])])]),key:"1"}]),1032,["rows","columns","pagination","loading","visible-columns"])])}}});var dl=F(ul,[["__scopeId","data-v-0bff14e8"]]);const fl=w=>(Be("data-v-ac46ba1e"),w=w(),Le(),w),ml=fl(()=>d("div",{class:"redText text-center"},[d("div",{class:"HeaderSize3"},"This page is a work in progress"),d("p",null,"The leaderboard might not be 100% correct")],-1)),vl=Z({__name:"keystone",setup(w){return(k,g)=>(s(),x("div",null,[ml,a(dl)]))}});var $l=F(vl,[["__scopeId","data-v-ac46ba1e"]]);export{$l as default};
