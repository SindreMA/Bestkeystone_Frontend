import{a as Pe,Q as Fe}from"./AffixSelector.70556ef8.js";import{D as Be,E as Te,G as Ve,c as D,H as Ce,I as $e,J as _e,_ as te,d as se,r as B,u as ae,e as re,S as H,w as E,o as ge,h as s,i as d,k as h,n as w,ag as oe,q as f,p as o,ac as ve,N as q,m as C,t as g,ae as O,F as T,C as M,aB as ce,bk as J,z as V,a as Z,v as de,x as ue,j as e,B as Ae,az as Me,Q as Ge,L as ze,y as me,g as he,an as Ie,bl as He}from"./index.d11fe415.js";import{a as G,Q as ee}from"./QTr.a8711b58.js";import{a as pe,Q as K,c as xe,b as X}from"./QTabPanels.f4441b25.js";import{Q as ne}from"./QTable.4edb768e.js";import{C as be,_ as ye}from"./ClassTableView.8d13e0f8.js";import{_ as ke,a as De}from"./SpecList.43a715a6.js";import{C as Re,a as we}from"./CompositionTableView.ac8d04f7.js";import{F as Qe}from"./FactionBar.ba68636e.js";import{Q as Se}from"./QRange.a07c222b.js";import{a as Le}from"./index.b967c5e1.js";import"./linq.12a21919.js";import"./use-cache.b0833c75.js";import"./QMarkupTable.d0e5140e.js";import"./QCheckbox.383fd197.js";import"./QInput.a9805111.js";var ie=Be({name:"QCard",props:{...Te,tag:{type:String,default:"div"},square:Boolean,flat:Boolean,bordered:Boolean},setup(t,{slots:a}){const{proxy:{$q:n}}=_e(),_=Ve(t,n),l=D(()=>"q-card"+(_.value===!0?" q-card--dark q-dark":"")+(t.bordered===!0?" q-card--bordered":"")+(t.square===!0?" q-card--square no-border-radius":"")+(t.flat===!0?" q-card--flat no-shadow":""));return()=>Ce(t.tag,{class:l.value},$e(a.default))}});const N=t=>(de("data-v-3ff03607"),t=t(),ue(),t),Ue={id:"Main",class:"relative"},je={key:1,class:"HeaderFont"},We=N(()=>e("br",null,null,-1)),qe=N(()=>e("br",null,null,-1)),Ne=N(()=>e("div",{class:"flex justify-center HeaderSize4"},[e("div",null,"There is no data for this request, yet...")],-1)),Oe=[We,qe,Ne],Ye=N(()=>e("i",{class:"material-icons"},"info",-1)),Ee={key:0},Je={key:2},Ke=N(()=>e("i",{class:"material-icons"},"warning",-1)),Xe=N(()=>e("br",null,null,-1)),Ze=N(()=>e("br",null,null,-1)),et=N(()=>e("br",null,null,-1)),tt=se({__name:"DungeonTableView",setup(t){let a=B("Composition"),n=B([]),_=B(!1),l=B(!1),r=B(null),$=B({rowsPerPage:999,page:1,sortBy:"intime_rate",descending:!0}),i=B([{name:"view",label:"",align:"left",field:m=>m},{name:"dungeon",label:"Dungeon",field:m=>I(m.id),align:"left"},{name:"runs",label:"Amount of runs",field:m=>m.total_runs,sortable:!0,align:"center"},{name:"tscore",label:"Total Score",field:m=>m.tscore,sortable:!0,align:"center"},{name:"ascore",label:"Average score",field:m=>m.ascore,sortable:!0,align:"center"},{name:"intime_rate",label:"Success rate",field:m=>W(m.ingameid).ontime_percent||0,sortable:!0,align:"center"}]);const y=ae().state.data,F=()=>{if(!p.value)return null;_.value=!0;var m=y.apiUrl;Z.get(m+"/Dungeon/ontimerate?periode="+p.value+"&min_level="+c.value.min_keystonelevel+"&amount="+c.value.max_runs+"&limitToLowestDungeon="+c.value.limitbylowestdungeon).then(function(b){n.value=b.data,_.value=!1}).catch(function(b){console.log(b),b.value=!0,_.value=!1})},U=(m,b,u,z)=>H.GetPoints(m,b,u,z),A=m=>{var b=0;for(let u=0;u<m.length;u++)b+=m[u].score;return b},j=()=>{var m=[...Q.value.data],b=[];for(let z=0;z<m.length;z++){var u={...m[z]};u.tscore=u.score,u.ascore=U(u.tscore,"mean",0,u.total_runs),u.pscore=U(u.tscore,"percent",A(m),u.total_runs),u.total_runs!=0&&b.push(u)}r.value=b},W=m=>{if(n.value)for(let b=0;b<n.value.length;b++){const u=n.value[b];if(u.id==m)return u}return!1},I=m=>{if(x.value)for(let b=0;b<x.value.length;b++){const u=x.value[b];if(u.keystone_id==m)return u}},Q=D(()=>y.Dungeons_Data),x=D(()=>y.Dungeons),p=D(()=>y.SelectedPeriode);D(()=>y.Reloaded_Timestamp),D(()=>y.Affixes),D(()=>y.Periodes);const c=D(()=>y.settings),S=re(),P=D(()=>H.GetDefaultView(S.screen.width,c.value)),k=B(null);return E(n,()=>{n.value&&k.value}),E(Q,()=>{Q.value&&j()}),E(p,()=>{r.value=null,l.value=!1,F()}),ge(()=>{p.value&&(Q.value&&j(),F())}),(m,b)=>(s(),d("div",Ue,[h(r)==null?(s(),w(oe,{key:0,class:"absolute-center",style:{color:"rgb(161, 161, 161)"},size:"200"})):h(r).length==0?(s(),d("div",je,Oe)):h(r).length!=0?(s(),w(ne,{key:2,"rows-per-page-options":[],"card-class":"background HeaderFont","table-class":"HeaderFont","table-header-class":"HeaderFont",dark:"",flat:"",rows:h(r),columns:h(i),pagination:h($),"hide-bottom":"","row-key":"ingameid",ref_key:"dungeonTable",ref:k},{body:f(u=>[o(ee,{props:u},{default:f(()=>[o(G,{key:"view",props:u},{default:f(()=>[o(ve,{style:q(`background-size: 150% 150%; background-image: url(${I(u.row.ingameid).imageurl});`),class:"darkOverlay",round:"",flat:"",icon:u.expand?"arrow_drop_up":"arrow_drop_down",onClick:z=>u.expand=!u.expand},null,8,["style","icon","onClick"])]),_:2},1032,["props"]),o(G,{key:"dungeon",props:u},{default:f(()=>[C(g(`${I(u.row.ingameid).name}`),1)]),_:2},1032,["props"]),o(G,{key:"runs",props:u},{default:f(()=>[C(g(u.row.total_runs)+" ",1),Ye,o(O,null,{default:f(()=>[(s(!0),d(T,null,M(u.row.runs,(z,R)=>(s(),d("div",{key:R},g(`${R}: ${z}`),1))),128))]),_:2},1024)]),_:2},1032,["props"]),o(G,{key:"tscore",props:u},{default:f(()=>[C(g(Math.round(u.row.tscore))+" ("+g(u.row.pscore)+"%)",1)]),_:2},1032,["props"]),o(G,{key:"ascore",props:u},{default:f(()=>[C(g(u.row.ascore),1)]),_:2},1032,["props"]),o(G,{key:"intime_rate",props:u},{default:f(()=>[W(u.row.ingameid)?(s(),d("div",Ee,g(Math.round(W(u.row.ingameid).ontime_percent*10)/10)+"%",1)):h(_)?(s(),w(oe,{key:1,size:"15"})):(s(),d("div",Je,[Ke,o(O,null,{default:f(()=>[C("Success rate is generated separately. Could not get the data")]),_:1})]))]),_:2},1032,["props"])]),_:2},1032,["props"]),u.expand?(s(),w(ee,{key:0,class:"hideHover",props:u},{default:f(()=>[o(G,{colspan:"100%",class:"DungeonWindow",style:q(`background-size: 150% 150%; background-image: url(${I(u.row.ingameid).imageurl});`)},{default:f(()=>[Xe,o(ie,{class:"background",style:{opacity:"0.92",padding:"2px 10px 10px 10px"}},{default:f(()=>[o(Qe,{zone:u.row.ingameid},null,8,["zone"])]),_:2},1024),Ze,o(ie,{class:"background",style:{opacity:"0.92"}},{default:f(()=>[o(pe,{modelValue:h(a),"onUpdate:modelValue":b[0]||(b[0]=z=>ce(a)?a.value=z:a=z),animated:"",swipeable:"",class:"HeaderFontv2",align:"justify"},{default:f(()=>[o(K,{default:"",name:"Composition",label:"Best Composition"}),o(K,{name:"Class",label:"Best Class"}),o(K,{name:"Spec",label:"Best Spec"})]),_:1},8,["modelValue"]),o(xe,{modelValue:h(a),"onUpdate:modelValue":b[1]||(b[1]=z=>ce(a)?a.value=z:a=z),animated:"",class:"background"},{default:f(()=>[o(X,{"keep-alive":"",name:"Composition"},{default:f(()=>[o(J,{style:{height:"600px"}},{default:f(()=>[h(P)==="table"?(s(),w(Re,{key:0,dungeon:u.row.ingameid},null,8,["dungeon"])):(s(),w(we,{key:1,dungeon:u.row.ingameid},null,8,["dungeon"]))]),_:2},1024)]),_:2},1024),o(X,{"keep-alive":"",name:"Class"},{default:f(()=>[o(J,{style:{height:"600px"}},{default:f(()=>[h(P)==="table"?(s(),w(be,{key:0,dungeon:u.row.ingameid},null,8,["dungeon"])):(s(),w(ye,{key:1,dungeon:u.row.ingameid},null,8,["dungeon"]))]),_:2},1024)]),_:2},1024),o(X,{"keep-alive":"",name:"Spec"},{default:f(()=>[o(J,{style:{height:"600px"}},{default:f(()=>[h(P)==="table"?(s(),w(ke,{key:0,dungeon:u.row.ingameid},null,8,["dungeon"])):(s(),w(De,{key:1,dungeon:u.row.ingameid},null,8,["dungeon"]))]),_:2},1024)]),_:2},1024)]),_:2},1032,["modelValue"])]),_:2},1024),et]),_:2},1032,["style"])]),_:2},1032,["props"])):V("",!0)]),_:1},8,["rows","columns","pagination"])):V("",!0)]))}});var st=te(tt,[["__scopeId","data-v-3ff03607"]]);const at={class:"absolute-center noBg"},lt={class:"flex flex-center"},ot={class:"absolute-left noBg"},nt={class:"Ccenter",style:{"margin-left":"27px"}},it={class:""},rt={class:"absolute-right noBg"},dt={class:"Ccenter",style:{"margin-right":"25px"}},ut={id:"points",class:"flex flex-center"},ct={key:0},ft={key:0,id:"DungeonMoreInfoWindow"},_t=se({__name:"DungeonViewer",props:{dungeon:{type:Object},expanded:{type:Boolean},Selected:{},totalScore:{type:Number}},emits:["click"],setup(t,{emit:a}){const n=t,{dungeon:_,expanded:l,Selected:r,totalScore:$}=Ae(n),i=B(30),v=B(20),y=B(35),F=B("Composition"),A=ae().state.data,j=D(()=>A.Dungeons),W=D(()=>A.settings);D(()=>document.location.origin);const I=re(),Q=D(()=>H.GetDefaultView(I.screen.width,W)),x=D(()=>{for(let k=0;k<j.value.length;k++){const m=j.value[k];if(m.keystone_id===_.value.id)return m}}),p=_e(),c=()=>{l.value?a("click",!1):a("click",x.value.keystone_id),setTimeout(()=>{var k;(k=p==null?void 0:p.proxy)==null||k.$forceUpdate()},100)},S=B(null),P=()=>{S!==void 0&&(S.clientWidth<666?(i.value=20,v.value=15,y.value=25):(y.value=35,i.value=30,v.value=20))};return(k,m)=>(s(),d("div",null,[o(Ge,{src:`${h(x).imageurl}`,class:"DungeonWindow",onClick:m[1]||(m[1]=b=>c()),ref_key:"DungeonWindow",ref:S},{default:f(()=>[o(Me,{onResize:m[0]||(m[0]=b=>P())}),e("div",at,[e("div",lt,[e("div",{id:"nameBox",style:q("font-size:"+i.value+"px;")},g(h(x).short_name),5)])]),e("div",ot,[e("div",nt,[e("div",{class:"flex flex-center",id:"rankBox",style:q("font-size:"+v.value+"px; width: "+y.value+"px; height: "+y.value+"px;")},[e("div",it,g(h(_).rank),1)],4)])]),e("div",rt,[e("div",dt,[e("div",ut,[e("div",{style:q("font-size:"+v.value+"px;"),class:"flex"},[C(g(h(_).display_score)+" ",1),h(W).score_type=="percent"?(s(),d("div",ct,"%")):V("",!0)],4),o(O,null,{default:f(()=>[e("p",null,"Total Runs: "+g(h(_).total_runs),1),(s(!0),d(T,null,M(h(_).runs,(b,u)=>(s(),d("p",{class:"",key:u}," +"+g(u)+": "+g(b),1))),128))]),_:1})])])])]),_:1},8,["src"]),h(l)?(s(),d("div",ft,[o(ie,{class:"background"},{default:f(()=>[o(pe,{modelValue:F.value,"onUpdate:modelValue":m[2]||(m[2]=b=>F.value=b),animated:"",swipeable:"",class:"HeaderFontv2",align:"justify"},{default:f(()=>[o(K,{default:"",name:"Composition",label:"Best Composition"}),o(K,{name:"Class",label:"Best Class"}),o(K,{name:"Spec",label:"Best DPS Spec"})]),_:1},8,["modelValue"]),o(xe,{modelValue:F.value,"onUpdate:modelValue":m[3]||(m[3]=b=>F.value=b),animated:"",class:"background"},{default:f(()=>[o(X,{"keep-alive":"",name:"Composition"},{default:f(()=>[o(J,{style:{height:"700px"}},{default:f(()=>[o(we,{dungeon:h(x).zone},null,8,["dungeon"])]),_:1})]),_:1}),o(X,{"keep-alive":"",name:"Class"},{default:f(()=>[o(J,{style:{height:"600px"}},{default:f(()=>[h(Q)==="table"?(s(),w(be,{key:0,dungeon:h(_).id},null,8,["dungeon"])):(s(),w(ye,{key:1,dungeon:h(x).zone},null,8,["dungeon"]))]),_:1})]),_:1}),o(X,{"keep-alive":"",name:"Spec"},{default:f(()=>[o(J,{style:{height:"600px"}},{default:f(()=>[h(Q)==="table"?(s(),w(ke,{key:0,dungeon:h(_).id},null,8,["dungeon"])):(s(),w(De,{key:1,dungeon:h(x).zone},null,8,["dungeon"]))]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})])):V("",!0)]))}});const gt={components:{CloudinaryFormat:ze},data(){return{data:null,fetching:!1,error:!1}},created(){this.SelectedPeriode&&this.fetchData()},computed:{...me(["SelectedPeriode","GetDungeons"]),Settings(){return this.$store.state.data.settings}},methods:{getValidLink(t,a){return t||a},fetchData(){var t=this;t.fetching=!0;var a=this.$store.state.data.apiUrl;Z.get(a+"/Dungeon/ontimerate?periode="+this.SelectedPeriode.id+"&min_level="+this.Settings.min_keystonelevel+"&amount="+this.Settings.max_runs+"&limitToLowestDungeon="+this.Settings.limitbylowestdungeon).then(function(n){t.data=n.data,t.fetching=!1}).catch(function(n){console.log(n),t.error=!0,t.fetching=!1})},DungeonDetails(t){for(let a=0;a<this.GetDungeons.length;a++){const n=this.GetDungeons[a];if(n.keystone_id==t)return n}}},watch:{SelectedPeriode(){this.data=null,this.error=!1,this.fetchData()}}},vt={key:0,class:"HeaderFont text-center"},mt=e("h2",null,"Success rate",-1),ht={class:"flex flex-center"},pt={class:"percentBackground absolute-center"},xt={class:"textBox"},bt={class:"text-center",style:{margin:"auto"}};function yt(t,a,n,_,l,r){const $=he("CloudinaryFormat");return l.data?(s(),d("div",vt,[mt,e("div",ht,[(s(!0),d(T,null,M(l.data,(i,v)=>{var y,F;return s(),d("div",{class:"flex flex-between ListCSS",key:v},[o(O,null,{default:f(()=>[C(" Runs: "+g(i.total_runs),1)]),_:2},1024),o($,{url:(y=r.DungeonDetails(i.id))==null?void 0:y.imageurl},{default:f(({link:U})=>[e("div",{id:"DungeonDot",class:"text-center shadow-24 relative-position",style:q({"background-image":`url(${U})`})},[e("div",pt,[e("div",xt,g(i.ontime_percent.toFixed(0))+"%",1)])],4)]),_:2},1032,["url"]),e("div",bt,g((F=r.DungeonDetails(i.id))==null?void 0:F.name),1)])}),128))])])):V("",!0)}var kt=te(gt,[["render",yt]]);const L=t=>(de("data-v-39b5079c"),t=t(),ue(),t),Dt={key:0,class:"text-center HeaderFont"},wt=L(()=>e("div",null,[e("h2",null,"What week is best for what dungeon?")],-1)),St={class:"flex justify-center"},Pt={class:"affixInfoFieldRight"},Ft=L(()=>e("p",null,"From",-1)),Bt={class:"flex"},Tt={style:{width:"200px"}},Vt=L(()=>e("br",null,null,-1)),Ct=L(()=>e("br",null,null,-1)),$t={class:"affixInfoFieldLeft"},At=L(()=>e("p",null,"To",-1)),Mt={class:"flex"},Gt={class:"flex justify-center"},zt={class:"percentBackground absolute-center"},It={style:{width:"135px"},class:"flex justify-center"},Ht={key:0},Rt={key:1},Qt={key:2},Lt={class:"text-center",style:{margin:"auto"}},Ut={class:"text-center",style:{width:"100%","border-bottom":"solid 1px, black"}},jt=L(()=>e("div",{class:"flex justify-around",style:{width:"100%"}},[e("div",{class:"tableField"},"Period"),e("div",{class:"tableField"},"Affixes"),e("div",{class:"tableField"},"Score"),e("div",{class:"tableField"},"Average Score"),e("div",{class:"tableField"},"Success Rate")],-1)),Wt={class:"tableField"},qt={class:"tableField"},Nt={class:"flex"},Ot={class:"tableField"},Yt={class:"tableField"},Et={class:"tableField"},Jt=L(()=>e("br",null,null,-1)),Kt=L(()=>e("div",{class:"flex flex-center"},[e("h6",{id:"OverallTitle"},"Best overall week")],-1)),Xt={class:"flex flex-center"},Zt={class:"TotalView flex justify-around"},es={class:"text-center",style:{width:"100%","border-bottom":"solid 1px, black"}},ts=L(()=>e("div",{class:"flex justify-around",style:{width:"100%"}},[e("div",{class:"tableField"},"Periode"),e("div",{class:"tableField"},"Affixes"),e("div",{class:"tableField"},"Score"),e("div",{class:"tableField"},"Average Score"),e("div",{class:"tableField"},"Success Rate")],-1)),ss={class:"tableField"},as={class:"tableField"},ls={class:"flex"},os={class:"tableField"},ns={class:"tableField"},is={class:"tableField"},rs={class:"flex flex-center"},ds={class:"flex flex-center scoreView"},us={key:0},cs={key:1},fs={key:2},_s=L(()=>e("br",null,null,-1)),gs=L(()=>e("br",null,null,-1)),vs=se({__name:"BestWeekForAffix",setup(t){const a=B(null),n=B(null),_=B("success_rate"),l=B(null);B(!0),B({rowsPerPage:15,page:1});const r=B(null);B([{name:"periode",label:"Periode",field:"periode",sortable:!0},{name:"affixes",label:"Affixes",field:"affixes",sortable:!0},{name:"total_score",label:"Total Score",field:"total_score",sortable:!0},{name:"avg_score",label:"Average Score",field:"avg_score",sortable:!0},{name:"success_rate",label:"Success Rate",field:"success_rate",sortable:!0}]),E(a,()=>{var x=setTimeout(function(){r.value==x&&W()},1e3);r.value=x});const i=ae().state.data,v=D(()=>i.Dungeons);D(()=>i.Affixes);const y=()=>{if(l.value){var x=[...l.value].filter(p=>p[0].dungeon!==null)[0];return x}},F=x=>{var p=[];for(let S=0;S<x.length;S++){const P=x[S];var c={periode:P.periode,affixes:I(P.periode).affixes,total_score:P.score,avg_score:P.score/P.runs,success_rate:P.success_rate};p.push(c)}return H._sortBy(p,_.value).reverse()},U=x=>{for(let p=0;p<v.value.length;p++){const c=v.value[p];if(c.id==x)return c}},A=x=>{if(!x)return null;var p=[];for(let P=0;P<x.length;P++){const k=x[P];var c=k.score/1e3;k.total_score=c;var S=k.score/k.runs;k.avg_score=S}return p=H._sortBy(x,_.value).reverse(),p[0]},j=()=>{var x=i.apiUrl;Z.get(x+"/Periode?weeks=50").then(function(p){n.value=H._sortBy(p.data,"id"),a.value={min:n.value[n.value.length-1].id-10,max:n.value[n.value.length-1].id}}).catch(function(p){console.log(p)})},W=()=>{var x=i.apiUrl;Z.get(x+"/Dungeon/BestAffixSetPerDungeon?fromPeriode="+a.value.min+"&toPeriode="+a.value.max).then(function(p){var c;l.value=(c=p.data)==null?void 0:c.map(S=>S.list)}).catch(function(p){console.log(p)})},I=x=>{for(let p=0;p<n.value.length;p++){const c=n.value[p];if(c.id===x)return c}},Q=x=>H.GetMoment(x).format("MMMM Do YYYY");return ge(()=>{j()}),(x,p)=>(s(),d(T,null,[a.value&&l.value?(s(),d("div",Dt,[wt,e("div",St,[e("div",Pt,[Ft,e("p",null,g(Q(I(a.value.min).start_timestamp)),1),e("div",Bt,[(s(!0),d(T,null,M(I(a.value.min).affixes,c=>(s(),w(c,{key:c,class:"miniAffixImg",border:!0,affixid:c,detailed:!0,tooltip:!0},null,8,["affixid"]))),128))])]),e("div",Tt,[C(g(a.value.max-a.value.min)+" ",1),Vt,C(" weeks "),Ct,C(" selected ")]),e("div",$t,[At,e("p",null,g(Q(I(a.value.max).start_timestamp)),1),e("div",Mt,[(s(!0),d(T,null,M(I(a.value.max).affixes,c=>(s(),w(c,{key:c,class:"miniAffixImg",border:!0,affixid:c,detailed:!0,tooltip:!0},null,8,["affixid"]))),128))])])]),n.value?(s(),w(Se,{key:0,modelValue:a.value,"onUpdate:modelValue":p[0]||(p[0]=c=>a.value=c),min:n.value[0].id,max:n.value[n.value.length-1].id,step:1},null,8,["modelValue","min","max"])):V("",!0),o(Ie,{modelValue:_.value,"onUpdate:modelValue":p[1]||(p[1]=c=>_.value=c),"toggle-color":"tertiary",options:[{label:"Total score",value:"total_score"},{label:"Success rate",value:"success_rate"},{label:"Average score",value:"avg_score"}]},null,8,["modelValue"]),e("div",Gt,[(s(!0),d(T,null,M(l.value.filter(c=>{var S;return((S=c[0])==null?void 0:S.zone)!=-2}),c=>{var S,P,k,m,b,u,z;return s(),d("div",{class:"ListCSS",key:(S=A(c))==null?void 0:S.dungeon},[c&&((P=A(c))==null?void 0:P.dungeon)?(s(),d(T,{key:0},[e("div",{id:"DungeonDot",class:"text-center shadow-24 relative-position",style:q({"background-image":"url("+((m=U((k=A(c))==null?void 0:k.dungeon))==null?void 0:m.imageurl)+")"})},[e("div",zt,[e("div",null,[e("div",It,[(s(!0),d(T,null,M((u=I((b=A(c))==null?void 0:b.periode))==null?void 0:u.affixes,R=>(s(),w(R,{key:R,class:"microAffixImg",border:!1,affixid:R,detailed:!1,tooltip:!0},null,8,["affixid"]))),128))]),_.value==="success_rate"?(s(),d("div",Ht," Success rate: "+g(A(c).success_rate.toFixed(0))+"% ",1)):V("",!0),_.value==="total_score"?(s(),d("div",Rt," Total Score : "+g(Math.floor(A(c).total_score)),1)):V("",!0),_.value==="avg_score"?(s(),d("div",Qt," Average Score: "+g(Math.floor(A(c).avg_score)),1)):V("",!0)])])],4),e("div",Lt,g((z=U(A(c).dungeon))==null?void 0:z.name),1),o(O,null,{default:f(()=>[e("div",Ut,[jt,(s(!0),d(T,null,M(F(c),R=>(s(),d("div",{class:"flex justify-around",style:{width:"100%"},key:R.periode},[e("div",Wt,g(R.periode),1),e("div",qt,[e("div",Nt,[(s(!0),d(T,null,M(R.affixes,le=>(s(),w(le,{key:le,class:"micoAffixImg",border:!0,affixid:le,detailed:!1,tooltip:!0},null,8,["affixid"]))),128))])]),e("div",Ot,g(Math.floor(R.total_score/1e3*100)/100),1),e("div",Yt,g(Math.floor(R.avg_score*100)/100),1),e("div",Et,g(Math.floor(R.success_rate*100)/100)+"% ",1)]))),128))])]),_:2},1024)],64)):V("",!0)])}),128))]),Jt,e("div",null,[Kt,e("div",Xt,[e("div",Zt,[(s(!0),d(T,null,M(I(A(y()).periode).affixes,c=>(s(),w(c,{size:"100%",key:c,class:"bigAffixImg",border:!1,affixid:c,detailed:!1,tooltip:!1},null,8,["affixid"]))),128))]),o(O,null,{default:f(()=>[e("div",es,[ts,(s(!0),d(T,null,M(F(y()),c=>(s(),d("div",{class:"flex justify-around",style:{width:"100%"},key:c.periode},[e("div",ss,g(c.periode),1),e("div",as,[e("div",ls,[(s(!0),d(T,null,M(c.affixes,S=>(s(),w(S,{key:S,class:"micoAffixImg",border:!0,affixid:S,detailed:!1,tooltip:!1},null,8,["affixid"]))),128))])]),e("div",os,g(Math.floor(c.total_score/1e3*100)/100),1),e("div",ns,g(Math.floor(c.avg_score*100)/100),1),e("div",is,g(Math.floor(c.success_rate*100)/100)+"% ",1)]))),128))])]),_:1})]),e("div",rs,[e("div",ds,[_.value==="success_rate"?(s(),d("div",us," Success rate: "+g(A(y()).success_rate.toFixed(0))+"% ",1)):V("",!0),_.value==="total_score"?(s(),d("div",cs," Total Score : "+g(Math.floor(A(y()).total_score)),1)):V("",!0),_.value==="avg_score"?(s(),d("div",fs," Average Score: "+g(Math.floor(A(y()).avg_score)),1)):V("",!0)])])])])):V("",!0),_s,gs],64))}});var ms=te(vs,[["__scopeId","data-v-39b5079c"]]);function fe(t,a,n){var _,l,r,$,i;a==null&&(a=100);function v(){var F=Date.now()-$;F<a&&F>=0?_=setTimeout(v,a-F):(_=null,n||(i=t.apply(r,l),r=l=null))}var y=function(){r=this,l=arguments,$=Date.now();var F=n&&!_;return _||(_=setTimeout(v,a)),F&&(i=t.apply(r,l),r=l=null),i};return y.clear=function(){_&&(clearTimeout(_),_=null)},y.flush=function(){_&&(i=t.apply(r,l),r=l=null,clearTimeout(_),_=null)},y}fe.debounce=fe;const hs={components:{affix:Le},data(){return{dungeonPaginationControl:{rowsPerPage:20,page:1,sortBy:"intime_rate",descending:!0},subdungeonPaginationControl:{rowsPerPage:30,page:1,sortBy:"periode",descending:!0},dungeonColumns:[{name:"view",label:"",align:"left"},{name:"dungeon",label:"Dungeon",sortable:!0,field:t=>DungeonDetails(t.dungeon).name,align:"left"},{name:"affixes",label:"Affixes",align:"center"},{name:"tscore",label:"Total Score",field:t=>this.getBestPeriode(t.list).tscore,sortable:!0,align:"center"},{name:"ascore",label:"Average score",field:t=>this.getBestPeriode(t.list).ascore,sort:(t,a,n,_)=>this.getBestPeriode(n.list).ascore-this.getBestPeriode(_.list).ascore,sortable:!0,align:"center"},{name:"intime_rate",label:"Success rate",field:t=>this.getBestPeriode(t.list).success_rate,sortable:!0,align:"center"}],subdungeonColumns:[{name:"periode",label:"Period",align:"center",field:t=>t.periode,sortable:!0},{name:"affixes",label:"Affixes",align:"center",field:t=>this.periodeDetails(t.periode).affixes,sortable:!0},{name:"tscore",label:"Total Score",field:t=>t.tscore,sortable:!0,align:"center"},{name:"ascore",label:"Average score",field:t=>t.ascore,sort:(t,a,n,_)=>n.ascore-_.ascore,sortable:!0,align:"center"},{name:"intime_rate",label:"Success rate",field:t=>t.success_rate,sortable:!0,align:"center"}],rangeValues:null,allPeriodes:null,type:"success_rate",data:null,successRate:!0,paginationControl:{rowsPerPage:15,page:1},bounce:null,columns:[{name:"periode",label:"Periode",field:"periode",sortable:!0},{name:"affixes",label:"Affixes",field:"affixes",sortable:!0},{name:"total_score",label:"Total Score",field:"total_score",sortable:!0},{name:"avg_score",label:"Average Score",field:"avg_score",sortable:!0},{name:"success_rate",label:"Success Rate",field:"success_rate",sortable:!0}]}},watch:{dungeonPaginationControl(t,a){var n=t.sortBy;t==null&&(n=a.sortBy),n=="intime_rate"?(this.type="success_rate",this.subdungeonPaginationControl.sortBy="intime_rate"):n=="tscore"?(this.type="total_score",this.subdungeonPaginationControl.sortBy="tscore"):n=="ascore"&&(this.type="avg_score",this.subdungeonPaginationControl.sortBy="ascore")},rangeValues(){var t=this,a=setTimeout(function(){t.bounce==a&&t.getData()},1e3);this.bounce=a,this.BestAffixList}},computed:{...me(["GetDungeons","GetAffixes"])},methods:{BestAffixList(){if(this.data){var t=this.data.filter(a=>!a.dungeon||!a.zone||a.dungeon===-2||a.zone===-2)[0].list;return t}},GetTableFriendlyData(t){var a=[];for(let _=0;_<t.length;_++){const l=t[_];var n={periode:l.periode,affixes:this.periodeDetails(l.periode).affixes,total_score:l.score,avg_score:l.score/l.runs,success_rate:l.success_rate};a.push(n)}return H._sortBy(a,this.type).reverse()},GetAffixDetails(t){for(let a=0;a<this.GetAffixes.length;a++){const n=this.GetAffixes[a];if(n.id==t)return n}},DungeonDetails(t){for(let a=0;a<this.GetDungeons.length;a++){const n=this.GetDungeons[a];if(n.keystone_id==t)return n}},getBestPeriode(t){var a=[];for(let l=0;l<t.length;l++){const r=t[l];var n=r.score/1e3;r.total_score=n;var _=r.score/r.runs;r.avg_score=_}return a=H._sortBy(t,this.type).reverse(),a[0]},getPeriodes(){var t=this,a=this.$store.state.data.apiUrl;Z.get(a+"/Periode?weeks=50").then(function(n){t.allPeriodes=H._sortBy(n.data,"id"),t.rangeValues={min:t.allPeriodes[t.allPeriodes.length-1].id-10,max:t.allPeriodes[t.allPeriodes.length-1].id}}).catch(function(n){console.log(n)})},getData(){var t=this,a=this.$store.state.data.apiUrl;Z.get(a+"/Dungeon/BestAffixSetPerDungeon?fromPeriode="+t.rangeValues.min+"&toPeriode="+t.rangeValues.max).then(function(n){n.data=n.data.map(r=>r.list);var _=[];for(let r=0;r<n.data.length;r++){const $=n.data[r];var l=[];for(let i=0;i<$.length;i++){const v=$[i];v.tscore=v.score,v.ascore=H.GetPoints(v.tscore,"mean",0,v.runs),l.push(v)}_.push({dungeon:l[0].zone||null,list:l})}t.data=_}).catch(function(n){console.log(n)})},periodeDetails(t){for(let a=0;a<this.allPeriodes.length;a++){const n=this.allPeriodes[a];if(n.id===t)return n}},FormatDate(t){return H.GetMoment(t).format("MMMM Do YYYY")}},created(){this.getPeriodes()}},Y=t=>(de("data-v-f1bf07ea"),t=t(),ue(),t),ps={id:"Main",class:"relative"},xs={class:"text-center HeaderFont"},bs=Y(()=>e("div",{class:""},[e("h2",null,"What week is best for what dungeon?")],-1)),ys={key:0,class:"flex justify-center"},ks={class:"affixInfoFieldRight"},Ds=Y(()=>e("p",{class:""},"From",-1)),ws={class:"flex"},Ss={key:0,style:{width:"200px"}},Ps=Y(()=>e("br",null,null,-1)),Fs=Y(()=>e("br",null,null,-1)),Bs={key:1,class:"affixInfoFieldLeft"},Ts=Y(()=>e("p",null,"To",-1)),Vs={class:"flex"},Cs={key:2},$s={class:""},As={class:"flex justify-center"},Ms={class:"flex justify-center"},Gs=Y(()=>e("div",{class:"flex flex-center"},[e("h6",{id:"OverallTitle"},"Best overall week")],-1)),zs={class:"flex flex-center"},Is={class:"TotalView flex justify-around"},Hs={class:"text-center",style:{width:"100%","border-bottom":"solid 1px, black"}},Rs=Y(()=>e("div",{class:"flex justify-around",style:{width:"100%"}},[e("div",{class:"tableField"},"Periode"),e("div",{class:"tableField"},"Affixes"),e("div",{class:"tableField"},"Score"),e("div",{class:"tableField"},"Average Score"),e("div",{class:"tableField"},"Success Rate")],-1)),Qs={class:"tableField"},Ls={class:"tableField"},Us={class:"flex"},js={class:"tableField"},Ws={class:"tableField"},qs={class:"tableField"},Ns={class:"flex flex-center"},Os={class:"flex flex-center scoreView"},Ys={key:0},Es={key:1},Js={key:2};function Ks(t,a,n,_,l,r){const $=he("affix");return s(),d("div",ps,[e("div",xs,[bs,l.rangeValues?(s(),d("div",ys,[e("div",ks,[Ds,e("p",null,g(r.FormatDate(r.periodeDetails(l.rangeValues.min).start_timestamp)),1),e("div",ws,[(s(!0),d(T,null,M(r.periodeDetails(l.rangeValues.min).affixes,i=>(s(),w($,{key:i,size:35,border:!0,affixid:i,detailed:!0,tooltip:!0},null,8,["affixid"]))),128))])]),l.rangeValues?(s(),d("div",Ss,[C(g(l.rangeValues.max-l.rangeValues.min)+" ",1),Ps,C("weeks "),Fs,C("selected ")])):V("",!0),l.rangeValues?(s(),d("div",Bs,[Ts,e("p",null,g(r.FormatDate(r.periodeDetails(l.rangeValues.max).start_timestamp)),1),e("div",Vs,[(s(!0),d(T,null,M(r.periodeDetails(l.rangeValues.max).affixes,i=>(s(),w($,{key:i,size:35,border:!0,affixid:i,detailed:!0,tooltip:!0},null,8,["affixid"]))),128))])])):V("",!0)])):V("",!0),l.allPeriodes?(s(),w(Se,{key:1,modelValue:l.rangeValues,"onUpdate:modelValue":a[0]||(a[0]=i=>l.rangeValues=i),min:l.allPeriodes[0].id,max:l.allPeriodes[l.allPeriodes.length-1].id,step:1},null,8,["modelValue","min","max"])):V("",!0),l.rangeValues&&l.data?(s(),d("div",Cs,[e("div",$s,[o(ne,{"rows-per-page-options":[],"card-class":"background HeaderFont","table-class":"HeaderFont","table-header-class":"HeaderFont",dark:"",flat:"",rows:l.data.filter((i,v)=>i.dungeon!=null&&i.dungeon!==-2),columns:l.dungeonColumns,pagination:l.dungeonPaginationControl,"hide-bottom":"","row-key":"dungeon"},{body:f(i=>[o(ee,{props:i},{default:f(()=>[o(G,null,{default:f(()=>[o(ve,{style:q(`background-image: url(${r.DungeonDetails(i.row.dungeon).imageurl});`),class:"darkOverlay",round:"",flat:"",icon:i.expand?"arrow_drop_up":"arrow_drop_down",onClick:v=>i.expand=!i.expand},null,8,["style","icon","onClick"])]),_:2},1024),o(G,{key:"dungeon",props:i},{default:f(()=>[C(g(r.DungeonDetails(i.row.dungeon).name),1)]),_:2},1032,["props"]),o(G,{key:"affixes",props:i},{default:f(()=>[e("div",As,[(s(!0),d(T,null,M(r.periodeDetails(r.getBestPeriode(i.row.list).periode).affixes,(v,y)=>(s(),w($,{key:y,affixid:v},null,8,["affixid"]))),128))])]),_:2},1032,["props"]),o(G,{key:"tscore",props:i},{default:f(()=>[C(g(Math.round(r.getBestPeriode(i.row.list).tscore)),1)]),_:2},1032,["props"]),o(G,{key:"ascore",props:i},{default:f(()=>[C(g(r.getBestPeriode(i.row.list).ascore),1)]),_:2},1032,["props"]),o(G,{key:"intime_rate",props:i},{default:f(()=>[C(g(Math.round(r.getBestPeriode(i.row.list).success_rate*100)/100)+"%",1)]),_:2},1032,["props"])]),_:2},1032,["props"]),i.expand?(s(),w(ee,{key:0,class:"hideHoverGlobal",props:i},{default:f(()=>[o(G,{colspan:"100%"},{default:f(()=>[o(ne,{"rows-per-page-options":[],"card-class":"background HeaderFont","table-class":"HeaderFont","table-header-class":"HeaderFont",dark:"",dense:"",flat:"",rows:i.row.list,columns:l.subdungeonColumns,pagination:l.subdungeonPaginationControl,"hide-bottom":"","row-key":"dungeon"},{body:f(v=>[o(ee,{props:v},{default:f(()=>[o(G,{key:"periode",props:v},{default:f(()=>[C(g(Math.round(v.row.periode)),1)]),_:2},1032,["props"]),o(G,{key:"affixes",props:v},{default:f(()=>[e("div",Ms,[(s(!0),d(T,null,M(r.periodeDetails(v.row.periode).affixes,(y,F)=>(s(),w($,{key:F,affixid:y},null,8,["affixid"]))),128))])]),_:2},1032,["props"]),o(G,{key:"tscore",props:v},{default:f(()=>[C(g(Math.round(v.row.tscore)),1)]),_:2},1032,["props"]),o(G,{key:"ascore",props:v},{default:f(()=>[C(g(v.row.ascore),1)]),_:2},1032,["props"]),o(G,{key:"intime_rate",props:v},{default:f(()=>[C(g(Math.round(v.row.success_rate*100)/100)+"%",1)]),_:2},1032,["props"])]),_:2},1032,["props"])]),_:2},1032,["rows","columns","pagination"])]),_:2},1024)]),_:2},1032,["props"])):V("",!0)]),_:1},8,["rows","columns","pagination"])]),e("div",null,[Gs,e("div",zs,[e("div",Is,[(s(!0),d(T,null,M(r.periodeDetails(r.getBestPeriode(r.BestAffixList()).periode).affixes,i=>(s(),w($,{key:i,size:70,border:!1,affixid:i,detailed:!1,tooltip:!1},null,8,["affixid"]))),128))]),o(O,null,{default:f(()=>[e("div",Hs,[Rs,(s(!0),d(T,null,M(r.GetTableFriendlyData(r.BestAffixList()),i=>(s(),d("div",{class:"flex justify-around",style:{width:"100%"},key:i.periode},[e("div",Qs,g(i.periode),1),e("div",Ls,[e("div",Us,[(s(!0),d(T,null,M(i.affixes,v=>(s(),w($,{key:v,class:"micoAffixImg",border:!0,affixid:v,detailed:!1,tooltip:!1},null,8,["affixid"]))),128))])]),e("div",js,g(Math.floor(i.total_score/1e3*100)/100),1),e("div",Ws,g(Math.floor(i.avg_score*100)/100),1),e("div",qs,g(Math.floor(i.success_rate*100)/100)+"%",1)]))),128))])]),_:1})]),e("div",Ns,[e("div",Os,[l.type==="success_rate"?(s(),d("div",Ys,"Success rate: "+g(r.getBestPeriode(r.BestAffixList()).success_rate.toFixed(0))+"%",1)):V("",!0),l.type==="total_score"?(s(),d("div",Es,"Total Score : "+g(Math.floor(r.getBestPeriode(r.BestAffixList()).total_score)),1)):V("",!0),l.type==="avg_score"?(s(),d("div",Js,"Average Score: "+g(Math.floor(r.getBestPeriode(r.BestAffixList()).avg_score)),1)):V("",!0)])])])])):(s(),w(oe,{key:3,class:"absolute-center",style:{color:"rgb(161, 161, 161)"},size:200}))])])}var Xs=te(hs,[["render",Ks],["__scopeId","data-v-f1bf07ea"]]);const Zs=e("div",{class:"flex flex-center"},[e("div",{class:"Centertext HeaderSize HeaderFont"},` What's the "best" dungeon this week? `)],-1),ea=e("div",{class:"flex flex-center"},[e("p",{class:"HeaderFont HeaderSize2"},"(ish)")],-1),ta={key:0,class:"flex flex-center"},sa={key:1,class:"HeaderFont nodataInfo"},aa=e("h4",{class:"flex flex-center"},"No data found!",-1),la=e("p",{class:"flex flex-center"},"Try to change the settings up in the right",-1),oa=[aa,la],na={key:2},ia={key:0},ra=He('<div class="HeaderFont relative-position" style="height:20px;"><div class="absolute-left"><div class="Ccenter" style="margin-left:30px;"><div style="width:0px;">Rank</div></div></div><div class="HeaderFont dungeonTitle relative"><div class="title">Dungeon</div></div><div class="absolute-right"><div class="Ccenter" style="margin-right:32px;"><div>Score</div></div></div></div>',1),Sa=se({__name:"dungeons",setup(t){B(!1);const a=B(null),n=B(!1),l=ae().state.data,r=D(()=>l.Selected),$=D(()=>l.SelectedAffixSet),i=D(()=>l.RIOData),v=D(()=>l.Dungeons_Data),y=D(()=>l.Dungeons),F=D(()=>l.SelectedPeriode),U=D(()=>l.Reloaded_Timestamp);D(()=>l.Affixes);const A=D(()=>l.Periodes),j=D(()=>l.settings),W=re(),I=D(()=>H.GetDefaultView(W.screen.width,j.value)),Q=D(()=>r);D(()=>$),D(()=>i);const x=D(()=>j);E(U,()=>{a.value=null}),E(A,()=>{l.apiUrl,n.value||A.value[0]});const p=()=>H.GetTotalScore(v.value.data),c=S=>{const P=[...S].map(k=>({...k}));for(let k=0;k<P.length;k++){const m=P[k];m.display_score=H.GetPoints(m.score,x.value.value.score_type,p(),m.total_runs)}return H.getListWithRank(P)};return B(null),(S,P)=>(s(),d("div",null,[Zs,ea,o(Pe),h(I)==="table"?(s(),d(T,{key:0},[o(st),o(Xs)],64)):(s(),d(T,{key:1},[h(F)&&h(v)&&h(F)!=h(v).periode?(s(),d("div",ta,[o(Fe,{style:{color:"rgb(161, 161, 161)"},size:"500"})])):h(v)&&h(v).data.filter(k=>k.score===0).length===h(v).data.length?(s(),d("div",sa,oa)):(s(),d("div",na,[h(F)&&h(v)&&h(v).data&&h(y)?(s(),d("div",ia,[ra,(s(!0),d(T,null,M(c(h(v).data),k=>(s(),d("div",{key:k.id},[o(_t,{totalScore:p(),Selected:h(Q),onClick:P[0]||(P[0]=m=>a.value=m),expanded:a.value===k.id,dungeon:k},null,8,["totalScore","Selected","expanded","dungeon"])]))),128))])):V("",!0)])),o(kt),o(ms)],64))]))}});export{Sa as default};
