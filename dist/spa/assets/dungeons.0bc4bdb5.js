import{a as Pe,Q as Fe}from"./AffixSelector.84cf2c84.js";import{D as Be,E as Te,G as Ve,c as k,H as Ce,I as $e,J as _e,d as se,r as F,u as ae,e as re,S as Q,w as J,o as ve,h as s,i as u,m as R,n as S,q as f,p as o,ac as ge,N as q,l as C,t as g,ae as O,F as T,C as M,ag as oe,aB as ce,bk as K,z as V,_ as le,a as ee,v as de,x as ue,j as e,B as Ae,az as Me,Q as ze,L as Ie,y as me,g as he,an as He,bl as Re}from"./index.326ea565.js";import{a as z,Q as te}from"./QTr.e1e722a0.js";import{a as pe,Q as X,c as xe,b as Z}from"./QTabPanels.addca843.js";import{Q as ne}from"./QTable.dabdb8d3.js";import{C as be,_ as ye}from"./ClassTableView.f5bab9c0.js";import{_ as ke,a as we}from"./SpecList.ecd97950.js";import{C as Qe,a as Se}from"./CompositionTableView.3396b33f.js";import{F as Ge}from"./FactionBar.088985cc.js";import{Q as De}from"./QRange.18da393e.js";import{a as Le}from"./index.56a95922.js";import"./linq.12a21919.js";import"./use-cache.b0833c75.js";import"./QMarkupTable.533909ff.js";import"./QCheckbox.231b7602.js";import"./QInput.873a83cc.js";var ie=Be({name:"QCard",props:{...Te,tag:{type:String,default:"div"},square:Boolean,flat:Boolean,bordered:Boolean},setup(t,{slots:a}){const{proxy:{$q:n}}=_e(),_=Ve(t,n),l=k(()=>"q-card"+(_.value===!0?" q-card--dark q-dark":"")+(t.bordered===!0?" q-card--bordered":"")+(t.square===!0?" q-card--square no-border-radius":"")+(t.flat===!0?" q-card--flat no-shadow":""));return()=>Ce(t.tag,{class:l.value},$e(a.default))}});const N=t=>(de("data-v-6ed2e0e7"),t=t(),ue(),t),Ue={id:"Main",class:"relative"},je={key:1,class:"HeaderFont"},We=N(()=>e("br",null,null,-1)),qe=N(()=>e("br",null,null,-1)),Ne=N(()=>e("div",{class:"flex justify-center HeaderSize4"},[e("div",null,"There is no data for this request, yet...")],-1)),Oe=[We,qe,Ne],Ye=N(()=>e("i",{class:"material-icons"},"info",-1)),Ee={key:0},Je={key:2},Ke=N(()=>e("i",{class:"material-icons"},"warning",-1)),Xe=N(()=>e("br",null,null,-1)),Ze=N(()=>e("br",null,null,-1)),et=N(()=>e("br",null,null,-1)),tt=se({__name:"DungeonTableView",setup(t){let a=F("Composition"),n=F([]),_=F(!1),l=F(!1),d=F(null),$=F({rowsPerPage:999,page:1,sortBy:"intime_rate",descending:!0}),i=F([{name:"view",label:"",align:"left",field:m=>m},{name:"dungeon",label:"Dungeon",field:m=>H(m.id),align:"left"},{name:"runs",label:"Amount of runs",field:m=>m.total_runs,sortable:!0,align:"center"},{name:"tscore",label:"Total Score",field:m=>m.tscore,sortable:!0,align:"center"},{name:"ascore",label:"Average score",field:m=>m.ascore,sortable:!0,align:"center"},{name:"intime_rate",label:"Success rate",field:m=>W(m.ingameid).ontime_percent||0,sortable:!0,align:"center"}]);const b=ae().state.data,P=()=>{if(!p.value)return null;_.value=!0;var m=b.apiUrl;ee.get(m+"/Dungeon/ontimerate?periode="+p.value+"&min_level="+c.value.min_keystonelevel+"&amount="+c.value.max_runs+"&limitToLowestDungeon="+c.value.limitbylowestdungeon).then(function(x){n.value=x.data,_.value=!1}).catch(function(x){console.log(x),x.value=!0,_.value=!1})},j=(m,x,r,B)=>Q.GetPoints(m,x,r,B),A=m=>{var x=0;for(let r=0;r<m.length;r++)x+=m[r].score;return x},G=()=>{var m=[...L.value.data],x=[];for(let B=0;B<m.length;B++){var r={...m[B]};r.tscore=r.score,r.ascore=j(r.tscore,"mean",0,r.total_runs),r.pscore=j(r.tscore,"percent",A(m),r.total_runs),r.total_runs!=0&&x.push(r)}d.value=x},W=m=>{if(n.value)for(let x=0;x<n.value.length;x++){const r=n.value[x];if(r.id==m)return r}return!1},H=m=>{var x,r,B;if(h!=null&&h.value)for(let I=0;I<((r=(x=h==null?void 0:h.value)==null?void 0:x.length)!=null?r:0);I++){const E=(B=h==null?void 0:h.value)==null?void 0:B[I];if(E.keystone_id==m)return E}},L=k(()=>b.Dungeons_Data),h=k(()=>b.Dungeons),p=k(()=>b.SelectedPeriode);k(()=>b.Reloaded_Timestamp),k(()=>b.Affixes),k(()=>b.Periodes);const c=k(()=>b.settings),D=re(),w=k(()=>Q.GetDefaultView(D.screen.width,c.value)),y=F(null);return J(n,()=>{n.value&&y.value}),J(L,()=>{L.value&&G()}),J(p,()=>{d.value=null,l.value=!1,P()}),ve(()=>{p.value&&(L.value&&G(),P())}),(m,x)=>(s(),u("div",Ue,[R(d)==null?(s(),S(oe,{key:0,class:"absolute-center",style:{color:"rgb(161, 161, 161)"},size:"200"})):R(d).length==0?(s(),u("div",je,Oe)):R(d).length!=0?(s(),S(ne,{key:2,"rows-per-page-options":[],"card-class":"background HeaderFont","table-class":"HeaderFont","table-header-class":"HeaderFont",dark:"",flat:"",rows:R(d),columns:R(i),pagination:R($),"hide-bottom":"","row-key":"ingameid",ref_key:"dungeonTable",ref:y},{body:f(r=>[o(te,{props:r},{default:f(()=>[o(z,{key:"view",props:r},{default:f(()=>[o(ge,{style:q(`background-size: 150% 150%; background-image: url(${H(r.row.ingameid).imageurl});`),class:"darkOverlay",round:"",flat:"",icon:r.expand?"arrow_drop_up":"arrow_drop_down",onClick:B=>r.expand=!r.expand},null,8,["style","icon","onClick"])]),_:2},1032,["props"]),o(z,{key:"dungeon",props:r},{default:f(()=>[C(g(`${H(r.row.ingameid).name}`),1)]),_:2},1032,["props"]),o(z,{key:"runs",props:r},{default:f(()=>[C(g(r.row.total_runs)+" ",1),Ye,o(O,null,{default:f(()=>[(s(!0),u(T,null,M(r.row.runs,(B,I)=>(s(),u("div",{key:I},g(`${I}: ${B}`),1))),128))]),_:2},1024)]),_:2},1032,["props"]),o(z,{key:"tscore",props:r},{default:f(()=>[C(g(Math.round(r.row.tscore))+" ("+g(r.row.pscore)+"%)",1)]),_:2},1032,["props"]),o(z,{key:"ascore",props:r},{default:f(()=>[C(g(r.row.ascore),1)]),_:2},1032,["props"]),o(z,{key:"intime_rate",props:r},{default:f(()=>[W(r.row.ingameid)?(s(),u("div",Ee,g(Math.round(W(r.row.ingameid).ontime_percent*10)/10)+"%",1)):R(_)?(s(),S(oe,{key:1,size:"15"})):(s(),u("div",Je,[Ke,o(O,null,{default:f(()=>[C("Success rate is generated separately. Could not get the data")]),_:1})]))]),_:2},1032,["props"])]),_:2},1032,["props"]),r.expand?(s(),S(te,{key:0,class:"hideHover",props:r},{default:f(()=>[o(z,{colspan:"100%",class:"DungeonWindow",style:q(`background-size: 150% 150%; background-image: url(${H(r.row.ingameid).imageurl});`)},{default:f(()=>[Xe,o(ie,{class:"background",style:{opacity:"0.92",padding:"2px 10px 10px 10px"}},{default:f(()=>[o(Ge,{zone:r.row.ingameid},null,8,["zone"])]),_:2},1024),Ze,o(ie,{class:"background",style:{opacity:"0.92"}},{default:f(()=>[o(pe,{modelValue:R(a),"onUpdate:modelValue":x[0]||(x[0]=B=>ce(a)?a.value=B:a=B),animated:"",swipeable:"",class:"HeaderFontv2",align:"justify"},{default:f(()=>[o(X,{default:"",name:"Composition",label:"Best Composition"}),o(X,{name:"Class",label:"Best Class"}),o(X,{name:"Spec",label:"Best Spec"})]),_:1},8,["modelValue"]),o(xe,{modelValue:R(a),"onUpdate:modelValue":x[1]||(x[1]=B=>ce(a)?a.value=B:a=B),animated:"",class:"background"},{default:f(()=>[o(Z,{"keep-alive":"",name:"Composition"},{default:f(()=>[o(K,{style:{height:"600px"}},{default:f(()=>[w.value==="table"?(s(),S(Qe,{key:0,dungeon:r.row.ingameid},null,8,["dungeon"])):(s(),S(Se,{key:1,dungeon:r.row.ingameid},null,8,["dungeon"]))]),_:2},1024)]),_:2},1024),o(Z,{"keep-alive":"",name:"Class"},{default:f(()=>[o(K,{style:{height:"600px"}},{default:f(()=>[w.value==="table"?(s(),S(be,{key:0,dungeon:r.row.ingameid},null,8,["dungeon"])):(s(),S(ye,{key:1,dungeon:r.row.ingameid},null,8,["dungeon"]))]),_:2},1024)]),_:2},1024),o(Z,{"keep-alive":"",name:"Spec"},{default:f(()=>[o(K,{style:{height:"600px"}},{default:f(()=>[w.value==="table"?(s(),S(ke,{key:0,dungeon:r.row.ingameid},null,8,["dungeon"])):(s(),S(we,{key:1,dungeon:r.row.ingameid},null,8,["dungeon"]))]),_:2},1024)]),_:2},1024)]),_:2},1032,["modelValue"])]),_:2},1024),et]),_:2},1032,["style"])]),_:2},1032,["props"])):V("",!0)]),_:1},8,["rows","columns","pagination"])):V("",!0)]))}});var st=le(tt,[["__scopeId","data-v-6ed2e0e7"]]);const at={class:"absolute-center noBg"},lt={class:"flex flex-center"},ot={class:"absolute-left noBg"},nt={class:"Ccenter",style:{"margin-left":"27px"}},it={class:""},rt={class:"absolute-right noBg"},dt={class:"Ccenter",style:{"margin-right":"25px"}},ut={id:"points",class:"flex flex-center"},ct={key:0},ft={key:0,id:"DungeonMoreInfoWindow"},_t=se({__name:"DungeonViewer",props:{dungeon:{type:Object},expanded:{type:Boolean},Selected:{},totalScore:{type:Number}},emits:["click"],setup(t,{emit:a}){const n=t,{dungeon:_,expanded:l,Selected:d,totalScore:$}=Ae(n),i=F(30),v=F(20),b=F(35),P=F("Composition"),A=ae().state.data,G=k(()=>A.Dungeons),W=k(()=>A.settings);k(()=>document.location.origin);const H=re(),L=k(()=>Q.GetDefaultView(H.screen.width,W)),h=k(()=>{var y,m,x;for(let r=0;r<((m=(y=G==null?void 0:G.value)==null?void 0:y.length)!=null?m:0);r++){const B=(x=G==null?void 0:G.value)==null?void 0:x[r];if(B.keystone_id===_.value.id)return B}}),p=_e(),c=()=>{l.value?a("click",!1):a("click",h.value.keystone_id),setTimeout(()=>{var y;(y=p==null?void 0:p.proxy)==null||y.$forceUpdate()},100)},D=F(null),w=()=>{D!==void 0&&(D.clientWidth<666?(i.value=20,v.value=15,b.value=25):(b.value=35,i.value=30,v.value=20))};return(y,m)=>(s(),u("div",null,[o(ze,{src:`${h.value.imageurl}`,class:"DungeonWindow",onClick:m[1]||(m[1]=x=>c()),ref_key:"DungeonWindow",ref:D},{default:f(()=>[o(Me,{onResize:m[0]||(m[0]=x=>w())}),e("div",at,[e("div",lt,[e("div",{id:"nameBox",style:q("font-size:"+i.value+"px;")},g(h.value.short_name),5)])]),e("div",ot,[e("div",nt,[e("div",{class:"flex flex-center",id:"rankBox",style:q("font-size:"+v.value+"px; width: "+b.value+"px; height: "+b.value+"px;")},[e("div",it,g(R(_).rank),1)],4)])]),e("div",rt,[e("div",dt,[e("div",ut,[e("div",{style:q("font-size:"+v.value+"px;"),class:"flex"},[C(g(R(_).display_score)+" ",1),W.value.score_type=="percent"?(s(),u("div",ct,"%")):V("",!0)],4),o(O,null,{default:f(()=>[e("p",null,"Total Runs: "+g(R(_).total_runs),1),(s(!0),u(T,null,M(R(_).runs,(x,r)=>(s(),u("p",{class:"",key:r}," +"+g(r)+": "+g(x),1))),128))]),_:1})])])])]),_:1},8,["src"]),R(l)?(s(),u("div",ft,[o(ie,{class:"background"},{default:f(()=>[o(pe,{modelValue:P.value,"onUpdate:modelValue":m[2]||(m[2]=x=>P.value=x),animated:"",swipeable:"",class:"HeaderFontv2",align:"justify"},{default:f(()=>[o(X,{default:"",name:"Composition",label:"Best Composition"}),o(X,{name:"Class",label:"Best Class"}),o(X,{name:"Spec",label:"Best DPS Spec"})]),_:1},8,["modelValue"]),o(xe,{modelValue:P.value,"onUpdate:modelValue":m[3]||(m[3]=x=>P.value=x),animated:"",class:"background"},{default:f(()=>[o(Z,{"keep-alive":"",name:"Composition"},{default:f(()=>[o(K,{style:{height:"700px"}},{default:f(()=>[o(Se,{dungeon:h.value.zone},null,8,["dungeon"])]),_:1})]),_:1}),o(Z,{"keep-alive":"",name:"Class"},{default:f(()=>[o(K,{style:{height:"600px"}},{default:f(()=>[L.value==="table"?(s(),S(be,{key:0,dungeon:R(_).id},null,8,["dungeon"])):(s(),S(ye,{key:1,dungeon:h.value.zone},null,8,["dungeon"]))]),_:1})]),_:1}),o(Z,{"keep-alive":"",name:"Spec"},{default:f(()=>[o(K,{style:{height:"600px"}},{default:f(()=>[L.value==="table"?(s(),S(ke,{key:0,dungeon:R(_).id},null,8,["dungeon"])):(s(),S(we,{key:1,dungeon:h.value.zone},null,8,["dungeon"]))]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})])):V("",!0)]))}});const vt={components:{CloudinaryFormat:Ie},data(){return{data:null,fetching:!1,error:!1}},created(){this.SelectedPeriode&&this.fetchData()},computed:{...me(["SelectedPeriode","GetDungeons"]),Settings(){return this.$store.state.data.settings}},methods:{getValidLink(t,a){return t||a},fetchData(){var t=this;t.fetching=!0;var a=this.$store.state.data.apiUrl;ee.get(a+"/Dungeon/ontimerate?periode="+this.SelectedPeriode.id+"&min_level="+this.Settings.min_keystonelevel+"&amount="+this.Settings.max_runs+"&limitToLowestDungeon="+this.Settings.limitbylowestdungeon).then(function(n){t.data=n.data,t.fetching=!1}).catch(function(n){console.log(n),t.error=!0,t.fetching=!1})},DungeonDetails(t){for(let a=0;a<this.GetDungeons.length;a++){const n=this.GetDungeons[a];if(n.keystone_id==t)return n}}},watch:{SelectedPeriode(){this.data=null,this.error=!1,this.fetchData()}}},gt={key:0,class:"HeaderFont text-center"},mt=e("h2",null,"Success rate",-1),ht={class:"flex flex-center"},pt={class:"percentBackground absolute-center"},xt={class:"textBox"},bt={class:"text-center",style:{margin:"auto"}};function yt(t,a,n,_,l,d){const $=he("CloudinaryFormat");return l.data?(s(),u("div",gt,[mt,e("div",ht,[(s(!0),u(T,null,M(l.data,(i,v)=>{var b,P;return s(),u("div",{class:"flex flex-between ListCSS",key:v},[o(O,null,{default:f(()=>[C(" Runs: "+g(i.total_runs),1)]),_:2},1024),o($,{url:(b=d.DungeonDetails(i.id))==null?void 0:b.imageurl},{default:f(({link:j})=>[e("div",{id:"DungeonDot",class:"text-center shadow-24 relative-position",style:q({"background-image":`url(${j})`})},[e("div",pt,[e("div",xt,g(i.ontime_percent.toFixed(0))+"%",1)])],4)]),_:2},1032,["url"]),e("div",bt,g((P=d.DungeonDetails(i.id))==null?void 0:P.name),1)])}),128))])])):V("",!0)}var kt=le(vt,[["render",yt]]);const U=t=>(de("data-v-28734b9a"),t=t(),ue(),t),wt={key:0,class:"text-center HeaderFont"},St=U(()=>e("div",null,[e("h2",null,"What week is best for what dungeon?")],-1)),Dt={class:"flex justify-center"},Pt={class:"affixInfoFieldRight"},Ft=U(()=>e("p",null,"From",-1)),Bt={class:"flex"},Tt={style:{width:"200px"}},Vt=U(()=>e("br",null,null,-1)),Ct=U(()=>e("br",null,null,-1)),$t={class:"affixInfoFieldLeft"},At=U(()=>e("p",null,"To",-1)),Mt={class:"flex"},zt={class:"flex justify-center"},It={class:"percentBackground absolute-center"},Ht={style:{width:"135px"},class:"flex justify-center"},Rt={key:0},Qt={key:1},Gt={key:2},Lt={class:"text-center",style:{margin:"auto"}},Ut={class:"text-center",style:{width:"100%","border-bottom":"solid 1px, black"}},jt=U(()=>e("div",{class:"flex justify-around",style:{width:"100%"}},[e("div",{class:"tableField"},"Period"),e("div",{class:"tableField"},"Affixes"),e("div",{class:"tableField"},"Score"),e("div",{class:"tableField"},"Average Score"),e("div",{class:"tableField"},"Success Rate")],-1)),Wt={class:"tableField"},qt={class:"tableField"},Nt={class:"flex"},Ot={class:"tableField"},Yt={class:"tableField"},Et={class:"tableField"},Jt=U(()=>e("br",null,null,-1)),Kt=U(()=>e("div",{class:"flex flex-center"},[e("h6",{id:"OverallTitle"},"Best overall week")],-1)),Xt={class:"flex flex-center"},Zt={class:"TotalView flex justify-around"},es={class:"text-center",style:{width:"100%","border-bottom":"solid 1px, black"}},ts=U(()=>e("div",{class:"flex justify-around",style:{width:"100%"}},[e("div",{class:"tableField"},"Periode"),e("div",{class:"tableField"},"Affixes"),e("div",{class:"tableField"},"Score"),e("div",{class:"tableField"},"Average Score"),e("div",{class:"tableField"},"Success Rate")],-1)),ss={class:"tableField"},as={class:"tableField"},ls={class:"flex"},os={class:"tableField"},ns={class:"tableField"},is={class:"tableField"},rs={class:"flex flex-center"},ds={class:"flex flex-center scoreView"},us={key:0},cs={key:1},fs={key:2},_s=U(()=>e("br",null,null,-1)),vs=U(()=>e("br",null,null,-1)),gs=se({__name:"BestWeekForAffix",setup(t){const a=F(null),n=F(null),_=F("success_rate"),l=F(null);F(!0),F({rowsPerPage:15,page:1});const d=F(null);F([{name:"periode",label:"Periode",field:"periode",sortable:!0},{name:"affixes",label:"Affixes",field:"affixes",sortable:!0},{name:"total_score",label:"Total Score",field:"total_score",sortable:!0},{name:"avg_score",label:"Average Score",field:"avg_score",sortable:!0},{name:"success_rate",label:"Success Rate",field:"success_rate",sortable:!0}]),J(a,()=>{var h=setTimeout(function(){d.value==h&&W()},1e3);d.value=h});const i=ae().state.data,v=k(()=>i.Dungeons);k(()=>i.Affixes);const b=()=>{if(l.value){var h=[...l.value].filter(p=>p[0].dungeon!==null)[0];return h}},P=h=>{var p=[];for(let D=0;D<h.length;D++){const w=h[D];var c={periode:w.periode,affixes:H(w.periode).affixes,total_score:w.score,avg_score:w.score/w.runs,success_rate:w.success_rate};p.push(c)}return Q._sortBy(p,_.value).reverse()},j=h=>{var p,c,D;for(let w=0;w<((c=(p=v==null?void 0:v.value)==null?void 0:p.length)!=null?c:0);w++){const y=(D=v==null?void 0:v.value)==null?void 0:D[w];if(y.id==h)return y}},A=h=>{if(!h)return null;var p=[];for(let w=0;w<h.length;w++){const y=h[w];var c=y.score/1e3;y.total_score=c;var D=y.score/y.runs;y.avg_score=D}return p=Q._sortBy(h,_.value).reverse(),p[0]},G=()=>{var h=i.apiUrl;ee.get(h+"/Periode?weeks=50").then(function(p){n.value=Q._sortBy(p.data,"id"),a.value={min:n.value[n.value.length-1].id-10,max:n.value[n.value.length-1].id}}).catch(function(p){console.log(p)})},W=()=>{var h=i.apiUrl;ee.get(h+"/Dungeon/BestAffixSetPerDungeon?fromPeriode="+a.value.min+"&toPeriode="+a.value.max).then(function(p){var c;l.value=(c=p.data)==null?void 0:c.map(D=>D.list)}).catch(function(p){console.log(p)})},H=h=>{for(let p=0;p<n.value.length;p++){const c=n.value[p];if(c.id===h)return c}},L=h=>Q.GetMoment(h).format("MMMM Do YYYY");return ve(()=>{G()}),(h,p)=>(s(),u(T,null,[a.value&&l.value?(s(),u("div",wt,[St,e("div",Dt,[e("div",Pt,[Ft,e("p",null,g(L(H(a.value.min).start_timestamp)),1),e("div",Bt,[(s(!0),u(T,null,M(H(a.value.min).affixes,c=>(s(),S(c,{key:c,class:"miniAffixImg",border:!0,affixid:c,detailed:!0,tooltip:!0},null,8,["affixid"]))),128))])]),e("div",Tt,[C(g(a.value.max-a.value.min)+" ",1),Vt,C(" weeks "),Ct,C(" selected ")]),e("div",$t,[At,e("p",null,g(L(H(a.value.max).start_timestamp)),1),e("div",Mt,[(s(!0),u(T,null,M(H(a.value.max).affixes,c=>(s(),S(c,{key:c,class:"miniAffixImg",border:!0,affixid:c,detailed:!0,tooltip:!0},null,8,["affixid"]))),128))])])]),n.value?(s(),S(De,{key:0,modelValue:a.value,"onUpdate:modelValue":p[0]||(p[0]=c=>a.value=c),min:n.value[0].id,max:n.value[n.value.length-1].id,step:1},null,8,["modelValue","min","max"])):V("",!0),o(He,{modelValue:_.value,"onUpdate:modelValue":p[1]||(p[1]=c=>_.value=c),"toggle-color":"tertiary",options:[{label:"Total score",value:"total_score"},{label:"Success rate",value:"success_rate"},{label:"Average score",value:"avg_score"}]},null,8,["modelValue"]),e("div",zt,[(s(!0),u(T,null,M(l.value.filter(c=>{var D;return((D=c[0])==null?void 0:D.zone)!=-2}),c=>{var D,w,y,m,x,r,B;return s(),u("div",{class:"ListCSS",key:(D=A(c))==null?void 0:D.dungeon},[c&&((w=A(c))==null?void 0:w.dungeon)?(s(),u(T,{key:0},[e("div",{id:"DungeonDot",class:"text-center shadow-24 relative-position",style:q({"background-image":"url("+((m=j((y=A(c))==null?void 0:y.dungeon))==null?void 0:m.imageurl)+")"})},[e("div",It,[e("div",null,[e("div",Ht,[(s(!0),u(T,null,M((r=H((x=A(c))==null?void 0:x.periode))==null?void 0:r.affixes,I=>(s(),S(I,{key:I,class:"microAffixImg",border:!1,affixid:I,detailed:!1,tooltip:!0},null,8,["affixid"]))),128))]),_.value==="success_rate"?(s(),u("div",Rt," Success rate: "+g(A(c).success_rate.toFixed(0))+"% ",1)):V("",!0),_.value==="total_score"?(s(),u("div",Qt," Total Score : "+g(Math.floor(A(c).total_score)),1)):V("",!0),_.value==="avg_score"?(s(),u("div",Gt," Average Score: "+g(Math.floor(A(c).avg_score)),1)):V("",!0)])])],4),e("div",Lt,g((B=j(A(c).dungeon))==null?void 0:B.name),1),o(O,null,{default:f(()=>[e("div",Ut,[jt,(s(!0),u(T,null,M(P(c),I=>(s(),u("div",{class:"flex justify-around",style:{width:"100%"},key:I.periode},[e("div",Wt,g(I.periode),1),e("div",qt,[e("div",Nt,[(s(!0),u(T,null,M(I.affixes,E=>(s(),S(E,{key:E,class:"micoAffixImg",border:!0,affixid:E,detailed:!1,tooltip:!0},null,8,["affixid"]))),128))])]),e("div",Ot,g(Math.floor(I.total_score/1e3*100)/100),1),e("div",Yt,g(Math.floor(I.avg_score*100)/100),1),e("div",Et,g(Math.floor(I.success_rate*100)/100)+"% ",1)]))),128))])]),_:2},1024)],64)):V("",!0)])}),128))]),Jt,e("div",null,[Kt,e("div",Xt,[e("div",Zt,[(s(!0),u(T,null,M(H(A(b()).periode).affixes,c=>(s(),S(c,{size:"100%",key:c,class:"bigAffixImg",border:!1,affixid:c,detailed:!1,tooltip:!1},null,8,["affixid"]))),128))]),o(O,null,{default:f(()=>[e("div",es,[ts,(s(!0),u(T,null,M(P(b()),c=>(s(),u("div",{class:"flex justify-around",style:{width:"100%"},key:c.periode},[e("div",ss,g(c.periode),1),e("div",as,[e("div",ls,[(s(!0),u(T,null,M(c.affixes,D=>(s(),S(D,{key:D,class:"micoAffixImg",border:!0,affixid:D,detailed:!1,tooltip:!1},null,8,["affixid"]))),128))])]),e("div",os,g(Math.floor(c.total_score/1e3*100)/100),1),e("div",ns,g(Math.floor(c.avg_score*100)/100),1),e("div",is,g(Math.floor(c.success_rate*100)/100)+"% ",1)]))),128))])]),_:1})]),e("div",rs,[e("div",ds,[_.value==="success_rate"?(s(),u("div",us," Success rate: "+g(A(b()).success_rate.toFixed(0))+"% ",1)):V("",!0),_.value==="total_score"?(s(),u("div",cs," Total Score : "+g(Math.floor(A(b()).total_score)),1)):V("",!0),_.value==="avg_score"?(s(),u("div",fs," Average Score: "+g(Math.floor(A(b()).avg_score)),1)):V("",!0)])])])])):V("",!0),_s,vs],64))}});var ms=le(gs,[["__scopeId","data-v-28734b9a"]]);function fe(t,a,n){var _,l,d,$,i;a==null&&(a=100);function v(){var P=Date.now()-$;P<a&&P>=0?_=setTimeout(v,a-P):(_=null,n||(i=t.apply(d,l),d=l=null))}var b=function(){d=this,l=arguments,$=Date.now();var P=n&&!_;return _||(_=setTimeout(v,a)),P&&(i=t.apply(d,l),d=l=null),i};return b.clear=function(){_&&(clearTimeout(_),_=null)},b.flush=function(){_&&(i=t.apply(d,l),d=l=null,clearTimeout(_),_=null)},b}fe.debounce=fe;const hs={components:{affix:Le},data(){return{dungeonPaginationControl:{rowsPerPage:20,page:1,sortBy:"intime_rate",descending:!0},subdungeonPaginationControl:{rowsPerPage:30,page:1,sortBy:"periode",descending:!0},dungeonColumns:[{name:"view",label:"",align:"left"},{name:"dungeon",label:"Dungeon",sortable:!0,field:t=>DungeonDetails(t.dungeon).name,align:"left"},{name:"affixes",label:"Affixes",align:"center"},{name:"tscore",label:"Total Score",field:t=>this.getBestPeriode(t.list).tscore,sortable:!0,align:"center"},{name:"ascore",label:"Average score",field:t=>this.getBestPeriode(t.list).ascore,sort:(t,a,n,_)=>this.getBestPeriode(n.list).ascore-this.getBestPeriode(_.list).ascore,sortable:!0,align:"center"},{name:"intime_rate",label:"Success rate",field:t=>this.getBestPeriode(t.list).success_rate,sortable:!0,align:"center"}],subdungeonColumns:[{name:"periode",label:"Period",align:"center",field:t=>t.periode,sortable:!0},{name:"affixes",label:"Affixes",align:"center",field:t=>this.periodeDetails(t.periode).affixes,sortable:!0},{name:"tscore",label:"Total Score",field:t=>t.tscore,sortable:!0,align:"center"},{name:"ascore",label:"Average score",field:t=>t.ascore,sort:(t,a,n,_)=>n.ascore-_.ascore,sortable:!0,align:"center"},{name:"intime_rate",label:"Success rate",field:t=>t.success_rate,sortable:!0,align:"center"}],rangeValues:null,allPeriodes:null,type:"success_rate",data:null,successRate:!0,paginationControl:{rowsPerPage:15,page:1},bounce:null,columns:[{name:"periode",label:"Periode",field:"periode",sortable:!0},{name:"affixes",label:"Affixes",field:"affixes",sortable:!0},{name:"total_score",label:"Total Score",field:"total_score",sortable:!0},{name:"avg_score",label:"Average Score",field:"avg_score",sortable:!0},{name:"success_rate",label:"Success Rate",field:"success_rate",sortable:!0}]}},watch:{dungeonPaginationControl(t,a){var n=t.sortBy;t==null&&(n=a.sortBy),n=="intime_rate"?(this.type="success_rate",this.subdungeonPaginationControl.sortBy="intime_rate"):n=="tscore"?(this.type="total_score",this.subdungeonPaginationControl.sortBy="tscore"):n=="ascore"&&(this.type="avg_score",this.subdungeonPaginationControl.sortBy="ascore")},rangeValues(){var t=this,a=setTimeout(function(){t.bounce==a&&t.getData()},1e3);this.bounce=a,this.BestAffixList}},computed:{...me(["GetDungeons","GetAffixes"])},methods:{BestAffixList(){if(this.data){var t=this.data.filter(a=>!a.dungeon||!a.zone||a.dungeon===-2||a.zone===-2)[0].list;return t}},GetTableFriendlyData(t){var a=[];for(let _=0;_<t.length;_++){const l=t[_];var n={periode:l.periode,affixes:this.periodeDetails(l.periode).affixes,total_score:l.score,avg_score:l.score/l.runs,success_rate:l.success_rate};a.push(n)}return Q._sortBy(a,this.type).reverse()},GetAffixDetails(t){for(let a=0;a<this.GetAffixes.length;a++){const n=this.GetAffixes[a];if(n.id==t)return n}},DungeonDetails(t){for(let a=0;a<this.GetDungeons.length;a++){const n=this.GetDungeons[a];if(n.keystone_id==t)return n}},getBestPeriode(t){var a=[];for(let l=0;l<t.length;l++){const d=t[l];var n=d.score/1e3;d.total_score=n;var _=d.score/d.runs;d.avg_score=_}return a=Q._sortBy(t,this.type).reverse(),a[0]},getPeriodes(){var t=this,a=this.$store.state.data.apiUrl;ee.get(a+"/Periode?weeks=50").then(function(n){t.allPeriodes=Q._sortBy(n.data,"id"),t.rangeValues={min:t.allPeriodes[t.allPeriodes.length-1].id-10,max:t.allPeriodes[t.allPeriodes.length-1].id}}).catch(function(n){console.log(n)})},getData(){var t=this,a=this.$store.state.data.apiUrl;ee.get(a+"/Dungeon/BestAffixSetPerDungeon?fromPeriode="+t.rangeValues.min+"&toPeriode="+t.rangeValues.max).then(function(n){n.data=n.data.map(d=>d.list);var _=[];for(let d=0;d<n.data.length;d++){const $=n.data[d];var l=[];for(let i=0;i<$.length;i++){const v=$[i];v.tscore=v.score,v.ascore=Q.GetPoints(v.tscore,"mean",0,v.runs),l.push(v)}_.push({dungeon:l[0].zone||null,list:l})}t.data=_}).catch(function(n){console.log(n)})},periodeDetails(t){for(let a=0;a<this.allPeriodes.length;a++){const n=this.allPeriodes[a];if(n.id===t)return n}},FormatDate(t){return Q.GetMoment(t).format("MMMM Do YYYY")}},created(){this.getPeriodes()}},Y=t=>(de("data-v-2b430d8a"),t=t(),ue(),t),ps={id:"Main",class:"relative"},xs={class:"text-center HeaderFont"},bs=Y(()=>e("div",{class:""},[e("h2",null,"What week is best for what dungeon?")],-1)),ys={key:0,class:"flex justify-center"},ks={class:"affixInfoFieldRight"},ws=Y(()=>e("p",{class:""},"From",-1)),Ss={class:"flex"},Ds={key:0,style:{width:"200px"}},Ps=Y(()=>e("br",null,null,-1)),Fs=Y(()=>e("br",null,null,-1)),Bs={key:1,class:"affixInfoFieldLeft"},Ts=Y(()=>e("p",null,"To",-1)),Vs={class:"flex"},Cs={key:2},$s={class:""},As={class:"flex justify-center"},Ms={class:"flex justify-center"},zs=Y(()=>e("div",{class:"flex flex-center"},[e("h6",{id:"OverallTitle"},"Best overall week")],-1)),Is={class:"flex flex-center"},Hs={class:"TotalView flex justify-around"},Rs={class:"text-center",style:{width:"100%","border-bottom":"solid 1px, black"}},Qs=Y(()=>e("div",{class:"flex justify-around",style:{width:"100%"}},[e("div",{class:"tableField"},"Periode"),e("div",{class:"tableField"},"Affixes"),e("div",{class:"tableField"},"Score"),e("div",{class:"tableField"},"Average Score"),e("div",{class:"tableField"},"Success Rate")],-1)),Gs={class:"tableField"},Ls={class:"tableField"},Us={class:"flex"},js={class:"tableField"},Ws={class:"tableField"},qs={class:"tableField"},Ns={class:"flex flex-center"},Os={class:"flex flex-center scoreView"},Ys={key:0},Es={key:1},Js={key:2};function Ks(t,a,n,_,l,d){const $=he("affix");return s(),u("div",ps,[e("div",xs,[bs,l.rangeValues?(s(),u("div",ys,[e("div",ks,[ws,e("p",null,g(d.FormatDate(d.periodeDetails(l.rangeValues.min).start_timestamp)),1),e("div",Ss,[(s(!0),u(T,null,M(d.periodeDetails(l.rangeValues.min).affixes,i=>(s(),S($,{key:i,size:35,border:!0,affixid:i,detailed:!0,tooltip:!0},null,8,["affixid"]))),128))])]),l.rangeValues?(s(),u("div",Ds,[C(g(l.rangeValues.max-l.rangeValues.min)+" ",1),Ps,C("weeks "),Fs,C("selected ")])):V("",!0),l.rangeValues?(s(),u("div",Bs,[Ts,e("p",null,g(d.FormatDate(d.periodeDetails(l.rangeValues.max).start_timestamp)),1),e("div",Vs,[(s(!0),u(T,null,M(d.periodeDetails(l.rangeValues.max).affixes,i=>(s(),S($,{key:i,size:35,border:!0,affixid:i,detailed:!0,tooltip:!0},null,8,["affixid"]))),128))])])):V("",!0)])):V("",!0),l.allPeriodes?(s(),S(De,{key:1,modelValue:l.rangeValues,"onUpdate:modelValue":a[0]||(a[0]=i=>l.rangeValues=i),min:l.allPeriodes[0].id,max:l.allPeriodes[l.allPeriodes.length-1].id,step:1},null,8,["modelValue","min","max"])):V("",!0),l.rangeValues&&l.data?(s(),u("div",Cs,[e("div",$s,[o(ne,{"rows-per-page-options":[],"card-class":"background HeaderFont","table-class":"HeaderFont","table-header-class":"HeaderFont",dark:"",flat:"",rows:l.data.filter((i,v)=>i.dungeon!=null&&i.dungeon!==-2),columns:l.dungeonColumns,pagination:l.dungeonPaginationControl,"hide-bottom":"","row-key":"dungeon"},{body:f(i=>[o(te,{props:i},{default:f(()=>[o(z,null,{default:f(()=>[o(ge,{style:q(`background-image: url(${d.DungeonDetails(i.row.dungeon).imageurl});`),class:"darkOverlay",round:"",flat:"",icon:i.expand?"arrow_drop_up":"arrow_drop_down",onClick:v=>i.expand=!i.expand},null,8,["style","icon","onClick"])]),_:2},1024),o(z,{key:"dungeon",props:i},{default:f(()=>[C(g(d.DungeonDetails(i.row.dungeon).name),1)]),_:2},1032,["props"]),o(z,{key:"affixes",props:i},{default:f(()=>[e("div",As,[(s(!0),u(T,null,M(d.periodeDetails(d.getBestPeriode(i.row.list).periode).affixes,(v,b)=>(s(),S($,{key:b,affixid:v},null,8,["affixid"]))),128))])]),_:2},1032,["props"]),o(z,{key:"tscore",props:i},{default:f(()=>[C(g(Math.round(d.getBestPeriode(i.row.list).tscore)),1)]),_:2},1032,["props"]),o(z,{key:"ascore",props:i},{default:f(()=>[C(g(d.getBestPeriode(i.row.list).ascore),1)]),_:2},1032,["props"]),o(z,{key:"intime_rate",props:i},{default:f(()=>[C(g(Math.round(d.getBestPeriode(i.row.list).success_rate*100)/100)+"%",1)]),_:2},1032,["props"])]),_:2},1032,["props"]),i.expand?(s(),S(te,{key:0,class:"hideHoverGlobal",props:i},{default:f(()=>[o(z,{colspan:"100%"},{default:f(()=>[o(ne,{"rows-per-page-options":[],"card-class":"background HeaderFont","table-class":"HeaderFont","table-header-class":"HeaderFont",dark:"",dense:"",flat:"",rows:i.row.list,columns:l.subdungeonColumns,pagination:l.subdungeonPaginationControl,"hide-bottom":"","row-key":"dungeon"},{body:f(v=>[o(te,{props:v},{default:f(()=>[o(z,{key:"periode",props:v},{default:f(()=>[C(g(Math.round(v.row.periode)),1)]),_:2},1032,["props"]),o(z,{key:"affixes",props:v},{default:f(()=>[e("div",Ms,[(s(!0),u(T,null,M(d.periodeDetails(v.row.periode).affixes,(b,P)=>(s(),S($,{key:P,affixid:b},null,8,["affixid"]))),128))])]),_:2},1032,["props"]),o(z,{key:"tscore",props:v},{default:f(()=>[C(g(Math.round(v.row.tscore)),1)]),_:2},1032,["props"]),o(z,{key:"ascore",props:v},{default:f(()=>[C(g(v.row.ascore),1)]),_:2},1032,["props"]),o(z,{key:"intime_rate",props:v},{default:f(()=>[C(g(Math.round(v.row.success_rate*100)/100)+"%",1)]),_:2},1032,["props"])]),_:2},1032,["props"])]),_:2},1032,["rows","columns","pagination"])]),_:2},1024)]),_:2},1032,["props"])):V("",!0)]),_:1},8,["rows","columns","pagination"])]),e("div",null,[zs,e("div",Is,[e("div",Hs,[(s(!0),u(T,null,M(d.periodeDetails(d.getBestPeriode(d.BestAffixList()).periode).affixes,i=>(s(),S($,{key:i,size:70,border:!1,affixid:i,detailed:!1,tooltip:!1},null,8,["affixid"]))),128))]),o(O,null,{default:f(()=>[e("div",Rs,[Qs,(s(!0),u(T,null,M(d.GetTableFriendlyData(d.BestAffixList()),i=>(s(),u("div",{class:"flex justify-around",style:{width:"100%"},key:i.periode},[e("div",Gs,g(i.periode),1),e("div",Ls,[e("div",Us,[(s(!0),u(T,null,M(i.affixes,v=>(s(),S($,{key:v,class:"micoAffixImg",border:!0,affixid:v,detailed:!1,tooltip:!1},null,8,["affixid"]))),128))])]),e("div",js,g(Math.floor(i.total_score/1e3*100)/100),1),e("div",Ws,g(Math.floor(i.avg_score*100)/100),1),e("div",qs,g(Math.floor(i.success_rate*100)/100)+"%",1)]))),128))])]),_:1})]),e("div",Ns,[e("div",Os,[l.type==="success_rate"?(s(),u("div",Ys,"Success rate: "+g(d.getBestPeriode(d.BestAffixList()).success_rate.toFixed(0))+"%",1)):V("",!0),l.type==="total_score"?(s(),u("div",Es,"Total Score : "+g(Math.floor(d.getBestPeriode(d.BestAffixList()).total_score)),1)):V("",!0),l.type==="avg_score"?(s(),u("div",Js,"Average Score: "+g(Math.floor(d.getBestPeriode(d.BestAffixList()).avg_score)),1)):V("",!0)])])])])):(s(),S(oe,{key:3,class:"absolute-center",style:{color:"rgb(161, 161, 161)"},size:200}))])])}var Xs=le(hs,[["render",Ks],["__scopeId","data-v-2b430d8a"]]);const Zs=e("div",{class:"flex flex-center"},[e("div",{class:"Centertext HeaderSize HeaderFont"},` What's the "best" dungeon this week? `)],-1),ea=e("div",{class:"flex flex-center"},[e("p",{class:"HeaderFont HeaderSize2"},"(ish)")],-1),ta={key:0,class:"flex flex-center"},sa={key:1,class:"HeaderFont nodataInfo"},aa=e("h4",{class:"flex flex-center"},"No data found!",-1),la=e("p",{class:"flex flex-center"},"Try to change the settings up in the right",-1),oa=[aa,la],na={key:2},ia={key:0},ra=Re('<div class="HeaderFont relative-position" style="height:20px;"><div class="absolute-left"><div class="Ccenter" style="margin-left:30px;"><div style="width:0px;">Rank</div></div></div><div class="HeaderFont dungeonTitle relative"><div class="title">Dungeon</div></div><div class="absolute-right"><div class="Ccenter" style="margin-right:32px;"><div>Score</div></div></div></div>',1),Da=se({__name:"dungeons",setup(t){F(!1);const a=F(null),n=F(!1),l=ae().state.data,d=k(()=>l.Selected),$=k(()=>l.SelectedAffixSet),i=k(()=>l.RIOData),v=k(()=>l.Dungeons_Data),b=k(()=>l.Dungeons),P=k(()=>l.SelectedPeriode),j=k(()=>l.Reloaded_Timestamp);k(()=>l.Affixes);const A=k(()=>l.Periodes),G=k(()=>l.settings),W=re(),H=k(()=>Q.GetDefaultView(W.screen.width,G.value)),L=k(()=>d);k(()=>$),k(()=>i);const h=k(()=>G);J(j,()=>{a.value=null}),J(A,()=>{l.apiUrl,n.value||A.value[0]});const p=()=>Q.GetTotalScore(v.value.data),c=D=>{const w=[...D].map(y=>({...y}));for(let y=0;y<w.length;y++){const m=w[y];m.display_score=Q.GetPoints(m.score,h.value.value.score_type,p(),m.total_runs)}return Q.getListWithRank(w)};return F(null),(D,w)=>(s(),u("div",null,[Zs,ea,o(Pe),H.value==="table"?(s(),u(T,{key:0},[o(st),o(Xs)],64)):(s(),u(T,{key:1},[P.value&&v.value&&P.value!=v.value.periode?(s(),u("div",ta,[o(Fe,{style:{color:"rgb(161, 161, 161)"},size:"500"})])):v.value&&v.value.data.filter(y=>y.score===0).length===v.value.data.length?(s(),u("div",sa,oa)):(s(),u("div",na,[P.value&&v.value&&v.value.data&&b.value?(s(),u("div",ia,[ra,(s(!0),u(T,null,M(c(v.value.data),y=>(s(),u("div",{key:y.id},[o(_t,{totalScore:p(),Selected:L.value,onClick:w[0]||(w[0]=m=>a.value=m),expanded:a.value===y.id,dungeon:y},null,8,["totalScore","Selected","expanded","dungeon"])]))),128))])):V("",!0)])),o(kt),o(ms)],64))]))}});export{Da as default};
