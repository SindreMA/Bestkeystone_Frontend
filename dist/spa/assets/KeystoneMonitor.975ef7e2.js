import{_ as p,L as w,g as d,h as s,i as a,p as g,q as x,F as v,C as _,N as M,l as R,j as n,t as r,v as f,x as S,S as V,s as k,an as b,n as C}from"./index.7dabd086.js";import{r as I,H as T,L as $}from"./runTableView.44bc8c69.js";import"./QTr.17b52ebd.js";import"./QTable.ad356e36.js";import"./QMarkupTable.268de3e8.js";import"./QCheckbox.59fa3f0d.js";import"./index.eb235304.js";import"./keystoneView.0267be68.js";import"./numeral.011df7c0.js";import"./PlayerText.a986846e.js";const B={components:{CloudinaryFormat:w},props:["runs"],methods:{getValidLink(e,t){return e||t}}},N=e=>(f("data-v-aef151aa"),e=e(),S(),e),F={class:"flex justify-around"},D={class:"flex justify-around"},j=N(()=>n("br",null,null,-1));function A(e,t,o,h,u,i){const c=d("CloudinaryFormat");return s(),a("div",null,[g(c,{url:e.DungeonDetails(e.dungeon.id).imageurl},{default:x(({link:m})=>[(s(!0),a(v,null,_(o.runs,(l,E)=>(s(),a("div",{class:"newRun shadow-15",style:M(`background-image: ${`url(  ${m}) `} `)},[R(' :key="index"> '),n("div",F,[n("div",null,r(l.zone.name),1),n("div",null,r(l.level),1)]),n("div",D,[(s(!0),a(v,null,_(l.players,(y,L)=>(s(),a("div",{key:L},r(y.name),1))),128))]),j],4))),256))]),_:1},8,["url"])])}var H=p(B,[["render",A],["__scopeId","data-v-aef151aa"]]);const U={props:["length"],components:{runTableView:I,runClassicView:H},data(){return{monitorRuns:!0,runsToShow:6,connection:"",runs:[],SortedList:[]}},methods:{viewMode(){return V.GetDefaultView(this,this.GetSettings)},startMonitor(){var e=this;e.connection.state!==1&&(e.monitorRuns&&(e.connection.state===0||e.connection.state==="disconnected")?e.connection.start():setTimeout(t=>{e.startMonitor()},1e3))},checkThatMonitorIsRunning(){var e=this;setTimeout(t=>{e.startMonitor(),e.checkThatMonitorIsRunning()},1e4)}},computed:{runsPerSec(){if(this.SortedList.length>3){var e=this.SortedList[0],t=this.SortedList[this.SortedList.length-1];return e.time.created-t.time.created!==0?Math.round(this.SortedList.length/(e.time.created-t.time.created)*100)/100:"Not fetching atm"}else return"Not fetching atm"},avgScore(){var e=0;for(let t=0;t<this.SortedList.length;t++)e+=this.SortedList[t].score;return Math.round(e/this.SortedList.length*100)/100},avgLevel(){var e=0;for(let t=0;t<this.SortedList.length;t++)e+=this.SortedList[t].level;return Math.round(e/this.SortedList.length*100)/100},avgSuccessRate(){var e=this.SortedList.filter(t=>t.time.ontime);return Math.round(e.length/this.SortedList.length*100*100)/100}},created(){var e=this.$store.state.data.apiUrl;this.connection=new T().withUrl(e.slice(0,-4)+"/KeystoneHub").configureLogging($.Information).build();var t=this;this.connection.on("disconnected",o=>{settimeout(h=>{t.startMonitor()},1e3)})},async mounted(){var e=this;await e.connection.start(),this.checkThatMonitorIsRunning(),e.connection.invoke("RequestNewestRuns",15),e.connection.on("GetNewestRuns",function(t){e.runs=[...t]}),e.connection.on("NewRunAdded",function(t){e.runs.push(t),e.runs.length>20&&(e.runs=e.runs.slice(Math.max(e.runs.length-20,1)))})},beforeDestroy(){this.connection.stop()},watch:{monitorRuns(){this.monitorRuns?(console.log("Starting connection.."),this.startMonitor()):(console.log("Stopping connection.."),this.connection.stop())},runs(){var e=[];for(let t=0;t<this.runs.length;t++){const o=this.runs[t];o.index=this.runs.length-t-1,e.push(o)}this.SortedList=k.sortBy(e,t=>t.index)}}},G=e=>(f("data-v-60ab2292"),e=e(),S(),e),K={class:"HeaderFont"},q=G(()=>n("div",null,"Data from last 10 runs:",-1)),z={class:"flex justify-around"},O={class:"flex justify-end"};function P(e,t,o,h,u,i){const c=d("runTableView"),m=d("runClassicView");return s(),a("div",K,[q,n("div",z,[n("div",null,"Runs per secound: "+r(i.runsPerSec),1),n("div",null,"Average score: "+r(i.avgScore),1),n("div",null,"Average level: "+r(i.avgLevel),1),n("div",null,"Average success rate: "+r(i.avgSuccessRate)+"%",1)]),n("div",O,[g(b,{modelValue:u.monitorRuns,"onUpdate:modelValue":t[0]||(t[0]=l=>u.monitorRuns=l),class:"shadow-24","no-caps":"",dark:"","toggle-color":"primary",options:[{label:"On",value:!0},{label:"Off",value:!1}]},null,8,["modelValue"])]),(i.viewMode,s(),C(c,{key:0,runs:u.SortedList,title:"Live runs monitor"},null,8,["runs"]))])}var se=p(U,[["render",P],["__scopeId","data-v-60ab2292"]]);export{se as default};
