import{Q as J,a as K,b as C,c as X}from"./QTabPanels.f4441b25.js";import{_ as M,h as m,i as p,p as s,q as l,j as o,M as Y,t as _,ac as ee,n as G,d as I,B as L,u as j,c as P,g as w,L as N,k as y,N as W,ae as R,O as te,r as re,m as v,Q as B,z as F,af as ae,F as $,C as V,y as ne,S as H,v as se,x as le,a as ie}from"./index.d11fe415.js";import{Q as O}from"./QSkeleton.48d2cc7f.js";import{Q as q,a as b}from"./QTr.a8711b58.js";import{Q as A}from"./QTable.4edb768e.js";import{Q as oe}from"./QOptionGroup.854367f2.js";import{Q as ue}from"./QRange.a07c222b.js";import{a as de}from"./AffixSelector.70556ef8.js";import"./use-cache.b0833c75.js";import"./QMarkupTable.d0e5140e.js";import"./QCheckbox.383fd197.js";const ce={props:["tab"],data(){return{_tab:"members"}},watch:{tab(){this.$emit("changedTab",this._tab)}},created(){this.tab&&(this._tab=this.tab)}},me={class:"HeaderFont"};function _e(e,t,r,i,a,d){return m(),p("div",me,[s(K,{"narrow-indicator":"",modelValue:a._tab,"onUpdate:modelValue":t[0]||(t[0]=f=>a._tab=f),swipeable:"",align:"justify"},{default:l(()=>[s(J,{name:"members",label:"Members"})]),_:1},8,["modelValue"])])}var ge=M(ce,[["render",_e]]);const fe={props:["guild"],data(){return{timer:null,timerText:null}},methods:{capitalize(e){return typeof e!="string"?"":e.charAt(0).toUpperCase()+e.slice(1)},updateTrigger(){this.$emit("Update")},startTimer(){var e=this;if(this.guild){var t=Math.round(new Date().getTime()/1e3);e.timerText=e.guild.created-(t-3600)}var r=setTimeout(()=>{e.startTimer()},6e4);this.timer=r}},watch:{guild(){if(this.guild){var e=Math.round(new Date().getTime()/1e3);this.timerText=this.guild.created-(e-3600)}}},created(){this.startTimer()},destroyed(){this.timer&&clearTimeout(this.timer)}},he={key:0,class:"HeaderFont MainContainer shadow-24 flex justify-between"},pe={class:"flex"},ye={class:"DataTextField flex justify-around"};function ve(e,t,r,i,a,d){return r.guild?(m(),p("div",he,[o("div",null,[o("h2",{class:Y(`${r.guild.faction.toLowerCase()}`)},[o("strong",null,_(r.guild.name),1)],2),o("div",pe,[o("div",null,"("+_(r.guild.region.toUpperCase())+") ",1),o("div",null,_(d.capitalize(r.guild.realm)),1)])]),o("div",ye,[o("div",null,[o("h6",null,"Members: "+_(r.guild.members.length),1)]),o("div",null,[s(ee,{disable:!(a.timerText<0),onClick:t[0]||(t[0]=f=>d.updateTrigger()),class:"GreyBackground",label:a.timerText<0?"Update Guild":`Can be updated in ${Math.round(a.timerText/60)} min`,outline:""},null,8,["disable","label"])])])])):(m(),G(O,{key:1,class:"MainContainer"}))}var be=M(fe,[["render",ve],["__scopeId","data-v-634c371e"]]);const ke={class:"GreyTransOverlay ContainerSize"},we={style:{"font-size":"14px"}},Ge=I({__name:"dungeonRunMini",props:{run:{type:Object,required:!0}},setup(e){const t=e,{run:r}=L(t),i=g=>te.duration(g).format("hh:mm:ss"),d=j().state.data,f=P(()=>d.Dungeons),n=P(()=>f.value.find(g=>g.keystone_id==r.value.zone));return(g,S)=>{const c=w("router-link");return m(),G(c,{to:`/lookup/run/${y(r).id}`},{default:l(()=>{var h;return[s(N,{url:(h=y(n))==null?void 0:h.imageurl},{default:l(({link:x})=>[o("div",{class:"HeaderFont MainContainer ContainerSize text-center",style:W("background-image: url("+x+");")},[o("div",ke,[o("strong",we,_(y(r).keystoneLevel),1)]),s(R,null,{default:l(()=>[o("div",null,_(y(n).name)+" +"+_(y(r).keystoneLevel),1),o("div",null,_(`Cleared in ${i(y(r).duration)} out of ${i(y(n).time)}
                for score ${Math.round(y(r).score*100)/100}`),1)]),_:1})],4)]),_:1},8,["url"])]}),_:1},8,["to"])}}});var U=M(Ge,[["__scopeId","data-v-49f6abd8"]]);const Me={class:"flex",style:{gap:"5px"}},xe={class:"flex gap-5 justify-around",style:{}},Se=I({__name:"GuildMemberList",props:{guildMembers:{type:Array,required:!0},region:{type:String,required:!0}},setup(e){const t=e,{guildMembers:r,region:i}=L(t),a=[{name:"rank",align:"left",label:"Rank",field:"rank",sortable:!0,sort:(c,h)=>c-h},{name:"player",align:"left",label:"Player",field:"name",sortable:!0,sort:(c,h)=>c-h},{name:"dungeons",align:"left",label:"Dungeons",field:c=>c.run_data.seasonBestRuns,sortable:!1},{name:"weekly",align:"right",label:"Completed this week",field:c=>c.run_data.weeklyRuns.length,sortable:!0},{name:"score",label:"Score",format:c=>Math.round(c),field:c=>c.run_data?c.run_data.score:0,sortable:!0,sort:(c,h)=>c-h}],d=re({sortBy:"score",descending:!0,rowsPerPage:20}),n=j().state.data;P(()=>n.Specs);const g=P(()=>n.Classes),S=c=>{if(g.value)for(let h=0;h<g.value.length;h++){const x=g.value[h];if(x.id==c)return x}};return(c,h)=>{const x=w("router-link");return m(),p("div",null,[s(A,{title:"Guild Members",rows:y(r),columns:a,"row-key":"id",dark:"",color:"amber",pagination:d.value},{body:l(u=>[s(q,{props:u},{default:l(()=>[s(b,{key:"rank",props:u},{default:l(()=>[s(N,{url:"icons/crown.png"},{default:l(({link:k})=>[v(_(u.row.rank+1)+" ",1),u.row.rank==0?(m(),G(B,{key:0,"spinner-size":"15px","spinner-color":"white",class:"crownIcon",src:k},{default:l(()=>[s(R,null,{default:l(()=>[v("Guild Master")]),_:1})]),_:2},1032,["src"])):F("",!0)]),_:2},1032,["url"])]),_:2},1032,["props"]),s(b,{key:"player",props:u},{default:l(()=>{var k;return[o("div",Me,[s(B,{"spinner-size":"15px","spinner-color":"white",class:"tableIcon",src:(k=S(u.row._class))==null?void 0:k.icon_url},null,8,["src"]),s(ae,{_class:u.row._class},{default:l(()=>[s(x,{to:`/lookup/player/${y(i)}/${u.row.realm}/${u.row.name}`},{default:l(()=>[v(_(u.row.name),1)]),_:2},1032,["to"])]),_:2},1032,["_class"])])]}),_:2},1032,["props"]),s(b,{key:"dungeons",props:u,class:"flex justify-start"},{default:l(()=>[u.row.run_data.seasonBestRuns.length!=0?(m(!0),p($,{key:0},V(u.row.run_data.seasonBestRuns,(k,T)=>(m(),G(U,{run:k,style:{"margin-right":"15px"},key:T},null,8,["run"]))),128)):(m(),p($,{key:1},[v(" No run completed ")],64))]),_:2},1032,["props"]),s(b,{key:"score",props:u},{default:l(()=>{var k,T,D,Q,z;return[v(_((D=(T=(k=u.row.run_data)==null?void 0:k.weeklyRuns)==null?void 0:T.length)!=null?D:0)+" ",1),(z=(Q=u.row.run_data)==null?void 0:Q.weeklyRuns)!=null&&z.length?(m(),G(R,{key:0},{default:l(()=>[o("div",xe,[(m(!0),p($,null,V(u.row.run_data.weeklyRuns,(Z,E)=>(m(),G(U,{run:Z,style:{"margin-right":"15px"},key:E},null,8,["run"]))),128))])]),_:2},1024)):F("",!0)]}),_:2},1032,["props"]),s(b,{key:"score",props:u},{default:l(()=>[v(_(Math.round(u.row.run_data?u.row.run_data.score:0)),1)]),_:2},1032,["props"])]),_:2},1032,["props"])]),_:1},8,["rows","pagination"])])}}});const Te={components:{affixSelector:de},props:["guildMembers","region"],data(){return{showType:1,showTypeOptions:[{label:"All",value:1},{label:"Hide slackers",value:2},{label:"Show only slackers",value:3}],levelFilter:{min:2,max:35},periode:null,initialPagination:{sortBy:"runs",descending:!0,rowsPerPage:7},columns:[{name:"rank",align:"left",label:"Rank",field:"rank",sortable:!0,sort:(e,t)=>e-t},{name:"player",align:"left",label:"Player",field:"name",sortable:!0,sort:(e,t)=>e-t},{name:"runs",align:"left",label:"Weekly runs",field:e=>this.GetRuns(e).length,sortable:!0},{name:"hkey",align:"left",label:"Highest key",field:e=>this.GetRuns(e).map(t=>t.keystone_level).sort((t,r)=>t-r).reverse()[0],sortable:!0},{name:"score",label:"Weekly score",format:e=>Math.round(e),field:e=>this.GetScore(e),sortable:!0,sort:(e,t)=>e-t}]}},computed:{...ne(["GetSpecs","GetClasses","SelectedPeriode"])},watch:{SelectedPeriode(){this.SelectedPeriode&&this.SetPeriode(this.SelectedPeriode.id)}},created(){this.SelectedPeriode&&this.SetPeriode(this.SelectedPeriode.id)},methods:{SetPeriode(e){this.periode=e},GetRuns(e,t){var r=this;return e.run_data&&e.run_data.runs&&e.run_data.runs.length!=0?e.run_data.runs.filter(i=>{if(i.periode===r.periode&&i.keystone_level>r.levelFilter.min&&i.keystone_level<r.levelFilter.max)return!0}):[]},GetScore(e){if(e.run_data&&e.run_data.runs&&e.run_data.length!=0){var t=this.getTopDungeonRuns(this.GetRuns(e)),r=t.map(i=>i.score).reduce((i,a)=>i+a,0);return Math.round(r)}return 0},getTopDungeonRuns(e){var t=[],r=H.groupBy(e,a=>a.zone.id);for(const a in r)if(r.hasOwnProperty(a)){const d=r[a];var i=H._sortBy(d,"score").reverse();t.push(i[0])}return t},filterdRuns(e,t){var r=[];for(let i=0;i<e.length;i++){const a=e[i];(t==null||a.time.completed_timestamp>t.start&&a.time.completed_timestamp<t.end)&&r.push(a)}return r},getClass(e){if(this.GetClasses)for(let t=0;t<this.GetClasses.length;t++){const r=this.GetClasses[t];if(r.id==e)return r}},getSpec(e){if(this.GetSpecs)for(let t=0;t<this.GetSpecs.length;t++){const r=this.GetSpecs[t];if(r.id==e)return r}}}},Ce=o("div",{class:"HeaderFont HeaderSize4 row"},"Weekly Runs",-1),$e={style:{width:"100%"}},Pe={class:"flex justify-center"},Re=["href"];function Be(e,t,r,i,a,d){const f=w("affixSelector");return m(),p("div",null,[s(f,{hidePictures:!0,onChanged:t[0]||(t[0]=n=>d.SetPeriode(n)),value:a.periode,localMode:"true"},null,8,["value"]),s(A,{rows:r.guildMembers.filter(n=>a.showType===1||a.showType===2&&d.GetRuns(n).length!=0||a.showType===3&&d.GetRuns(n).length===0),columns:a.columns,"row-key":"id",title:"Weekly runs",dark:"",color:"amber",pagination:a.initialPagination},{top:l(()=>[Ce,o("div",$e,[o("div",Pe,[s(oe,{modelValue:a.showType,"onUpdate:modelValue":t[1]||(t[1]=n=>a.showType=n),inline:"",options:a.showTypeOptions,color:"grey"},null,8,["modelValue","options"]),s(ue,{modelValue:a.levelFilter,"onUpdate:modelValue":t[2]||(t[2]=n=>a.levelFilter=n),color:"grey",label:"",dense:"",min:2,max:35},null,8,["modelValue"])])])]),body:l(n=>[s(q,{props:n},{default:l(()=>{var g;return[s(b,{key:"rank",props:n},{default:l(()=>[v(_(n.row.rank),1)]),_:2},1032,["props"]),s(b,{style:W(`color: ${(g=d.getClass(n.row._class))==null?void 0:g.color}`),key:"player",props:n},{default:l(()=>[s(B,{"spinner-size":"15px","spinner-color":"white",class:"tableIcon",src:d.getClass(n.row._class).icon_url},null,8,["src"]),o("a",{href:`/lookup/player/${r.region}/${n.row.realm}/${n.row.name}`},_(n.row.name),9,Re)]),_:2},1032,["style","props"]),s(b,{key:"runs",props:n},{default:l(()=>[o("template",null,[v(_(n.colsMap.runs.field(n.row)),1)])]),_:2},1032,["props"]),s(b,{key:"hkey",props:n},{default:l(()=>[n.colsMap.hkey.field(n.row)?(m(),p($,{key:0},[v("+"+_(n.colsMap.hkey.field(n.row)),1)],64)):F("",!0)]),_:2},1032,["props"]),s(b,{key:"score",props:n},{default:l(()=>[v(_(n.colsMap.score.field(n.row)),1)]),_:2},1032,["props"])]}),_:2},1032,["props"])]),_:1},8,["rows","columns","pagination"])])}var Fe=M(Te,[["render",Be]]);const De={props:["guildMembers","region"],components:{WeeklyRuns:Fe}},Qe={class:"flex justify-around"},ze=o("div",null," Success ",-1);function Ve(e,t,r,i,a,d){const f=w("WeeklyRuns");return m(),p("div",null,[o("div",Qe,[s(f,{guildMembers:r.guildMembers,region:r.region},null,8,["guildMembers","region"]),s(f,{guildMembers:r.guildMembers,region:r.region},null,8,["guildMembers","region"])]),ze])}var He=M(De,[["render",Ve]]);const Ue={props:["tab","guild"],components:{GuildMemberList:Se,GuildStatsPage:He}},Ie=e=>(se("data-v-05b07178"),e=e(),le(),e),Le={key:0,class:"HeaderFont MainContainer"},je=Ie(()=>o("div",null,_("Plan to add raid data here when auto scanning is implemented"),-1));function Ne(e,t,r,i,a,d){const f=w("GuildMemberList"),n=w("GuildStatsPage");return r.guild?(m(),p("div",Le,[s(X,{"keep-alive":"",tab:e.timer,"onUpdate:tab":t[0]||(t[0]=g=>e.timer=g),animated:""},{default:l(()=>[s(C,{class:"GreyBackground",name:"overview"}),s(C,{class:"GreyBackground",name:"members"},{default:l(()=>[s(f,{guildMembers:r.guild.members,region:r.guild.region},null,8,["guildMembers","region"])]),_:1}),s(C,{class:"GreyBackground",name:"mythicPlus"},{default:l(()=>[s(n,{guildMembers:r.guild.members,region:r.guild.region},null,8,["guildMembers","region"])]),_:1}),s(C,{class:"GreyBackground",name:"raid"},{default:l(()=>[je]),_:1})]),_:1},8,["tab"])])):(m(),G(O,{key:1,class:"MainContainer"}))}var We=M(Ue,[["render",Ne],["__scopeId","data-v-05b07178"]]);const Oe={props:[],components:{GuildBody:We,GuildHeader:be,GuildNav:ge},data(){return{guildData:null,tab:"members"}},computed:{view(){var e=this.$route.query.view;return e||null},region(){return this.$route.params.region},realm(){return this.$route.params.realm},guild(){return this.$route.params.name}},watch:{region(e,t){e!==t&&this.FetchData()},realm(e,t){e!==t&&this.FetchData()},guild(e,t){e!==t&&this.FetchData()},tab(){this.$router.replace({query:{view:this.tab}})}},methods:{FetchData(e){e||(e=!1);var t=this,r=this.$store.state.data.apiUrl;t.guildData=null,ie.get(`${r}/Guild?name=${t.guild}&realm=${t.realm}&region=${t.region}&forceBlizzardScan=${e}`).then(i=>{t.guildData=i.data}).catch(i=>{console.log(i)})}},created(){this.FetchData(),this.view&&(this.tab=this.view)}};function qe(e,t,r,i,a,d){const f=w("GuildHeader"),n=w("GuildNav"),g=w("GuildBody");return m(),p("div",null,[s(f,{guild:a.guildData,onUpdate:t[0]||(t[0]=S=>d.FetchData(!0))},null,8,["guild"]),s(n,{guild:a.guildData,tab:a.tab,onChangedTab:t[1]||(t[1]=S=>a.tab=S)},null,8,["guild","tab"]),s(g,{guild:a.guildData,tab:a.tab},null,8,["guild","tab"])])}var nt=M(Oe,[["render",qe]]);export{nt as default};
