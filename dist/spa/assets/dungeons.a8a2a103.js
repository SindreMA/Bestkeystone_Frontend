import{a as Pe,Q as Fe}from"./AffixSelector.ddfcb7ad.js";import{D as Be,E as Te,G as Ve,c as k,H as Ce,I as $e,J as _e,d as te,r as F,u as se,e as re,S as H,w as E,o as ve,h as s,i as d,m as I,n as D,q as f,p as o,ac as ge,N as q,l as V,t as v,ae as O,F as B,C as A,ag as oe,aB as ce,bk as J,z as T,_ as ae,a as Z,v as de,x as ue,j as e,B as Ae,az as Me,Q as Ge,L as ze,y as me,g as he,an as Ie,bl as He}from"./index.4a7224fa.js";import{a as M,Q as ee}from"./QTr.88cc62fd.js";import{a as pe,Q as K,c as xe,b as X}from"./QTabPanels.aa23d0ec.js";import{Q as ne}from"./QTable.e70e75fe.js";import{C as be,_ as ye}from"./ClassTableView.82770bb8.js";import{_ as ke,a as De}from"./SpecList.10ea75f1.js";import{C as Re,a as we}from"./CompositionTableView.43522889.js";import{F as Qe}from"./FactionBar.b0bffab0.js";import{Q as Se}from"./QRange.0efc4d51.js";import{a as Le}from"./index.0594d61d.js";import"./linq.12a21919.js";import"./use-cache.b0833c75.js";import"./QMarkupTable.52b731fd.js";import"./QCheckbox.2bef0a7e.js";import"./QInput.6f67bbce.js";var ie=Be({name:"QCard",props:{...Te,tag:{type:String,default:"div"},square:Boolean,flat:Boolean,bordered:Boolean},setup(t,{slots:a}){const{proxy:{$q:n}}=_e(),_=Ve(t,n),l=k(()=>"q-card"+(_.value===!0?" q-card--dark q-dark":"")+(t.bordered===!0?" q-card--bordered":"")+(t.square===!0?" q-card--square no-border-radius":"")+(t.flat===!0?" q-card--flat no-shadow":""));return()=>Ce(t.tag,{class:l.value},$e(a.default))}});const N=t=>(de("data-v-3ff03607"),t=t(),ue(),t),Ue={id:"Main",class:"relative"},je={key:1,class:"HeaderFont"},We=N(()=>e("br",null,null,-1)),qe=N(()=>e("br",null,null,-1)),Ne=N(()=>e("div",{class:"flex justify-center HeaderSize4"},[e("div",null,"There is no data for this request, yet...")],-1)),Oe=[We,qe,Ne],Ye=N(()=>e("i",{class:"material-icons"},"info",-1)),Ee={key:0},Je={key:2},Ke=N(()=>e("i",{class:"material-icons"},"warning",-1)),Xe=N(()=>e("br",null,null,-1)),Ze=N(()=>e("br",null,null,-1)),et=N(()=>e("br",null,null,-1)),tt=te({__name:"DungeonTableView",setup(t){let a=F("Composition"),n=F([]),_=F(!1),l=F(!1),r=F(null),C=F({rowsPerPage:999,page:1,sortBy:"intime_rate",descending:!0}),i=F([{name:"view",label:"",align:"left",field:m=>m},{name:"dungeon",label:"Dungeon",field:m=>z(m.id),align:"left"},{name:"runs",label:"Amount of runs",field:m=>m.total_runs,sortable:!0,align:"center"},{name:"tscore",label:"Total Score",field:m=>m.tscore,sortable:!0,align:"center"},{name:"ascore",label:"Average score",field:m=>m.ascore,sortable:!0,align:"center"},{name:"intime_rate",label:"Success rate",field:m=>W(m.ingameid).ontime_percent||0,sortable:!0,align:"center"}]);const b=se().state.data,P=()=>{if(!h.value)return null;_.value=!0;var m=b.apiUrl;Z.get(m+"/Dungeon/ontimerate?periode="+h.value+"&min_level="+c.value.min_keystonelevel+"&amount="+c.value.max_runs+"&limitToLowestDungeon="+c.value.limitbylowestdungeon).then(function(x){n.value=x.data,_.value=!1}).catch(function(x){console.log(x),x.value=!0,_.value=!1})},U=(m,x,u,G)=>H.GetPoints(m,x,u,G),$=m=>{var x=0;for(let u=0;u<m.length;u++)x+=m[u].score;return x},j=()=>{var m=[...Q.value.data],x=[];for(let G=0;G<m.length;G++){var u={...m[G]};u.tscore=u.score,u.ascore=U(u.tscore,"mean",0,u.total_runs),u.pscore=U(u.tscore,"percent",$(m),u.total_runs),u.total_runs!=0&&x.push(u)}r.value=x},W=m=>{if(n.value)for(let x=0;x<n.value.length;x++){const u=n.value[x];if(u.id==m)return u}return!1},z=m=>{if(p.value)for(let x=0;x<p.value.length;x++){const u=p.value[x];if(u.keystone_id==m)return u}},Q=k(()=>b.Dungeons_Data),p=k(()=>b.Dungeons),h=k(()=>b.SelectedPeriode);k(()=>b.Reloaded_Timestamp),k(()=>b.Affixes),k(()=>b.Periodes);const c=k(()=>b.settings),w=re(),S=k(()=>H.GetDefaultView(w.screen.width,c.value)),y=F(null);return E(n,()=>{n.value&&y.value}),E(Q,()=>{Q.value&&j()}),E(h,()=>{r.value=null,l.value=!1,P()}),ve(()=>{h.value&&(Q.value&&j(),P())}),(m,x)=>(s(),d("div",Ue,[I(r)==null?(s(),D(oe,{key:0,class:"absolute-center",style:{color:"rgb(161, 161, 161)"},size:"200"})):I(r).length==0?(s(),d("div",je,Oe)):I(r).length!=0?(s(),D(ne,{key:2,"rows-per-page-options":[],"card-class":"background HeaderFont","table-class":"HeaderFont","table-header-class":"HeaderFont",dark:"",flat:"",rows:I(r),columns:I(i),pagination:I(C),"hide-bottom":"","row-key":"ingameid",ref_key:"dungeonTable",ref:y},{body:f(u=>[o(ee,{props:u},{default:f(()=>[o(M,{key:"view",props:u},{default:f(()=>[o(ge,{style:q(`background-size: 150% 150%; background-image: url(${z(u.row.ingameid).imageurl});`),class:"darkOverlay",round:"",flat:"",icon:u.expand?"arrow_drop_up":"arrow_drop_down",onClick:G=>u.expand=!u.expand},null,8,["style","icon","onClick"])]),_:2},1032,["props"]),o(M,{key:"dungeon",props:u},{default:f(()=>[V(v(`${z(u.row.ingameid).name}`),1)]),_:2},1032,["props"]),o(M,{key:"runs",props:u},{default:f(()=>[V(v(u.row.total_runs)+" ",1),Ye,o(O,null,{default:f(()=>[(s(!0),d(B,null,A(u.row.runs,(G,R)=>(s(),d("div",{key:R},v(`${R}: ${G}`),1))),128))]),_:2},1024)]),_:2},1032,["props"]),o(M,{key:"tscore",props:u},{default:f(()=>[V(v(Math.round(u.row.tscore))+" ("+v(u.row.pscore)+"%)",1)]),_:2},1032,["props"]),o(M,{key:"ascore",props:u},{default:f(()=>[V(v(u.row.ascore),1)]),_:2},1032,["props"]),o(M,{key:"intime_rate",props:u},{default:f(()=>[W(u.row.ingameid)?(s(),d("div",Ee,v(Math.round(W(u.row.ingameid).ontime_percent*10)/10)+"%",1)):I(_)?(s(),D(oe,{key:1,size:"15"})):(s(),d("div",Je,[Ke,o(O,null,{default:f(()=>[V("Success rate is generated separately. Could not get the data")]),_:1})]))]),_:2},1032,["props"])]),_:2},1032,["props"]),u.expand?(s(),D(ee,{key:0,class:"hideHover",props:u},{default:f(()=>[o(M,{colspan:"100%",class:"DungeonWindow",style:q(`background-size: 150% 150%; background-image: url(${z(u.row.ingameid).imageurl});`)},{default:f(()=>[Xe,o(ie,{class:"background",style:{opacity:"0.92",padding:"2px 10px 10px 10px"}},{default:f(()=>[o(Qe,{zone:u.row.ingameid},null,8,["zone"])]),_:2},1024),Ze,o(ie,{class:"background",style:{opacity:"0.92"}},{default:f(()=>[o(pe,{modelValue:I(a),"onUpdate:modelValue":x[0]||(x[0]=G=>ce(a)?a.value=G:a=G),animated:"",swipeable:"",class:"HeaderFontv2",align:"justify"},{default:f(()=>[o(K,{default:"",name:"Composition",label:"Best Composition"}),o(K,{name:"Class",label:"Best Class"}),o(K,{name:"Spec",label:"Best Spec"})]),_:1},8,["modelValue"]),o(xe,{modelValue:I(a),"onUpdate:modelValue":x[1]||(x[1]=G=>ce(a)?a.value=G:a=G),animated:"",class:"background"},{default:f(()=>[o(X,{"keep-alive":"",name:"Composition"},{default:f(()=>[o(J,{style:{height:"600px"}},{default:f(()=>[S.value==="table"?(s(),D(Re,{key:0,dungeon:u.row.ingameid},null,8,["dungeon"])):(s(),D(we,{key:1,dungeon:u.row.ingameid},null,8,["dungeon"]))]),_:2},1024)]),_:2},1024),o(X,{"keep-alive":"",name:"Class"},{default:f(()=>[o(J,{style:{height:"600px"}},{default:f(()=>[S.value==="table"?(s(),D(be,{key:0,dungeon:u.row.ingameid},null,8,["dungeon"])):(s(),D(ye,{key:1,dungeon:u.row.ingameid},null,8,["dungeon"]))]),_:2},1024)]),_:2},1024),o(X,{"keep-alive":"",name:"Spec"},{default:f(()=>[o(J,{style:{height:"600px"}},{default:f(()=>[S.value==="table"?(s(),D(ke,{key:0,dungeon:u.row.ingameid},null,8,["dungeon"])):(s(),D(De,{key:1,dungeon:u.row.ingameid},null,8,["dungeon"]))]),_:2},1024)]),_:2},1024)]),_:2},1032,["modelValue"])]),_:2},1024),et]),_:2},1032,["style"])]),_:2},1032,["props"])):T("",!0)]),_:1},8,["rows","columns","pagination"])):T("",!0)]))}});var st=ae(tt,[["__scopeId","data-v-3ff03607"]]);const at={class:"absolute-center noBg"},lt={class:"flex flex-center"},ot={class:"absolute-left noBg"},nt={class:"Ccenter",style:{"margin-left":"27px"}},it={class:""},rt={class:"absolute-right noBg"},dt={class:"Ccenter",style:{"margin-right":"25px"}},ut={id:"points",class:"flex flex-center"},ct={key:0},ft={key:0,id:"DungeonMoreInfoWindow"},_t=te({__name:"DungeonViewer",props:{dungeon:{type:Object},expanded:{type:Boolean},Selected:{},totalScore:{type:Number}},emits:["click"],setup(t,{emit:a}){const n=t,{dungeon:_,expanded:l,Selected:r,totalScore:C}=Ae(n),i=F(30),g=F(20),b=F(35),P=F("Composition"),$=se().state.data,j=k(()=>$.Dungeons),W=k(()=>$.settings);k(()=>document.location.origin);const z=re(),Q=k(()=>H.GetDefaultView(z.screen.width,W)),p=k(()=>{for(let y=0;y<j.value.length;y++){const m=j.value[y];if(m.keystone_id===_.value.id)return m}}),h=_e(),c=()=>{l.value?a("click",!1):a("click",p.value.keystone_id),setTimeout(()=>{var y;(y=h==null?void 0:h.proxy)==null||y.$forceUpdate()},100)},w=F(null),S=()=>{w!==void 0&&(w.clientWidth<666?(i.value=20,g.value=15,b.value=25):(b.value=35,i.value=30,g.value=20))};return(y,m)=>(s(),d("div",null,[o(Ge,{src:`${p.value.imageurl}`,class:"DungeonWindow",onClick:m[1]||(m[1]=x=>c()),ref_key:"DungeonWindow",ref:w},{default:f(()=>[o(Me,{onResize:m[0]||(m[0]=x=>S())}),e("div",at,[e("div",lt,[e("div",{id:"nameBox",style:q("font-size:"+i.value+"px;")},v(p.value.short_name),5)])]),e("div",ot,[e("div",nt,[e("div",{class:"flex flex-center",id:"rankBox",style:q("font-size:"+g.value+"px; width: "+b.value+"px; height: "+b.value+"px;")},[e("div",it,v(I(_).rank),1)],4)])]),e("div",rt,[e("div",dt,[e("div",ut,[e("div",{style:q("font-size:"+g.value+"px;"),class:"flex"},[V(v(I(_).display_score)+" ",1),W.value.score_type=="percent"?(s(),d("div",ct,"%")):T("",!0)],4),o(O,null,{default:f(()=>[e("p",null,"Total Runs: "+v(I(_).total_runs),1),(s(!0),d(B,null,A(I(_).runs,(x,u)=>(s(),d("p",{class:"",key:u}," +"+v(u)+": "+v(x),1))),128))]),_:1})])])])]),_:1},8,["src"]),I(l)?(s(),d("div",ft,[o(ie,{class:"background"},{default:f(()=>[o(pe,{modelValue:P.value,"onUpdate:modelValue":m[2]||(m[2]=x=>P.value=x),animated:"",swipeable:"",class:"HeaderFontv2",align:"justify"},{default:f(()=>[o(K,{default:"",name:"Composition",label:"Best Composition"}),o(K,{name:"Class",label:"Best Class"}),o(K,{name:"Spec",label:"Best DPS Spec"})]),_:1},8,["modelValue"]),o(xe,{modelValue:P.value,"onUpdate:modelValue":m[3]||(m[3]=x=>P.value=x),animated:"",class:"background"},{default:f(()=>[o(X,{"keep-alive":"",name:"Composition"},{default:f(()=>[o(J,{style:{height:"700px"}},{default:f(()=>[o(we,{dungeon:p.value.zone},null,8,["dungeon"])]),_:1})]),_:1}),o(X,{"keep-alive":"",name:"Class"},{default:f(()=>[o(J,{style:{height:"600px"}},{default:f(()=>[Q.value==="table"?(s(),D(be,{key:0,dungeon:I(_).id},null,8,["dungeon"])):(s(),D(ye,{key:1,dungeon:p.value.zone},null,8,["dungeon"]))]),_:1})]),_:1}),o(X,{"keep-alive":"",name:"Spec"},{default:f(()=>[o(J,{style:{height:"600px"}},{default:f(()=>[Q.value==="table"?(s(),D(ke,{key:0,dungeon:I(_).id},null,8,["dungeon"])):(s(),D(De,{key:1,dungeon:p.value.zone},null,8,["dungeon"]))]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})])):T("",!0)]))}});const vt={components:{CloudinaryFormat:ze},data(){return{data:null,fetching:!1,error:!1}},created(){this.SelectedPeriode&&this.fetchData()},computed:{...me(["SelectedPeriode","GetDungeons"]),Settings(){return this.$store.state.data.settings}},methods:{getValidLink(t,a){return t||a},fetchData(){var t=this;t.fetching=!0;var a=this.$store.state.data.apiUrl;Z.get(a+"/Dungeon/ontimerate?periode="+this.SelectedPeriode.id+"&min_level="+this.Settings.min_keystonelevel+"&amount="+this.Settings.max_runs+"&limitToLowestDungeon="+this.Settings.limitbylowestdungeon).then(function(n){t.data=n.data,t.fetching=!1}).catch(function(n){console.log(n),t.error=!0,t.fetching=!1})},DungeonDetails(t){for(let a=0;a<this.GetDungeons.length;a++){const n=this.GetDungeons[a];if(n.keystone_id==t)return n}}},watch:{SelectedPeriode(){this.data=null,this.error=!1,this.fetchData()}}},gt={key:0,class:"HeaderFont text-center"},mt=e("h2",null,"Success rate",-1),ht={class:"flex flex-center"},pt={class:"percentBackground absolute-center"},xt={class:"textBox"},bt={class:"text-center",style:{margin:"auto"}};function yt(t,a,n,_,l,r){const C=he("CloudinaryFormat");return l.data?(s(),d("div",gt,[mt,e("div",ht,[(s(!0),d(B,null,A(l.data,(i,g)=>{var b,P;return s(),d("div",{class:"flex flex-between ListCSS",key:g},[o(O,null,{default:f(()=>[V(" Runs: "+v(i.total_runs),1)]),_:2},1024),o(C,{url:(b=r.DungeonDetails(i.id))==null?void 0:b.imageurl},{default:f(({link:U})=>[e("div",{id:"DungeonDot",class:"text-center shadow-24 relative-position",style:q({"background-image":`url(${U})`})},[e("div",pt,[e("div",xt,v(i.ontime_percent.toFixed(0))+"%",1)])],4)]),_:2},1032,["url"]),e("div",bt,v((P=r.DungeonDetails(i.id))==null?void 0:P.name),1)])}),128))])])):T("",!0)}var kt=ae(vt,[["render",yt]]);const L=t=>(de("data-v-09ef3f8c"),t=t(),ue(),t),Dt={key:0,class:"text-center HeaderFont"},wt=L(()=>e("div",null,[e("h2",null,"What week is best for what dungeon?")],-1)),St={class:"flex justify-center"},Pt={class:"affixInfoFieldRight"},Ft=L(()=>e("p",null,"From",-1)),Bt={class:"flex"},Tt={style:{width:"200px"}},Vt=L(()=>e("br",null,null,-1)),Ct=L(()=>e("br",null,null,-1)),$t={class:"affixInfoFieldLeft"},At=L(()=>e("p",null,"To",-1)),Mt={class:"flex"},Gt={class:"flex justify-center"},zt={class:"percentBackground absolute-center"},It={style:{width:"135px"},class:"flex justify-center"},Ht={key:0},Rt={key:1},Qt={key:2},Lt={class:"text-center",style:{margin:"auto"}},Ut={class:"text-center",style:{width:"100%","border-bottom":"solid 1px, black"}},jt=L(()=>e("div",{class:"flex justify-around",style:{width:"100%"}},[e("div",{class:"tableField"},"Period"),e("div",{class:"tableField"},"Affixes"),e("div",{class:"tableField"},"Score"),e("div",{class:"tableField"},"Average Score"),e("div",{class:"tableField"},"Success Rate")],-1)),Wt={class:"tableField"},qt={class:"tableField"},Nt={class:"flex"},Ot={class:"tableField"},Yt={class:"tableField"},Et={class:"tableField"},Jt=L(()=>e("br",null,null,-1)),Kt=L(()=>e("div",{class:"flex flex-center"},[e("h6",{id:"OverallTitle"},"Best overall week")],-1)),Xt={class:"flex flex-center"},Zt={class:"TotalView flex justify-around"},es={class:"text-center",style:{width:"100%","border-bottom":"solid 1px, black"}},ts=L(()=>e("div",{class:"flex justify-around",style:{width:"100%"}},[e("div",{class:"tableField"},"Periode"),e("div",{class:"tableField"},"Affixes"),e("div",{class:"tableField"},"Score"),e("div",{class:"tableField"},"Average Score"),e("div",{class:"tableField"},"Success Rate")],-1)),ss={class:"tableField"},as={class:"tableField"},ls={class:"flex"},os={class:"tableField"},ns={class:"tableField"},is={class:"tableField"},rs={class:"flex flex-center"},ds={class:"flex flex-center scoreView"},us={key:0},cs={key:1},fs={key:2},_s=L(()=>e("br",null,null,-1)),vs=L(()=>e("br",null,null,-1)),gs=te({__name:"BestWeekForAffix",setup(t){const a=F(null),n=F(null),_=F("success_rate"),l=F(null);F(!0),F({rowsPerPage:15,page:1});const r=F(null);F([{name:"periode",label:"Periode",field:"periode",sortable:!0},{name:"affixes",label:"Affixes",field:"affixes",sortable:!0},{name:"total_score",label:"Total Score",field:"total_score",sortable:!0},{name:"avg_score",label:"Average Score",field:"avg_score",sortable:!0},{name:"success_rate",label:"Success Rate",field:"success_rate",sortable:!0}]),E(a,()=>{var p=setTimeout(function(){r.value==p&&W()},1e3);r.value=p});const i=se().state.data,g=k(()=>i.Dungeons);k(()=>i.Affixes);const b=()=>{if(l.value){var p=[...l.value].filter(h=>h[0].dungeon!==null)[0];return p}},P=p=>{var h=[];for(let w=0;w<p.length;w++){const S=p[w];var c={periode:S.periode,affixes:z(S.periode).affixes,total_score:S.score,avg_score:S.score/S.runs,success_rate:S.success_rate};h.push(c)}return H._sortBy(h,_.value).reverse()},U=p=>{for(let h=0;h<g.value.length;h++){const c=g.value[h];if(c.id==p)return c}},$=p=>{if(!p)return null;var h=[];for(let S=0;S<p.length;S++){const y=p[S];var c=y.score/1e3;y.total_score=c;var w=y.score/y.runs;y.avg_score=w}return h=H._sortBy(p,_.value).reverse(),h[0]},j=()=>{var p=i.apiUrl;Z.get(p+"/Periode?weeks=50").then(function(h){n.value=H._sortBy(h.data,"id"),a.value={min:n.value[n.value.length-1].id-10,max:n.value[n.value.length-1].id}}).catch(function(h){console.log(h)})},W=()=>{var p=i.apiUrl;Z.get(p+"/Dungeon/BestAffixSetPerDungeon?fromPeriode="+a.value.min+"&toPeriode="+a.value.max).then(function(h){var c;l.value=(c=h.data)==null?void 0:c.map(w=>w.list)}).catch(function(h){console.log(h)})},z=p=>{for(let h=0;h<n.value.length;h++){const c=n.value[h];if(c.id===p)return c}},Q=p=>H.GetMoment(p).format("MMMM Do YYYY");return ve(()=>{j()}),(p,h)=>(s(),d(B,null,[a.value&&l.value?(s(),d("div",Dt,[wt,e("div",St,[e("div",Pt,[Ft,e("p",null,v(Q(z(a.value.min).start_timestamp)),1),e("div",Bt,[(s(!0),d(B,null,A(z(a.value.min).affixes,c=>(s(),D(c,{key:c,class:"miniAffixImg",border:!0,affixid:c,detailed:!0,tooltip:!0},null,8,["affixid"]))),128))])]),e("div",Tt,[V(v(a.value.max-a.value.min)+" ",1),Vt,V(" weeks "),Ct,V(" selected ")]),e("div",$t,[At,e("p",null,v(Q(z(a.value.max).start_timestamp)),1),e("div",Mt,[(s(!0),d(B,null,A(z(a.value.max).affixes,c=>(s(),D(c,{key:c,class:"miniAffixImg",border:!0,affixid:c,detailed:!0,tooltip:!0},null,8,["affixid"]))),128))])])]),n.value?(s(),D(Se,{key:0,modelValue:a.value,"onUpdate:modelValue":h[0]||(h[0]=c=>a.value=c),min:n.value[0].id,max:n.value[n.value.length-1].id,step:1},null,8,["modelValue","min","max"])):T("",!0),o(Ie,{modelValue:_.value,"onUpdate:modelValue":h[1]||(h[1]=c=>_.value=c),"toggle-color":"tertiary",options:[{label:"Total score",value:"total_score"},{label:"Success rate",value:"success_rate"},{label:"Average score",value:"avg_score"}]},null,8,["modelValue"]),e("div",Gt,[(s(!0),d(B,null,A(l.value.filter(c=>{var w;return((w=c[0])==null?void 0:w.zone)!=-2}),c=>{var w,S,y,m,x,u,G;return s(),d("div",{class:"ListCSS",key:(w=$(c))==null?void 0:w.dungeon},[c&&((S=$(c))==null?void 0:S.dungeon)?(s(),d(B,{key:0},[e("div",{id:"DungeonDot",class:"text-center shadow-24 relative-position",style:q({"background-image":"url("+((m=U((y=$(c))==null?void 0:y.dungeon))==null?void 0:m.imageurl)+")"})},[e("div",zt,[e("div",null,[e("div",It,[(s(!0),d(B,null,A((u=z((x=$(c))==null?void 0:x.periode))==null?void 0:u.affixes,R=>(s(),D(R,{key:R,class:"microAffixImg",border:!1,affixid:R,detailed:!1,tooltip:!0},null,8,["affixid"]))),128))]),_.value==="success_rate"?(s(),d("div",Ht," Success rate: "+v($(c).success_rate.toFixed(0))+"% ",1)):T("",!0),_.value==="total_score"?(s(),d("div",Rt," Total Score : "+v(Math.floor($(c).total_score)),1)):T("",!0),_.value==="avg_score"?(s(),d("div",Qt," Average Score: "+v(Math.floor($(c).avg_score)),1)):T("",!0)])])],4),e("div",Lt,v((G=U($(c).dungeon))==null?void 0:G.name),1),o(O,null,{default:f(()=>[e("div",Ut,[jt,(s(!0),d(B,null,A(P(c),R=>(s(),d("div",{class:"flex justify-around",style:{width:"100%"},key:R.periode},[e("div",Wt,v(R.periode),1),e("div",qt,[e("div",Nt,[(s(!0),d(B,null,A(R.affixes,le=>(s(),D(le,{key:le,class:"micoAffixImg",border:!0,affixid:le,detailed:!1,tooltip:!0},null,8,["affixid"]))),128))])]),e("div",Ot,v(Math.floor(R.total_score/1e3*100)/100),1),e("div",Yt,v(Math.floor(R.avg_score*100)/100),1),e("div",Et,v(Math.floor(R.success_rate*100)/100)+"% ",1)]))),128))])]),_:2},1024)],64)):T("",!0)])}),128))]),Jt,e("div",null,[Kt,e("div",Xt,[e("div",Zt,[(s(!0),d(B,null,A(z($(b()).periode).affixes,c=>(s(),D(c,{size:"100%",key:c,class:"bigAffixImg",border:!1,affixid:c,detailed:!1,tooltip:!1},null,8,["affixid"]))),128))]),o(O,null,{default:f(()=>[e("div",es,[ts,(s(!0),d(B,null,A(P(b()),c=>(s(),d("div",{class:"flex justify-around",style:{width:"100%"},key:c.periode},[e("div",ss,v(c.periode),1),e("div",as,[e("div",ls,[(s(!0),d(B,null,A(c.affixes,w=>(s(),D(w,{key:w,class:"micoAffixImg",border:!0,affixid:w,detailed:!1,tooltip:!1},null,8,["affixid"]))),128))])]),e("div",os,v(Math.floor(c.total_score/1e3*100)/100),1),e("div",ns,v(Math.floor(c.avg_score*100)/100),1),e("div",is,v(Math.floor(c.success_rate*100)/100)+"% ",1)]))),128))])]),_:1})]),e("div",rs,[e("div",ds,[_.value==="success_rate"?(s(),d("div",us," Success rate: "+v($(b()).success_rate.toFixed(0))+"% ",1)):T("",!0),_.value==="total_score"?(s(),d("div",cs," Total Score : "+v(Math.floor($(b()).total_score)),1)):T("",!0),_.value==="avg_score"?(s(),d("div",fs," Average Score: "+v(Math.floor($(b()).avg_score)),1)):T("",!0)])])])])):T("",!0),_s,vs],64))}});var ms=ae(gs,[["__scopeId","data-v-09ef3f8c"]]);function fe(t,a,n){var _,l,r,C,i;a==null&&(a=100);function g(){var P=Date.now()-C;P<a&&P>=0?_=setTimeout(g,a-P):(_=null,n||(i=t.apply(r,l),r=l=null))}var b=function(){r=this,l=arguments,C=Date.now();var P=n&&!_;return _||(_=setTimeout(g,a)),P&&(i=t.apply(r,l),r=l=null),i};return b.clear=function(){_&&(clearTimeout(_),_=null)},b.flush=function(){_&&(i=t.apply(r,l),r=l=null,clearTimeout(_),_=null)},b}fe.debounce=fe;const hs={components:{affix:Le},data(){return{dungeonPaginationControl:{rowsPerPage:20,page:1,sortBy:"intime_rate",descending:!0},subdungeonPaginationControl:{rowsPerPage:30,page:1,sortBy:"periode",descending:!0},dungeonColumns:[{name:"view",label:"",align:"left"},{name:"dungeon",label:"Dungeon",sortable:!0,field:t=>DungeonDetails(t.dungeon).name,align:"left"},{name:"affixes",label:"Affixes",align:"center"},{name:"tscore",label:"Total Score",field:t=>this.getBestPeriode(t.list).tscore,sortable:!0,align:"center"},{name:"ascore",label:"Average score",field:t=>this.getBestPeriode(t.list).ascore,sort:(t,a,n,_)=>this.getBestPeriode(n.list).ascore-this.getBestPeriode(_.list).ascore,sortable:!0,align:"center"},{name:"intime_rate",label:"Success rate",field:t=>this.getBestPeriode(t.list).success_rate,sortable:!0,align:"center"}],subdungeonColumns:[{name:"periode",label:"Period",align:"center",field:t=>t.periode,sortable:!0},{name:"affixes",label:"Affixes",align:"center",field:t=>this.periodeDetails(t.periode).affixes,sortable:!0},{name:"tscore",label:"Total Score",field:t=>t.tscore,sortable:!0,align:"center"},{name:"ascore",label:"Average score",field:t=>t.ascore,sort:(t,a,n,_)=>n.ascore-_.ascore,sortable:!0,align:"center"},{name:"intime_rate",label:"Success rate",field:t=>t.success_rate,sortable:!0,align:"center"}],rangeValues:null,allPeriodes:null,type:"success_rate",data:null,successRate:!0,paginationControl:{rowsPerPage:15,page:1},bounce:null,columns:[{name:"periode",label:"Periode",field:"periode",sortable:!0},{name:"affixes",label:"Affixes",field:"affixes",sortable:!0},{name:"total_score",label:"Total Score",field:"total_score",sortable:!0},{name:"avg_score",label:"Average Score",field:"avg_score",sortable:!0},{name:"success_rate",label:"Success Rate",field:"success_rate",sortable:!0}]}},watch:{dungeonPaginationControl(t,a){var n=t.sortBy;t==null&&(n=a.sortBy),n=="intime_rate"?(this.type="success_rate",this.subdungeonPaginationControl.sortBy="intime_rate"):n=="tscore"?(this.type="total_score",this.subdungeonPaginationControl.sortBy="tscore"):n=="ascore"&&(this.type="avg_score",this.subdungeonPaginationControl.sortBy="ascore")},rangeValues(){var t=this,a=setTimeout(function(){t.bounce==a&&t.getData()},1e3);this.bounce=a,this.BestAffixList}},computed:{...me(["GetDungeons","GetAffixes"])},methods:{BestAffixList(){if(this.data){var t=this.data.filter(a=>!a.dungeon||!a.zone||a.dungeon===-2||a.zone===-2)[0].list;return t}},GetTableFriendlyData(t){var a=[];for(let _=0;_<t.length;_++){const l=t[_];var n={periode:l.periode,affixes:this.periodeDetails(l.periode).affixes,total_score:l.score,avg_score:l.score/l.runs,success_rate:l.success_rate};a.push(n)}return H._sortBy(a,this.type).reverse()},GetAffixDetails(t){for(let a=0;a<this.GetAffixes.length;a++){const n=this.GetAffixes[a];if(n.id==t)return n}},DungeonDetails(t){for(let a=0;a<this.GetDungeons.length;a++){const n=this.GetDungeons[a];if(n.keystone_id==t)return n}},getBestPeriode(t){var a=[];for(let l=0;l<t.length;l++){const r=t[l];var n=r.score/1e3;r.total_score=n;var _=r.score/r.runs;r.avg_score=_}return a=H._sortBy(t,this.type).reverse(),a[0]},getPeriodes(){var t=this,a=this.$store.state.data.apiUrl;Z.get(a+"/Periode?weeks=50").then(function(n){t.allPeriodes=H._sortBy(n.data,"id"),t.rangeValues={min:t.allPeriodes[t.allPeriodes.length-1].id-10,max:t.allPeriodes[t.allPeriodes.length-1].id}}).catch(function(n){console.log(n)})},getData(){var t=this,a=this.$store.state.data.apiUrl;Z.get(a+"/Dungeon/BestAffixSetPerDungeon?fromPeriode="+t.rangeValues.min+"&toPeriode="+t.rangeValues.max).then(function(n){n.data=n.data.map(r=>r.list);var _=[];for(let r=0;r<n.data.length;r++){const C=n.data[r];var l=[];for(let i=0;i<C.length;i++){const g=C[i];g.tscore=g.score,g.ascore=H.GetPoints(g.tscore,"mean",0,g.runs),l.push(g)}_.push({dungeon:l[0].zone||null,list:l})}t.data=_}).catch(function(n){console.log(n)})},periodeDetails(t){for(let a=0;a<this.allPeriodes.length;a++){const n=this.allPeriodes[a];if(n.id===t)return n}},FormatDate(t){return H.GetMoment(t).format("MMMM Do YYYY")}},created(){this.getPeriodes()}},Y=t=>(de("data-v-2b430d8a"),t=t(),ue(),t),ps={id:"Main",class:"relative"},xs={class:"text-center HeaderFont"},bs=Y(()=>e("div",{class:""},[e("h2",null,"What week is best for what dungeon?")],-1)),ys={key:0,class:"flex justify-center"},ks={class:"affixInfoFieldRight"},Ds=Y(()=>e("p",{class:""},"From",-1)),ws={class:"flex"},Ss={key:0,style:{width:"200px"}},Ps=Y(()=>e("br",null,null,-1)),Fs=Y(()=>e("br",null,null,-1)),Bs={key:1,class:"affixInfoFieldLeft"},Ts=Y(()=>e("p",null,"To",-1)),Vs={class:"flex"},Cs={key:2},$s={class:""},As={class:"flex justify-center"},Ms={class:"flex justify-center"},Gs=Y(()=>e("div",{class:"flex flex-center"},[e("h6",{id:"OverallTitle"},"Best overall week")],-1)),zs={class:"flex flex-center"},Is={class:"TotalView flex justify-around"},Hs={class:"text-center",style:{width:"100%","border-bottom":"solid 1px, black"}},Rs=Y(()=>e("div",{class:"flex justify-around",style:{width:"100%"}},[e("div",{class:"tableField"},"Periode"),e("div",{class:"tableField"},"Affixes"),e("div",{class:"tableField"},"Score"),e("div",{class:"tableField"},"Average Score"),e("div",{class:"tableField"},"Success Rate")],-1)),Qs={class:"tableField"},Ls={class:"tableField"},Us={class:"flex"},js={class:"tableField"},Ws={class:"tableField"},qs={class:"tableField"},Ns={class:"flex flex-center"},Os={class:"flex flex-center scoreView"},Ys={key:0},Es={key:1},Js={key:2};function Ks(t,a,n,_,l,r){const C=he("affix");return s(),d("div",ps,[e("div",xs,[bs,l.rangeValues?(s(),d("div",ys,[e("div",ks,[Ds,e("p",null,v(r.FormatDate(r.periodeDetails(l.rangeValues.min).start_timestamp)),1),e("div",ws,[(s(!0),d(B,null,A(r.periodeDetails(l.rangeValues.min).affixes,i=>(s(),D(C,{key:i,size:35,border:!0,affixid:i,detailed:!0,tooltip:!0},null,8,["affixid"]))),128))])]),l.rangeValues?(s(),d("div",Ss,[V(v(l.rangeValues.max-l.rangeValues.min)+" ",1),Ps,V("weeks "),Fs,V("selected ")])):T("",!0),l.rangeValues?(s(),d("div",Bs,[Ts,e("p",null,v(r.FormatDate(r.periodeDetails(l.rangeValues.max).start_timestamp)),1),e("div",Vs,[(s(!0),d(B,null,A(r.periodeDetails(l.rangeValues.max).affixes,i=>(s(),D(C,{key:i,size:35,border:!0,affixid:i,detailed:!0,tooltip:!0},null,8,["affixid"]))),128))])])):T("",!0)])):T("",!0),l.allPeriodes?(s(),D(Se,{key:1,modelValue:l.rangeValues,"onUpdate:modelValue":a[0]||(a[0]=i=>l.rangeValues=i),min:l.allPeriodes[0].id,max:l.allPeriodes[l.allPeriodes.length-1].id,step:1},null,8,["modelValue","min","max"])):T("",!0),l.rangeValues&&l.data?(s(),d("div",Cs,[e("div",$s,[o(ne,{"rows-per-page-options":[],"card-class":"background HeaderFont","table-class":"HeaderFont","table-header-class":"HeaderFont",dark:"",flat:"",rows:l.data.filter((i,g)=>i.dungeon!=null&&i.dungeon!==-2),columns:l.dungeonColumns,pagination:l.dungeonPaginationControl,"hide-bottom":"","row-key":"dungeon"},{body:f(i=>[o(ee,{props:i},{default:f(()=>[o(M,null,{default:f(()=>[o(ge,{style:q(`background-image: url(${r.DungeonDetails(i.row.dungeon).imageurl});`),class:"darkOverlay",round:"",flat:"",icon:i.expand?"arrow_drop_up":"arrow_drop_down",onClick:g=>i.expand=!i.expand},null,8,["style","icon","onClick"])]),_:2},1024),o(M,{key:"dungeon",props:i},{default:f(()=>[V(v(r.DungeonDetails(i.row.dungeon).name),1)]),_:2},1032,["props"]),o(M,{key:"affixes",props:i},{default:f(()=>[e("div",As,[(s(!0),d(B,null,A(r.periodeDetails(r.getBestPeriode(i.row.list).periode).affixes,(g,b)=>(s(),D(C,{key:b,affixid:g},null,8,["affixid"]))),128))])]),_:2},1032,["props"]),o(M,{key:"tscore",props:i},{default:f(()=>[V(v(Math.round(r.getBestPeriode(i.row.list).tscore)),1)]),_:2},1032,["props"]),o(M,{key:"ascore",props:i},{default:f(()=>[V(v(r.getBestPeriode(i.row.list).ascore),1)]),_:2},1032,["props"]),o(M,{key:"intime_rate",props:i},{default:f(()=>[V(v(Math.round(r.getBestPeriode(i.row.list).success_rate*100)/100)+"%",1)]),_:2},1032,["props"])]),_:2},1032,["props"]),i.expand?(s(),D(ee,{key:0,class:"hideHoverGlobal",props:i},{default:f(()=>[o(M,{colspan:"100%"},{default:f(()=>[o(ne,{"rows-per-page-options":[],"card-class":"background HeaderFont","table-class":"HeaderFont","table-header-class":"HeaderFont",dark:"",dense:"",flat:"",rows:i.row.list,columns:l.subdungeonColumns,pagination:l.subdungeonPaginationControl,"hide-bottom":"","row-key":"dungeon"},{body:f(g=>[o(ee,{props:g},{default:f(()=>[o(M,{key:"periode",props:g},{default:f(()=>[V(v(Math.round(g.row.periode)),1)]),_:2},1032,["props"]),o(M,{key:"affixes",props:g},{default:f(()=>[e("div",Ms,[(s(!0),d(B,null,A(r.periodeDetails(g.row.periode).affixes,(b,P)=>(s(),D(C,{key:P,affixid:b},null,8,["affixid"]))),128))])]),_:2},1032,["props"]),o(M,{key:"tscore",props:g},{default:f(()=>[V(v(Math.round(g.row.tscore)),1)]),_:2},1032,["props"]),o(M,{key:"ascore",props:g},{default:f(()=>[V(v(g.row.ascore),1)]),_:2},1032,["props"]),o(M,{key:"intime_rate",props:g},{default:f(()=>[V(v(Math.round(g.row.success_rate*100)/100)+"%",1)]),_:2},1032,["props"])]),_:2},1032,["props"])]),_:2},1032,["rows","columns","pagination"])]),_:2},1024)]),_:2},1032,["props"])):T("",!0)]),_:1},8,["rows","columns","pagination"])]),e("div",null,[Gs,e("div",zs,[e("div",Is,[(s(!0),d(B,null,A(r.periodeDetails(r.getBestPeriode(r.BestAffixList()).periode).affixes,i=>(s(),D(C,{key:i,size:70,border:!1,affixid:i,detailed:!1,tooltip:!1},null,8,["affixid"]))),128))]),o(O,null,{default:f(()=>[e("div",Hs,[Rs,(s(!0),d(B,null,A(r.GetTableFriendlyData(r.BestAffixList()),i=>(s(),d("div",{class:"flex justify-around",style:{width:"100%"},key:i.periode},[e("div",Qs,v(i.periode),1),e("div",Ls,[e("div",Us,[(s(!0),d(B,null,A(i.affixes,g=>(s(),D(C,{key:g,class:"micoAffixImg",border:!0,affixid:g,detailed:!1,tooltip:!1},null,8,["affixid"]))),128))])]),e("div",js,v(Math.floor(i.total_score/1e3*100)/100),1),e("div",Ws,v(Math.floor(i.avg_score*100)/100),1),e("div",qs,v(Math.floor(i.success_rate*100)/100)+"%",1)]))),128))])]),_:1})]),e("div",Ns,[e("div",Os,[l.type==="success_rate"?(s(),d("div",Ys,"Success rate: "+v(r.getBestPeriode(r.BestAffixList()).success_rate.toFixed(0))+"%",1)):T("",!0),l.type==="total_score"?(s(),d("div",Es,"Total Score : "+v(Math.floor(r.getBestPeriode(r.BestAffixList()).total_score)),1)):T("",!0),l.type==="avg_score"?(s(),d("div",Js,"Average Score: "+v(Math.floor(r.getBestPeriode(r.BestAffixList()).avg_score)),1)):T("",!0)])])])])):(s(),D(oe,{key:3,class:"absolute-center",style:{color:"rgb(161, 161, 161)"},size:200}))])])}var Xs=ae(hs,[["render",Ks],["__scopeId","data-v-2b430d8a"]]);const Zs=e("div",{class:"flex flex-center"},[e("div",{class:"Centertext HeaderSize HeaderFont"},` What's the "best" dungeon this week? `)],-1),ea=e("div",{class:"flex flex-center"},[e("p",{class:"HeaderFont HeaderSize2"},"(ish)")],-1),ta={key:0,class:"flex flex-center"},sa={key:1,class:"HeaderFont nodataInfo"},aa=e("h4",{class:"flex flex-center"},"No data found!",-1),la=e("p",{class:"flex flex-center"},"Try to change the settings up in the right",-1),oa=[aa,la],na={key:2},ia={key:0},ra=He('<div class="HeaderFont relative-position" style="height:20px;"><div class="absolute-left"><div class="Ccenter" style="margin-left:30px;"><div style="width:0px;">Rank</div></div></div><div class="HeaderFont dungeonTitle relative"><div class="title">Dungeon</div></div><div class="absolute-right"><div class="Ccenter" style="margin-right:32px;"><div>Score</div></div></div></div>',1),Sa=te({__name:"dungeons",setup(t){F(!1);const a=F(null),n=F(!1),l=se().state.data,r=k(()=>l.Selected),C=k(()=>l.SelectedAffixSet),i=k(()=>l.RIOData),g=k(()=>l.Dungeons_Data),b=k(()=>l.Dungeons),P=k(()=>l.SelectedPeriode),U=k(()=>l.Reloaded_Timestamp);k(()=>l.Affixes);const $=k(()=>l.Periodes),j=k(()=>l.settings),W=re(),z=k(()=>H.GetDefaultView(W.screen.width,j.value)),Q=k(()=>r);k(()=>C),k(()=>i);const p=k(()=>j);E(U,()=>{a.value=null}),E($,()=>{l.apiUrl,n.value||$.value[0]});const h=()=>H.GetTotalScore(g.value.data),c=w=>{const S=[...w].map(y=>({...y}));for(let y=0;y<S.length;y++){const m=S[y];m.display_score=H.GetPoints(m.score,p.value.value.score_type,h(),m.total_runs)}return H.getListWithRank(S)};return F(null),(w,S)=>(s(),d("div",null,[Zs,ea,o(Pe),z.value==="table"?(s(),d(B,{key:0},[o(st),o(Xs)],64)):(s(),d(B,{key:1},[P.value&&g.value&&P.value!=g.value.periode?(s(),d("div",ta,[o(Fe,{style:{color:"rgb(161, 161, 161)"},size:"500"})])):g.value&&g.value.data.filter(y=>y.score===0).length===g.value.data.length?(s(),d("div",sa,oa)):(s(),d("div",na,[P.value&&g.value&&g.value.data&&b.value?(s(),d("div",ia,[ra,(s(!0),d(B,null,A(c(g.value.data),y=>(s(),d("div",{key:y.id},[o(_t,{totalScore:h(),Selected:Q.value,onClick:S[0]||(S[0]=m=>a.value=m),expanded:a.value===y.id,dungeon:y},null,8,["totalScore","Selected","expanded","dungeon"])]))),128))])):T("",!0)])),o(kt),o(ms)],64))]))}});export{Sa as default};
