import{Q as C}from"./QSkeleton.48d2cc7f.js";import{_ as k,d as $,u as K,r as b,c as f,e as oe,S as V,o as z,f as re,w as U,g as A,h as u,i as p,j as a,t as D,k as h,l as R,m as g,n as S,p as r,q as _,s as ie,v as I,x as B,a as j,y as G,Q as ue,z as F,A as Q,B as ce,F as H,C as L}from"./index.d11fe415.js";import{H as le,L as de,r as q}from"./runTableView.9a424006.js";import{n as E}from"./numeral.04df9e7f.js";import{Q as _e,a as T}from"./QTr.a8711b58.js";import{Q as he}from"./QTable.4edb768e.js";import{r as pe}from"./Role.7037081e.js";import{_ as me}from"./PlayerText.f3a4dcb3.js";import"./index.b967c5e1.js";import"./keystoneView.f368ea24.js";import"./QMarkupTable.d0e5140e.js";import"./QCheckbox.383fd197.js";const M=e=>(I("data-v-311b6882"),e=e(),B(),e),fe={class:"HeaderFont text-center"},ge=M(()=>a("h5",null,"Runs Completed in newest week",-1)),ve={class:"nrFont"},De=M(()=>a("br",null,null,-1)),we=M(()=>a("br",null,null,-1)),Se={class:"flex justify-around"},ke={class:"tableAutoSizing"},ye={class:"tableAutoSizing"},be=$({__name:"QuickRunsView",setup(e){const n=K().state.data;var c=n.apiUrl;let l=b(!0),t=b(null),s=b(0),i=b([]),m=b(null);const w=f(d=>n.Periodes),x=f(d=>n.Specs),P=f(d=>n.Classes),J=f(d=>n.settings),X=f(()=>E(s.value).format("0,0")),Y=()=>{var d=n.apiUrl;j.get(`${d}/KeystoneRun/leaderboard?from=0&amount=5`).then(v=>{m.value=v.data.list}).catch(v=>console.log(v))},Z=()=>{Y()},ee=()=>{var v;var d=n.apiUrl;j.get(`${d}/Stats/RunCount?weekId=${(v=w.value[0])==null?void 0:v.id}`).then(y=>{s.value=y.data}).catch(y=>console.log(y))},N=()=>{w.value&&w.value[0]&&ee()},te=oe();f(()=>V.GetDefaultView(te.screen.width,J));const ne=()=>{(t==null?void 0:t.state)!==1&&(l&&((t==null?void 0:t.state)===0||(t==null?void 0:t.state)==="disconnected")?t==null||t.start():setTimeout(d=>{},1e3))},se=()=>{setTimeout(d=>{},1e4)};return z(()=>{N(),t=new le().withUrl(c.slice(0,-4)+"/KeystoneHub").configureLogging(de.Information).build(),t.on("disconnected",d=>{setTimeout(v=>{},1e3)}),Z()}),re(async()=>{await t.start(),se(),t.invoke("RequestNewestRuns",5),t.on("GetNewestRuns",function(d){i.value=[...d]}),t.on("NewRunAdded",function(d){s.value++,i.value.push(d),i&&i.value.length>5&&(i.value=i.value.slice(Math.max(i.value.length-5,1)))})}),z(()=>{t.stop()}),U(w,()=>{N()}),U(l,()=>{l?(console.log("Starting connection.."),ne()):(console.log("Stopping connection.."),t.stop())}),(d,v)=>{const y=A("router-link");return u(),p("div",fe,[ge,a("div",null,[a("h5",ve,D(h(X)),1)]),De,R(d.$slots,"default",{},void 0,!0),we,a("div",Se,[a("div",ke,[g(" Top Runs "),!h(m)||!h(P)||!h(x)?(u(),S(C,{key:0,style:{height:"350px"}})):(u(),S(q,{key:1,dense:!0,noAffixes:!0,noCreatedTime:!0,runs:h(m)},null,8,["runs"])),r(y,{to:"/leaderboard/keystone?page=1&season=1"},{default:_(()=>[g("See more...")]),_:1})]),a("div",ye,[g(" Recent Runs "),!h(i)||!h(P)||!h(x)?(u(),S(C,{key:0,style:{height:"350px"}})):(u(),S(q,{key:1,dense:!0,noAffixes:!0,noCreatedTime:!0,runs:h(ie).sortBy([...h(i)],ae=>ae.index)},null,8,["runs"])),r(y,{to:"/monitor"},{default:_(()=>[g("See more...")]),_:1})])])])}}});var xe=k(be,[["__scopeId","data-v-311b6882"]]);const $e={props:["cols","background","data","count"],data(){return{columns:[{name:"name",align:"left",label:"Dungeon",field:e=>e.id?e.id:e.zone_id,sortable:!0},{name:"ontime_percent",align:"right",label:"Success Rate",field:e=>Math.round(e.ontime_percent),sortable:!0},{name:"count",align:"right",label:"Count",field:"count",sortable:!0}]}},methods:{formatNr(e){return E(e).format("0.0a")},GetDungeonsDetails(e){for(let o=0;o<this.GetDungeons.length;o++){const n=this.GetDungeons[o];if(n.keystone_id===e)return n}}},computed:{...G(["GetDungeons"]),baseUrl(){return document.location.origin},initialPagination(){var e={sortBy:this.data&&this.data.data[0].count?"count":"ontime_percent",descending:!0,rowsPerPage:this.count};return e}}},Ce={key:0,class:"mainContainer"},Re={key:1};function Ge(e,o,n,c,l,t){return n.data&&n.data.data?(u(),p("div",Ce,[r(he,{rows:n.data.data,columns:l.columns,pagination:t.initialPagination,"rows-per-page-options":[],"row-key":"name",dark:"","hide-bottom":!0,color:"amber","visible-columns":n.cols},{pagination:_(()=>[]),body:_(s=>[r(_e,{props:s},{default:_(()=>[t.GetDungeonsDetails(s.colsMap.name.field(s.row))?(u(),S(T,{key:"name",props:s},{default:_(()=>[r(ue,{class:"dungeonImage","img-style":{transform:"scale(1.5)"},src:t.GetDungeonsDetails(s.colsMap.name.field(s.row)).imageurl},null,8,["img-style","src"]),g(" "+D(t.GetDungeonsDetails(s.colsMap.name.field(s.row)).name),1)]),_:2},1032,["props"])):F("",!0),n.cols.includes("ontime_percent")?(u(),S(T,{key:"ontime_percent",props:s},{default:_(()=>[g(D(s.colsMap.ontime_percent.field(s.row))+"% ",1)]),_:2},1032,["props"])):F("",!0),n.cols.includes("count")?(u(),S(T,{key:"count",props:s},{default:_(()=>[g(D(t.formatNr(s.row.count)),1)]),_:2},1032,["props"])):F("",!0)]),_:2},1032,["props"])]),_:1},8,["rows","columns","pagination","visible-columns"])])):(u(),p("div",Re,[r(C,{style:{height:"200px","min-width":"600px"}})]))}var O=k($e,[["render",Ge]]);const Fe={props:["week"],methods:{...Q(["fetchDungeonCountData"]),FetchData(){!this.DungeonCountData&&this.week&&this.fetchDungeonCountData(this.week)}},computed:{...G(["GetDungeonCountData"]),DungeonCountData(){if(this.GetDungeonCountData){const e=this.GetDungeonCountData.filter(o=>o.id==this.week);if(e.length!=0)return e[0]}}},watch:{week(){this.FetchData()}},created(){this.FetchData()}};function Te(e,o,n,c,l,t){return u(),p("div",null,[R(e.$slots,"default",{data:t.DungeonCountData})])}var Ve=k(Fe,[["render",Te]]);const Ae={props:["week"],methods:{...Q(["fetchDungeonSuccessRateData"]),FetchData(){!this.Data&&this.week&&this.fetchDungeonSuccessRateData(this.week)}},computed:{...G(["GetDungeonSuccessRateData","GetSettings"]),Data(){if(this.GetDungeonSuccessRateData){const e=this.GetDungeonSuccessRateData.filter(o=>o.id===this.week&&this.GetSettings.max_runs===o.settings.max_runs&&this.GetSettings.limitbylowestdungeon===o.settings.limitbylowestdungeon&&this.GetSettings.min_keystonelevel===o.settings.min_keystonelevel);if(e.length!=0)return e[0]}}},watch:{week(){this.FetchData()}},created(){this.FetchData()}};function Ie(e,o,n,c,l,t){return u(),p("div",null,[R(e.$slots,"default",{data:t.Data})])}var Be=k(Ae,[["render",Ie]]);const Qe={class:"HeaderFont"},Me={class:"flex justify-around text-center"},Pe={class:"tableAutoSizing"},Ne=a("div",null,"Most played dungeons",-1),ze=a("br",null,null,-1),Ue={class:"tableAutoSizing"},je=a("div",null,"Highest success rate dungeons",-1),He=a("br",null,null,-1),Le=$({__name:"QuickDungeonView",setup(e){const n=K().state.data;b(0),f(t=>n.Dungeons_Data),f(t=>n.Dungeon_Count_Data);const c=f(t=>n.Periodes),l=f(()=>c!=null&&c.value?c.value[0].id:null);return(t,s)=>{const i=A("router-link");return u(),p("div",Qe,[a("div",Me,[a("div",Pe,[Ne,ze,r(Ve,{week:h(l)},{default:_(({data:m})=>[r(O,{cols:["name","count"],background:!0,data:m,count:"5"},null,8,["data"])]),_:1},8,["week"]),r(i,{to:"/statistics/dungeons"},{default:_(()=>[g("See more...")]),_:1})]),a("div",Ue,[je,He,r(Be,{week:h(l)},{default:_(({data:m})=>[r(O,{cols:["name","ontime_percent"],background:!0,data:m,count:"5"},null,8,["data"])]),_:1},8,["week"]),r(i,{to:"/statistics/dungeons"},{default:_(()=>[g("See more...")]),_:1})])])])}}}),qe={methods:{...Q(["fetchSpecData"]),FetchData(){(this.SelectedPeriode&&!this.SpecData||this.SpecData&&this.SpecData.length!==0)&&this.fetchSpecData()}},computed:{...G(["GetSpecData","SelectedPeriode"]),SpecData(){if(this.GetSpecData)return this.GetSpecData}},watch:{SelectedPeriode(){this.FetchData()}},created(){this.FetchData()}};function Oe(e,o,n,c,l,t){return u(),p("div",null,[R(e.$slots,"default",{data:t.SpecData})])}var Ke=k(qe,[["render",Oe]]);const Ee=e=>(I("data-v-6edc7e8a"),e=e(),B(),e),We={class:"Container shadow-24 greyBackground flex justify-around"},Je=Ee(()=>a("br",null,null,-1)),Xe={style:{"max-width":"200px"}},Ye=$({__name:"SpecPrettyViewer",props:{data:{type:Object,required:!0}},setup(e){const o=e,{data:n}=ce(o),c=f(()=>Math.round(n.value.score/n.value.runs*10)/10);return(l,t)=>(u(),p("div",We,[r(pe,{class:"_RoleIconSize",spec:h(n).spec},null,8,["spec"]),a("div",null,[Je,r(me,{id:h(n).spec,size:30},{default:_(s=>{var i,m;return[a("div",Xe,D((i=s.spec)==null?void 0:i.name)+" "+D((m=s.Class)==null?void 0:m.name)+" with a average score of "+D(h(c)),1)]}),_:1},8,["id"])])]))}});var Ze=k(Ye,[["__scopeId","data-v-6edc7e8a"]]);const W=e=>(I("data-v-09073868"),e=e(),B(),e),et={class:"HeaderFont text-center"},tt=W(()=>a("br",null,null,-1)),nt=W(()=>a("br",null,null,-1)),st=$({__name:"TopSpecsView",setup(e){const o=c=>Object.values(V.groupBy(c,"role")).reverse(),n=c=>V._sortBy(c,l=>l.score/l.runs).reverse();return(c,l)=>{const t=A("router-link");return u(),p("div",et,[r(Ke,{class:"flex justify-around"},{default:_(({data:s})=>[s?(u(!0),p(H,{key:0},L(o(s.data),(i,m)=>{var w,x;return u(),p("div",{key:m},[a("div",null,"Top performing "+D((x=(w=i[0])==null?void 0:w.role)==null?void 0:x.toLowerCase())+" this week",1),tt,r(Ze,{data:n(i)[0]},null,8,["data"])])}),128)):(u(),p(H,{key:1},L(3,i=>r(C,{key:i,style:{height:"80px",width:"300px"}})),64))]),_:1}),nt,r(t,{to:"/statistics/specs"},{default:_(()=>[g("Click here to see full list...")]),_:1})])}}});var at=k(st,[["__scopeId","data-v-09073868"]]);const ot=a("br",null,null,-1),rt=a("br",null,null,-1),it=a("br",null,null,-1),wt=$({__name:"home",setup(e){return(o,n)=>(u(),p("div",null,[r(xe,null,{default:_(()=>[r(at)]),_:1}),ot,r(Le),rt,it]))}});export{wt as default};
